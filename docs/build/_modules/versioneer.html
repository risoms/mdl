<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>versioneer &#8212; mdl-R33 2019-05-05 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/semeon/css/user.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="../_static/semeon/js/clipboard.js"></script>
    <script type="text/javascript" src="../_static/semeon/js/user.js"></script>
    <script type="text/javascript" src="../_static/semeon/js/copybutton.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/imhr.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="description" content="Results from our feasibility study for in-browser eyetracking.">
	<meta name="author" content="Semeon Risom">
	<meta name="email" content="semeon.risom@gmail.com">
	<meta name="robots" content="index,follow">
	<meta name="AdsBot-Google" content="noindex">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          mdl-R33</a>
        <span class="navbar-text navbar-version pull-left"><b>2019-05-05</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../genindex.html">Glossary</a></li>
                <li><a href="../install.html">Install</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../features.html#accesesing-raw-data">Accesesing Raw Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features.html#relational-plots">Relational plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/R33/process_demographics.html">Process demographics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_demographics.html#get-metadata">get metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_demographics.html#prepare-data">prepare data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_demographics.html#demographic-statistics">demographic statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_demographics.html#list-of-variables">list of variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_demographics.html#descriptive-device">descriptive device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_demographics.html#descriptive-task">descriptive task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_demographics.html#summary-data">summary data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/R33/download_data.html">Download data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/download_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/download_data.html#raw-data-(UTWeb)">raw data (UTWeb)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/download_data.html#REDCap">REDCap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/download_data.html#box">box</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/R33/run_models.html">Run models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/R33/create_plots.html">Create plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/R33/process_data.html">Process data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/R33/process_data.html#start">start</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html">Eyetracking demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Import-packages.">Import packages.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Set-task-parameters,-either-directly-from-PsychoPy-or-created-manually.">Set task parameters, either directly from PsychoPy or created manually.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Initialize-the-mdl.eyetracking-package.">Initialize the mdl.eyetracking package.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Connect-to-the-Eyelink-Host.">Connect to the Eyelink Host.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Set-the-dominamt-eye.">Set the dominamt eye.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Start-calibration.">Start calibration.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#(Optional)-Print-message-to-console/terminal.">(Optional) Print message to console/terminal.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#(Optional)-Drift-correction.">(Optional) Drift correction.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Start-recording.">Start recording.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Example-use-of-eyetracking.sample().">Example use of eyetracking.sample().</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Stop-recording.">Stop recording.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/eyetracking/demo/eyetracking_demo.html#Close-PsychoPy.">Close PsychoPy.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/roi/generate_roi.html">Region of Interest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/roi/generate_roi.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/roi/generate_roi.html#Read-ROI-from-photoshop-PSD-files">Read ROI from photoshop PSD files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://risoms.github.io/mdl-R33/docs/build/data/data.html">Current Data</a></li>
<li class="toctree-l1"><a class="reference external" href="http://127.0.0.1:8081/">Live</a></li>
<li class="toctree-l1"><a class="reference internal" href="../live.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/mdl.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/mdl.R33.html">mdl.R33</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/mdl.dashboard.html">mdl.dashboard</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/mdl.dashboard.jupyterhub_config.html">mdl.dashboard.jupyterhub_config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/mdl.eyetracking.html">mdl.eyetracking</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/mdl.download.html">mdl.download</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/mdl.plot.html">mdl.plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/mdl.settings.html">mdl.settings</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference external" href="https://risoms.github.io/mdl-R33/docs/build/data/data.html">Current Data</a></li>
<li class="toctree-l1"><a class="reference external" href="http://127.0.0.1:8081/">Live</a></li>
<li class="toctree-l1"><a class="reference internal" href="../live.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/mdl.html">API Reference</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
	<div class="imhr-bars">
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
	</div>
	<div class="row">
		<div class="toc col-md-3">
			<div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference external" href="https://risoms.github.io/mdl-R33/docs/build/data/data.html">Current Data</a></li>
<li class="toctree-l1"><a class="reference external" href="http://127.0.0.1:8081/">Live</a></li>
<li class="toctree-l1"><a class="reference internal" href="../live.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/mdl.html">API Reference</a></li>
</ul>

			</div>
		</div>
		<div class="col-md-9 content">
			
  <h1>Source code for versioneer</h1><div class="highlight"><pre>
<span></span>
<span class="c1"># Version: 0.18</span>

<span class="sd">&quot;&quot;&quot;The Versioneer - like a rocketeer, but for versions.</span>

<span class="sd">The Versioneer</span>
<span class="sd">==============</span>

<span class="sd">* like a rocketeer, but for versions!</span>
<span class="sd">* https://github.com/warner/python-versioneer</span>
<span class="sd">* Brian Warner</span>
<span class="sd">* License: Public Domain</span>
<span class="sd">* Compatible With: python2.6, 2.7, 3.2, 3.3, 3.4, 3.5, 3.6, and pypy</span>
<span class="sd">* [![Latest Version]</span>
<span class="sd">(https://pypip.in/version/versioneer/badge.svg?style=flat)</span>
<span class="sd">](https://pypi.python.org/pypi/versioneer/)</span>
<span class="sd">* [![Build Status]</span>
<span class="sd">(https://travis-ci.org/warner/python-versioneer.png?branch=master)</span>
<span class="sd">](https://travis-ci.org/warner/python-versioneer)</span>

<span class="sd">This is a tool for managing a recorded version number in distutils-based</span>
<span class="sd">python projects. The goal is to remove the tedious and error-prone &quot;update</span>
<span class="sd">the embedded version string&quot; step from your release process. Making a new</span>
<span class="sd">release should be as easy as recording a new tag in your version-control</span>
<span class="sd">system, and maybe making new tarballs.</span>


<span class="sd">## Quick Install</span>

<span class="sd">* `pip install versioneer` to somewhere to your $PATH</span>
<span class="sd">* add a `[versioneer]` section to your setup.cfg (see below)</span>
<span class="sd">* run `versioneer install` in your source tree, commit the results</span>

<span class="sd">## Version Identifiers</span>

<span class="sd">Source trees come from a variety of places:</span>

<span class="sd">* a version-control system checkout (mostly used by developers)</span>
<span class="sd">* a nightly tarball, produced by build automation</span>
<span class="sd">* a snapshot tarball, produced by a web-based VCS browser, like github&#39;s</span>
<span class="sd">  &quot;tarball from tag&quot; feature</span>
<span class="sd">* a release tarball, produced by &quot;setup.py sdist&quot;, distributed through PyPI</span>

<span class="sd">Within each source tree, the version identifier (either a string or a number,</span>
<span class="sd">this tool is format-agnostic) can come from a variety of places:</span>

<span class="sd">* ask the VCS tool itself, e.g. &quot;git describe&quot; (for checkouts), which knows</span>
<span class="sd">  about recent &quot;tags&quot; and an absolute revision-id</span>
<span class="sd">* the name of the directory into which the tarball was unpacked</span>
<span class="sd">* an expanded VCS keyword ($Id$, etc)</span>
<span class="sd">* a `_version.py` created by some earlier build step</span>

<span class="sd">For released software, the version identifier is closely related to a VCS</span>
<span class="sd">tag. Some projects use tag names that include more than just the version</span>
<span class="sd">string (e.g. &quot;myproject-1.2&quot; instead of just &quot;1.2&quot;), in which case the tool</span>
<span class="sd">needs to strip the tag prefix to extract the version identifier. For</span>
<span class="sd">unreleased software (between tags), the version identifier should provide</span>
<span class="sd">enough information to help developers recreate the same tree, while also</span>
<span class="sd">giving them an idea of roughly how old the tree is (after version 1.2, before</span>
<span class="sd">version 1.3). Many VCS systems can report a description that captures this,</span>
<span class="sd">for example `git describe --tags --dirty --always` reports things like</span>
<span class="sd">&quot;0.7-1-g574ab98-dirty&quot; to indicate that the checkout is one revision past the</span>
<span class="sd">0.7 tag, has a unique revision id of &quot;574ab98&quot;, and is &quot;dirty&quot; (it has</span>
<span class="sd">uncommitted changes.</span>

<span class="sd">The version identifier is used for multiple purposes:</span>

<span class="sd">* to allow the module to self-identify its version: `myproject.__version__`</span>
<span class="sd">* to choose a name and prefix for a &#39;setup.py sdist&#39; tarball</span>

<span class="sd">## Theory of Operation</span>

<span class="sd">Versioneer works by adding a special `_version.py` file into your source</span>
<span class="sd">tree, where your `__init__.py` can import it. This `_version.py` knows how to</span>
<span class="sd">dynamically ask the VCS tool for version information at import time.</span>

<span class="sd">`_version.py` also contains `$Revision$` markers, and the installation</span>
<span class="sd">process marks `_version.py` to have this marker rewritten with a tag name</span>
<span class="sd">during the `git archive` command. As a result, generated tarballs will</span>
<span class="sd">contain enough information to get the proper version.</span>

<span class="sd">To allow `setup.py` to compute a version too, a `versioneer.py` is added to</span>
<span class="sd">the top level of your source tree, next to `setup.py` and the `setup.cfg`</span>
<span class="sd">that configures it. This overrides several distutils/setuptools commands to</span>
<span class="sd">compute the version when invoked, and changes `setup.py build` and `setup.py</span>
<span class="sd">sdist` to replace `_version.py` with a small static file that contains just</span>
<span class="sd">the generated version data.</span>

<span class="sd">## Installation</span>

<span class="sd">See [INSTALL.md](./INSTALL.md) for detailed installation instructions.</span>

<span class="sd">## Version-String Flavors</span>

<span class="sd">Code which uses Versioneer can learn about its version string at runtime by</span>
<span class="sd">importing `_version` from your main `__init__.py` file and running the</span>
<span class="sd">`get_versions()` function. From the &quot;outside&quot; (e.g. in `setup.py`), you can</span>
<span class="sd">import the top-level `versioneer.py` and run `get_versions()`.</span>

<span class="sd">Both functions return a dictionary with different flavors of version</span>
<span class="sd">information:</span>

<span class="sd">* `[&#39;version&#39;]`: A condensed version string, rendered using the selected</span>
<span class="sd">  style. This is the most commonly used value for the project&#39;s version</span>
<span class="sd">  string. The default &quot;pep440&quot; style yields strings like `0.11`,</span>
<span class="sd">  `0.11+2.g1076c97`, or `0.11+2.g1076c97.dirty`. See the &quot;Styles&quot; section</span>
<span class="sd">  below for alternative styles.</span>

<span class="sd">* `[&#39;full-revisionid&#39;]`: detailed revision identifier. For Git, this is the</span>
<span class="sd">  full SHA1 commit id, e.g. &quot;1076c978a8d3cfc70f408fe5974aa6c092c949ac&quot;.</span>

<span class="sd">* `[&#39;date&#39;]`: Date and time of the latest `HEAD` commit. For Git, it is the</span>
<span class="sd">  commit date in ISO 8601 format. This will be None if the date is not</span>
<span class="sd">  available.</span>

<span class="sd">* `[&#39;dirty&#39;]`: a boolean, True if the tree has uncommitted changes. Note that</span>
<span class="sd">  this is only accurate if run in a VCS checkout, otherwise it is likely to</span>
<span class="sd">  be False or None</span>

<span class="sd">* `[&#39;error&#39;]`: if the version string could not be computed, this will be set</span>
<span class="sd">  to a string describing the problem, otherwise it will be None. It may be</span>
<span class="sd">  useful to throw an exception in setup.py if this is set, to avoid e.g.</span>
<span class="sd">  creating tarballs with a version string of &quot;unknown&quot;.</span>

<span class="sd">Some variants are more useful than others. Including `full-revisionid` in a</span>
<span class="sd">bug report should allow developers to reconstruct the exact code being tested</span>
<span class="sd">(or indicate the presence of local changes that should be shared with the</span>
<span class="sd">developers). `version` is suitable for display in an &quot;about&quot; box or a CLI</span>
<span class="sd">`--version` output: it can be easily compared against release notes and lists</span>
<span class="sd">of bugs fixed in various releases.</span>

<span class="sd">The installer adds the following text to your `__init__.py` to place a basic</span>
<span class="sd">version in `YOURPROJECT.__version__`:</span>

<span class="sd">    from ._version import get_versions</span>
<span class="sd">    __version__ = get_versions()[&#39;version&#39;]</span>
<span class="sd">    del get_versions</span>

<span class="sd">## Styles</span>

<span class="sd">The setup.cfg `style=` configuration controls how the VCS information is</span>
<span class="sd">rendered into a version string.</span>

<span class="sd">The default style, &quot;pep440&quot;, produces a PEP440-compliant string, equal to the</span>
<span class="sd">un-prefixed tag name for actual releases, and containing an additional &quot;local</span>
<span class="sd">version&quot; section with more detail for in-between builds. For Git, this is</span>
<span class="sd">TAG[+DISTANCE.gHEX[.dirty]] , using information from `git describe --tags</span>
<span class="sd">--dirty --always`. For example &quot;0.11+2.g1076c97.dirty&quot; indicates that the</span>
<span class="sd">tree is like the &quot;1076c97&quot; commit but has uncommitted changes (&quot;.dirty&quot;), and</span>
<span class="sd">that this commit is two revisions (&quot;+2&quot;) beyond the &quot;0.11&quot; tag. For released</span>
<span class="sd">software (exactly equal to a known tag), the identifier will only contain the</span>
<span class="sd">stripped tag, e.g. &quot;0.11&quot;.</span>

<span class="sd">Other styles are available. See [details.md](details.md) in the Versioneer</span>
<span class="sd">source tree for descriptions.</span>

<span class="sd">## Debugging</span>

<span class="sd">Versioneer tries to avoid fatal errors: if something goes wrong, it will tend</span>
<span class="sd">to return a version of &quot;0+unknown&quot;. To investigate the problem, run `setup.py</span>
<span class="sd">version`, which will run the version-lookup code in a verbose mode, and will</span>
<span class="sd">display the full contents of `get_versions()` (including the `error` string,</span>
<span class="sd">which may help identify what went wrong).</span>

<span class="sd">## Known Limitations</span>

<span class="sd">Some situations are known to cause problems for Versioneer. This details the</span>
<span class="sd">most significant ones. More can be found on Github</span>
<span class="sd">[issues page](https://github.com/warner/python-versioneer/issues).</span>

<span class="sd">### Subprojects</span>

<span class="sd">Versioneer has limited support for source trees in which `setup.py` is not in</span>
<span class="sd">the root directory (e.g. `setup.py` and `.git/` are *not* siblings). The are</span>
<span class="sd">two common reasons why `setup.py` might not be in the root:</span>

<span class="sd">* Source trees which contain multiple subprojects, such as</span>
<span class="sd">  [Buildbot](https://github.com/buildbot/buildbot), which contains both</span>
<span class="sd">  &quot;master&quot; and &quot;slave&quot; subprojects, each with their own `setup.py`,</span>
<span class="sd">  `setup.cfg`, and `tox.ini`. Projects like these produce multiple PyPI</span>
<span class="sd">  distributions (and upload multiple independently-installable tarballs).</span>
<span class="sd">* Source trees whose main purpose is to contain a C library, but which also</span>
<span class="sd">  provide bindings to Python (and perhaps other langauges) in subdirectories.</span>

<span class="sd">Versioneer will look for `.git` in parent directories, and most operations</span>
<span class="sd">should get the right version string. However `pip` and `setuptools` have bugs</span>
<span class="sd">and implementation details which frequently cause `pip install .` from a</span>
<span class="sd">subproject directory to fail to find a correct version string (so it usually</span>
<span class="sd">defaults to `0+unknown`).</span>

<span class="sd">`pip install --editable .` should work correctly. `setup.py install` might</span>
<span class="sd">work too.</span>

<span class="sd">Pip-8.1.1 is known to have this problem, but hopefully it will get fixed in</span>
<span class="sd">some later version.</span>

<span class="sd">[Bug #38](https://github.com/warner/python-versioneer/issues/38) is tracking</span>
<span class="sd">this issue. The discussion in</span>
<span class="sd">[PR #61](https://github.com/warner/python-versioneer/pull/61) describes the</span>
<span class="sd">issue from the Versioneer side in more detail.</span>
<span class="sd">[pip PR#3176](https://github.com/pypa/pip/pull/3176) and</span>
<span class="sd">[pip PR#3615](https://github.com/pypa/pip/pull/3615) contain work to improve</span>
<span class="sd">pip to let Versioneer work correctly.</span>

<span class="sd">Versioneer-0.16 and earlier only looked for a `.git` directory next to the</span>
<span class="sd">`setup.cfg`, so subprojects were completely unsupported with those releases.</span>

<span class="sd">### Editable installs with setuptools &lt;= 18.5</span>

<span class="sd">`setup.py develop` and `pip install --editable .` allow you to install a</span>
<span class="sd">project into a virtualenv once, then continue editing the source code (and</span>
<span class="sd">test) without re-installing after every change.</span>

<span class="sd">&quot;Entry-point scripts&quot; (`setup(entry_points={&quot;console_scripts&quot;: ..})`) are a</span>
<span class="sd">convenient way to specify executable scripts that should be installed along</span>
<span class="sd">with the python package.</span>

<span class="sd">These both work as expected when using modern setuptools. When using</span>
<span class="sd">setuptools-18.5 or earlier, however, certain operations will cause</span>
<span class="sd">`pkg_resources.DistributionNotFound` errors when running the entrypoint</span>
<span class="sd">script, which must be resolved by re-installing the package. This happens</span>
<span class="sd">when the install happens with one version, then the egg_info data is</span>
<span class="sd">regenerated while a different version is checked out. Many setup.py commands</span>
<span class="sd">cause egg_info to be rebuilt (including `sdist`, `wheel`, and installing into</span>
<span class="sd">a different virtualenv), so this can be surprising.</span>

<span class="sd">[Bug #83](https://github.com/warner/python-versioneer/issues/83) describes</span>
<span class="sd">this one, but upgrading to a newer version of setuptools should probably</span>
<span class="sd">resolve it.</span>

<span class="sd">### Unicode version strings</span>

<span class="sd">While Versioneer works (and is continually tested) with both Python 2 and</span>
<span class="sd">Python 3, it is not entirely consistent with bytes-vs-unicode distinctions.</span>
<span class="sd">Newer releases probably generate unicode version strings on py2. It&#39;s not</span>
<span class="sd">clear that this is wrong, but it may be surprising for applications when then</span>
<span class="sd">write these strings to a network connection or include them in bytes-oriented</span>
<span class="sd">APIs like cryptographic checksums.</span>

<span class="sd">[Bug #71](https://github.com/warner/python-versioneer/issues/71) investigates</span>
<span class="sd">this question.</span>


<span class="sd">## Updating Versioneer</span>

<span class="sd">To upgrade your project to a new release of Versioneer, do the following:</span>

<span class="sd">* install the new Versioneer (`pip install -U versioneer` or equivalent)</span>
<span class="sd">* edit `setup.cfg`, if necessary, to include any new configuration settings</span>
<span class="sd">  indicated by the release notes. See [UPGRADING](./UPGRADING.md) for details.</span>
<span class="sd">* re-run `versioneer install` in your source tree, to replace</span>
<span class="sd">  `SRC/_version.py`</span>
<span class="sd">* commit any changed files</span>

<span class="sd">## Future Directions</span>

<span class="sd">This tool is designed to make it easily extended to other version-control</span>
<span class="sd">systems: all VCS-specific components are in separate directories like</span>
<span class="sd">src/git/ . The top-level `versioneer.py` script is assembled from these</span>
<span class="sd">components by running make-versioneer.py . In the future, make-versioneer.py</span>
<span class="sd">will take a VCS name as an argument, and will construct a version of</span>
<span class="sd">`versioneer.py` that is specific to the given VCS. It might also take the</span>
<span class="sd">configuration arguments that are currently provided manually during</span>
<span class="sd">installation by editing setup.py . Alternatively, it might go the other</span>
<span class="sd">direction and include code from all supported VCS systems, reducing the</span>
<span class="sd">number of intermediate scripts.</span>


<span class="sd">## License</span>

<span class="sd">To make Versioneer easier to embed, all its code is dedicated to the public</span>
<span class="sd">domain. The `_version.py` that it creates is also in the public domain.</span>
<span class="sd">Specifically, both are released under the Creative Commons &quot;Public Domain</span>
<span class="sd">Dedication&quot; license (CC0-1.0), as described in</span>
<span class="sd">https://creativecommons.org/publicdomain/zero/1.0/ .</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">configparser</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ConfigParser</span> <span class="k">as</span> <span class="nn">configparser</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>


<div class="viewcode-block" id="VersioneerConfig"><a class="viewcode-back" href="../api/versioneer.html#versioneer.VersioneerConfig">[docs]</a><span class="k">class</span> <span class="nc">VersioneerConfig</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Container for Versioneer configuration parameters.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="get_root"><a class="viewcode-back" href="../api/versioneer.html#versioneer.get_root">[docs]</a><span class="k">def</span> <span class="nf">get_root</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get the project root directory.</span>

<span class="sd">    We require that all commands are run from the project root, i.e. the</span>
<span class="sd">    directory that contains setup.py, setup.cfg, and versioneer.py .</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
    <span class="n">setup_py</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;setup.py&quot;</span><span class="p">)</span>
    <span class="n">versioneer_py</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;versioneer.py&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">setup_py</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">versioneer_py</span><span class="p">)):</span>
        <span class="c1"># allow &#39;python path/to/setup.py COMMAND&#39;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="n">setup_py</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;setup.py&quot;</span><span class="p">)</span>
        <span class="n">versioneer_py</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;versioneer.py&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">setup_py</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">versioneer_py</span><span class="p">)):</span>
        <span class="n">err</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Versioneer was unable to run the project root directory. &quot;</span>
               <span class="s2">&quot;Versioneer requires setup.py to be executed from &quot;</span>
               <span class="s2">&quot;its immediate directory (like &#39;python setup.py COMMAND&#39;), &quot;</span>
               <span class="s2">&quot;or in a way that lets it use sys.argv[0] to find the root &quot;</span>
               <span class="s2">&quot;(like &#39;python path/to/setup.py COMMAND&#39;).&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">VersioneerBadRootError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Certain runtime workflows (setup.py install/develop in a setuptools</span>
        <span class="c1"># tree) execute all dependencies in a single python process, so</span>
        <span class="c1"># &quot;versioneer&quot; may be imported multiple times, and python&#39;s shared</span>
        <span class="c1"># module-import table will cache the first one. So we can&#39;t use</span>
        <span class="c1"># os.path.dirname(__file__), as that will find whichever</span>
        <span class="c1"># versioneer.py was first imported, even in later projects.</span>
        <span class="n">me</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">me_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">me</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">vsr_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">versioneer_py</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">me_dir</span> <span class="o">!=</span> <span class="n">vsr_dir</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: build in </span><span class="si">%s</span><span class="s2"> is using versioneer.py from </span><span class="si">%s</span><span class="s2">&quot;</span>
                  <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">me</span><span class="p">),</span> <span class="n">versioneer_py</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">root</span></div>


<div class="viewcode-block" id="get_config_from_root"><a class="viewcode-back" href="../api/versioneer.html#versioneer.get_config_from_root">[docs]</a><span class="k">def</span> <span class="nf">get_config_from_root</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read the project setup.cfg file to determine Versioneer config.&quot;&quot;&quot;</span>
    <span class="c1"># This might raise EnvironmentError (if setup.cfg is missing), or</span>
    <span class="c1"># configparser.NoSectionError (if it lacks a [versioneer] section), or</span>
    <span class="c1"># configparser.NoOptionError (if it lacks &quot;VCS=&quot;). See the docstring at</span>
    <span class="c1"># the top of versioneer.py for instructions on writing your setup.cfg .</span>
    <span class="n">setup_cfg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;setup.cfg&quot;</span><span class="p">)</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">SafeConfigParser</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">setup_cfg</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">VCS</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;versioneer&quot;</span><span class="p">,</span> <span class="s2">&quot;VCS&quot;</span><span class="p">)</span>  <span class="c1"># mandatory</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="s2">&quot;versioneer&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;versioneer&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">VersioneerConfig</span><span class="p">()</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">VCS</span> <span class="o">=</span> <span class="n">VCS</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;versionfile_source&quot;</span><span class="p">)</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_build</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;versionfile_build&quot;</span><span class="p">)</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;tag_prefix&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">):</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">parentdir_prefix</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;parentdir_prefix&quot;</span><span class="p">)</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cfg</span></div>


<div class="viewcode-block" id="NotThisMethod"><a class="viewcode-back" href="../api/versioneer.html#versioneer.NotThisMethod">[docs]</a><span class="k">class</span> <span class="nc">NotThisMethod</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised if a method is not valid for the current scenario.&quot;&quot;&quot;</span></div>


<span class="c1"># these dictionaries contain VCS-specific tools</span>
<span class="n">LONG_VERSION_PY</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">HANDLERS</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="register_vcs_handler"><a class="viewcode-back" href="../api/versioneer.html#versioneer.register_vcs_handler">[docs]</a><span class="k">def</span> <span class="nf">register_vcs_handler</span><span class="p">(</span><span class="n">vcs</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>  <span class="c1"># decorator</span>
    <span class="sd">&quot;&quot;&quot;Decorator to mark a method as the handler for a particular VCS.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Store f in HANDLERS[vcs][method].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">vcs</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HANDLERS</span><span class="p">:</span>
            <span class="n">HANDLERS</span><span class="p">[</span><span class="n">vcs</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">HANDLERS</span><span class="p">[</span><span class="n">vcs</span><span class="p">][</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">decorate</span></div>


<div class="viewcode-block" id="run_command"><a class="viewcode-back" href="../api/versioneer.html#versioneer.run_command">[docs]</a><span class="k">def</span> <span class="nf">run_command</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_stderr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call the given command(s).&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dispcmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">([</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="n">args</span><span class="p">)</span>
            <span class="c1"># remember shell=False, so use git.cmd on windows, not just git</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="n">args</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">cwd</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
                                 <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                 <span class="n">stderr</span><span class="o">=</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span> <span class="k">if</span> <span class="n">hide_stderr</span>
                                         <span class="k">else</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unable to run </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dispcmd</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unable to find command, tried </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">commands</span><span class="p">,))</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">stdout</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unable to run </span><span class="si">%s</span><span class="s2"> (error)&quot;</span> <span class="o">%</span> <span class="n">dispcmd</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;stdout was </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stdout</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span>
    <span class="k">return</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span></div>


<span class="n">LONG_VERSION_PY</span><span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># This file helps to compute a version number in source trees obtained from</span>
<span class="s1"># git-archive tarball (such as those provided by githubs download-from-tag</span>
<span class="s1"># feature). Distribution tarballs (built by setup.py sdist) and build</span>
<span class="s1"># directories (produced by setup.py build) will contain a much shorter file</span>
<span class="s1"># that just contains the computed version number.</span>

<span class="s1"># This file is released into the public domain. Generated by</span>
<span class="s1"># versioneer-0.18 (https://github.com/warner/python-versioneer)</span>

<span class="s1">&quot;&quot;&quot;Git implementation of _version.py.&quot;&quot;&quot;</span>

<span class="s1">import errno</span>
<span class="s1">import os</span>
<span class="s1">import re</span>
<span class="s1">import subprocess</span>
<span class="s1">import sys</span>


<span class="s1">def get_keywords():</span>
<span class="s1">    &quot;&quot;&quot;Get the keywords needed to look up the version information.&quot;&quot;&quot;</span>
<span class="s1">    # these strings will be replaced by git during git-archive.</span>
<span class="s1">    # setup.py/versioneer.py will grep for the variable names, so they must</span>
<span class="s1">    # each be defined on a line of their own. _version.py will just call</span>
<span class="s1">    # get_keywords().</span>
<span class="s1">    git_refnames = &quot;</span><span class="si">%(DOLLAR)s</span><span class="s1">Format:</span><span class="si">%%</span><span class="s1">d</span><span class="si">%(DOLLAR)s</span><span class="s1">&quot;</span>
<span class="s1">    git_full = &quot;</span><span class="si">%(DOLLAR)s</span><span class="s1">Format:</span><span class="si">%%</span><span class="s1">H</span><span class="si">%(DOLLAR)s</span><span class="s1">&quot;</span>
<span class="s1">    git_date = &quot;</span><span class="si">%(DOLLAR)s</span><span class="s1">Format:</span><span class="si">%%</span><span class="s1">ci</span><span class="si">%(DOLLAR)s</span><span class="s1">&quot;</span>
<span class="s1">    keywords = {&quot;refnames&quot;: git_refnames, &quot;full&quot;: git_full, &quot;date&quot;: git_date}</span>
<span class="s1">    return keywords</span>


<span class="s1">class VersioneerConfig:</span>
<span class="s1">    &quot;&quot;&quot;Container for Versioneer configuration parameters.&quot;&quot;&quot;</span>


<span class="s1">def get_config():</span>
<span class="s1">    &quot;&quot;&quot;Create, populate and return the VersioneerConfig() object.&quot;&quot;&quot;</span>
<span class="s1">    # these strings are filled in when &#39;setup.py versioneer&#39; creates</span>
<span class="s1">    # _version.py</span>
<span class="s1">    cfg = VersioneerConfig()</span>
<span class="s1">    cfg.VCS = &quot;git&quot;</span>
<span class="s1">    cfg.style = &quot;</span><span class="si">%(STYLE)s</span><span class="s1">&quot;</span>
<span class="s1">    cfg.tag_prefix = &quot;</span><span class="si">%(TAG_PREFIX)s</span><span class="s1">&quot;</span>
<span class="s1">    cfg.parentdir_prefix = &quot;</span><span class="si">%(PARENTDIR_PREFIX)s</span><span class="s1">&quot;</span>
<span class="s1">    cfg.versionfile_source = &quot;</span><span class="si">%(VERSIONFILE_SOURCE)s</span><span class="s1">&quot;</span>
<span class="s1">    cfg.verbose = False</span>
<span class="s1">    return cfg</span>


<span class="s1">class NotThisMethod(Exception):</span>
<span class="s1">    &quot;&quot;&quot;Exception raised if a method is not valid for the current scenario.&quot;&quot;&quot;</span>


<span class="s1">LONG_VERSION_PY = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">HANDLERS = </span><span class="si">{}</span><span class="s1"></span>


<span class="s1">def register_vcs_handler(vcs, method):  # decorator</span>
<span class="s1">    &quot;&quot;&quot;Decorator to mark a method as the handler for a particular VCS.&quot;&quot;&quot;</span>
<span class="s1">    def decorate(f):</span>
<span class="s1">        &quot;&quot;&quot;Store f in HANDLERS[vcs][method].&quot;&quot;&quot;</span>
<span class="s1">        if vcs not in HANDLERS:</span>
<span class="s1">            HANDLERS[vcs] = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">        HANDLERS[vcs][method] = f</span>
<span class="s1">        return f</span>
<span class="s1">    return decorate</span>


<span class="s1">def run_command(commands, args, cwd=None, verbose=False, hide_stderr=False,</span>
<span class="s1">                env=None):</span>
<span class="s1">    &quot;&quot;&quot;Call the given command(s).&quot;&quot;&quot;</span>
<span class="s1">    assert isinstance(commands, list)</span>
<span class="s1">    p = None</span>
<span class="s1">    for c in commands:</span>
<span class="s1">        try:</span>
<span class="s1">            dispcmd = str([c] + args)</span>
<span class="s1">            # remember shell=False, so use git.cmd on windows, not just git</span>
<span class="s1">            p = subprocess.Popen([c] + args, cwd=cwd, env=env,</span>
<span class="s1">                                 stdout=subprocess.PIPE,</span>
<span class="s1">                                 stderr=(subprocess.PIPE if hide_stderr</span>
<span class="s1">                                         else None))</span>
<span class="s1">            break</span>
<span class="s1">        except EnvironmentError:</span>
<span class="s1">            e = sys.exc_info()[1]</span>
<span class="s1">            if e.errno == errno.ENOENT:</span>
<span class="s1">                continue</span>
<span class="s1">            if verbose:</span>
<span class="s1">                print(&quot;unable to run </span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> dispcmd)</span>
<span class="s1">                print(e)</span>
<span class="s1">            return None, None</span>
<span class="s1">    else:</span>
<span class="s1">        if verbose:</span>
<span class="s1">            print(&quot;unable to find command, tried </span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> (commands,))</span>
<span class="s1">        return None, None</span>
<span class="s1">    stdout = p.communicate()[0].strip()</span>
<span class="s1">    if sys.version_info[0] &gt;= 3:</span>
<span class="s1">        stdout = stdout.decode()</span>
<span class="s1">    if p.returncode != 0:</span>
<span class="s1">        if verbose:</span>
<span class="s1">            print(&quot;unable to run </span><span class="si">%%</span><span class="s1">s (error)&quot; </span><span class="si">%%</span><span class="s1"> dispcmd)</span>
<span class="s1">            print(&quot;stdout was </span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> stdout)</span>
<span class="s1">        return None, p.returncode</span>
<span class="s1">    return stdout, p.returncode</span>


<span class="s1">def versions_from_parentdir(parentdir_prefix, root, verbose):</span>
<span class="s1">    &quot;&quot;&quot;Try to determine the version from the parent directory name.</span>

<span class="s1">    Source tarballs conventionally unpack into a directory that includes both</span>
<span class="s1">    the project name and a version string. We will also support searching up</span>
<span class="s1">    two directory levels for an appropriately named parent directory</span>
<span class="s1">    &quot;&quot;&quot;</span>
<span class="s1">    rootdirs = []</span>

<span class="s1">    for i in range(3):</span>
<span class="s1">        dirname = os.path.basename(root)</span>
<span class="s1">        if dirname.startswith(parentdir_prefix):</span>
<span class="s1">            return {&quot;version&quot;: dirname[len(parentdir_prefix):],</span>
<span class="s1">                    &quot;full-revisionid&quot;: None,</span>
<span class="s1">                    &quot;dirty&quot;: False, &quot;error&quot;: None, &quot;date&quot;: None}</span>
<span class="s1">        else:</span>
<span class="s1">            rootdirs.append(root)</span>
<span class="s1">            root = os.path.dirname(root)  # up a level</span>

<span class="s1">    if verbose:</span>
<span class="s1">        print(&quot;Tried directories </span><span class="si">%%</span><span class="s1">s but none started with prefix </span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"></span>
<span class="s1">              (str(rootdirs), parentdir_prefix))</span>
<span class="s1">    raise NotThisMethod(&quot;rootdir doesn&#39;t start with parentdir_prefix&quot;)</span>


<span class="s1">@register_vcs_handler(&quot;git&quot;, &quot;get_keywords&quot;)</span>
<span class="s1">def git_get_keywords(versionfile_abs):</span>
<span class="s1">    &quot;&quot;&quot;Extract version information from the given file.&quot;&quot;&quot;</span>
<span class="s1">    # the code embedded in _version.py can just fetch the value of these</span>
<span class="s1">    # keywords. When used from setup.py, we don&#39;t want to import _version.py,</span>
<span class="s1">    # so we do it with a regexp instead. This function is not used from</span>
<span class="s1">    # _version.py.</span>
<span class="s1">    keywords = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">    try:</span>
<span class="s1">        f = open(versionfile_abs, &quot;r&quot;)</span>
<span class="s1">        for line in f.readlines():</span>
<span class="s1">            if line.strip().startswith(&quot;git_refnames =&quot;):</span>
<span class="s1">                mo = re.search(r&#39;=\s*&quot;(.*)&quot;&#39;, line)</span>
<span class="s1">                if mo:</span>
<span class="s1">                    keywords[&quot;refnames&quot;] = mo.group(1)</span>
<span class="s1">            if line.strip().startswith(&quot;git_full =&quot;):</span>
<span class="s1">                mo = re.search(r&#39;=\s*&quot;(.*)&quot;&#39;, line)</span>
<span class="s1">                if mo:</span>
<span class="s1">                    keywords[&quot;full&quot;] = mo.group(1)</span>
<span class="s1">            if line.strip().startswith(&quot;git_date =&quot;):</span>
<span class="s1">                mo = re.search(r&#39;=\s*&quot;(.*)&quot;&#39;, line)</span>
<span class="s1">                if mo:</span>
<span class="s1">                    keywords[&quot;date&quot;] = mo.group(1)</span>
<span class="s1">        f.close()</span>
<span class="s1">    except EnvironmentError:</span>
<span class="s1">        pass</span>
<span class="s1">    return keywords</span>


<span class="s1">@register_vcs_handler(&quot;git&quot;, &quot;keywords&quot;)</span>
<span class="s1">def git_versions_from_keywords(keywords, tag_prefix, verbose):</span>
<span class="s1">    &quot;&quot;&quot;Get version information from git keywords.&quot;&quot;&quot;</span>
<span class="s1">    if not keywords:</span>
<span class="s1">        raise NotThisMethod(&quot;no keywords at all, weird&quot;)</span>
<span class="s1">    date = keywords.get(&quot;date&quot;)</span>
<span class="s1">    if date is not None:</span>
<span class="s1">        # git-2.2.0 added &quot;</span><span class="si">%%</span><span class="s1">cI&quot;, which expands to an ISO-8601 -compliant</span>
<span class="s1">        # datestamp. However we prefer &quot;</span><span class="si">%%</span><span class="s1">ci&quot; (which expands to an &quot;ISO-8601</span>
<span class="s1">        # -like&quot; string, which we must then edit to make compliant), because</span>
<span class="s1">        # it&#39;s been around since git-1.5.3, and it&#39;s too difficult to</span>
<span class="s1">        # discover which version we&#39;re using, or to work around using an</span>
<span class="s1">        # older one.</span>
<span class="s1">        date = date.strip().replace(&quot; &quot;, &quot;T&quot;, 1).replace(&quot; &quot;, &quot;&quot;, 1)</span>
<span class="s1">    refnames = keywords[&quot;refnames&quot;].strip()</span>
<span class="s1">    if refnames.startswith(&quot;$Format&quot;):</span>
<span class="s1">        if verbose:</span>
<span class="s1">            print(&quot;keywords are unexpanded, not using&quot;)</span>
<span class="s1">        raise NotThisMethod(&quot;unexpanded keywords, not a git-archive tarball&quot;)</span>
<span class="s1">    refs = set([r.strip() for r in refnames.strip(&quot;()&quot;).split(&quot;,&quot;)])</span>
<span class="s1">    # starting in git-1.8.3, tags are listed as &quot;tag: foo-1.0&quot; instead of</span>
<span class="s1">    # just &quot;foo-1.0&quot;. If we see a &quot;tag: &quot; prefix, prefer those.</span>
<span class="s1">    TAG = &quot;tag: &quot;</span>
<span class="s1">    tags = set([r[len(TAG):] for r in refs if r.startswith(TAG)])</span>
<span class="s1">    if not tags:</span>
<span class="s1">        # Either we&#39;re using git &lt; 1.8.3, or there really are no tags. We use</span>
<span class="s1">        # a heuristic: assume all version tags have a digit. The old git </span><span class="si">%%</span><span class="s1">d</span>
<span class="s1">        # expansion behaves like git log --decorate=short and strips out the</span>
<span class="s1">        # refs/heads/ and refs/tags/ prefixes that would let us distinguish</span>
<span class="s1">        # between branches and tags. By ignoring refnames without digits, we</span>
<span class="s1">        # filter out many common branch names like &quot;release&quot; and</span>
<span class="s1">        # &quot;stabilization&quot;, as well as &quot;HEAD&quot; and &quot;master&quot;.</span>
<span class="s1">        tags = set([r for r in refs if re.search(r&#39;\d&#39;, r)])</span>
<span class="s1">        if verbose:</span>
<span class="s1">            print(&quot;discarding &#39;</span><span class="si">%%</span><span class="s1">s&#39;, no digits&quot; </span><span class="si">%%</span><span class="s1"> &quot;,&quot;.join(refs - tags))</span>
<span class="s1">    if verbose:</span>
<span class="s1">        print(&quot;likely tags: </span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> &quot;,&quot;.join(sorted(tags)))</span>
<span class="s1">    for ref in sorted(tags):</span>
<span class="s1">        # sorting will prefer e.g. &quot;2.0&quot; over &quot;2.0rc1&quot;</span>
<span class="s1">        if ref.startswith(tag_prefix):</span>
<span class="s1">            r = ref[len(tag_prefix):]</span>
<span class="s1">            if verbose:</span>
<span class="s1">                print(&quot;picking </span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> r)</span>
<span class="s1">            return {&quot;version&quot;: r,</span>
<span class="s1">                    &quot;full-revisionid&quot;: keywords[&quot;full&quot;].strip(),</span>
<span class="s1">                    &quot;dirty&quot;: False, &quot;error&quot;: None,</span>
<span class="s1">                    &quot;date&quot;: date}</span>
<span class="s1">    # no suitable tags, so version is &quot;0+unknown&quot;, but full hex is still there</span>
<span class="s1">    if verbose:</span>
<span class="s1">        print(&quot;no suitable tags, using unknown + full revision id&quot;)</span>
<span class="s1">    return {&quot;version&quot;: &quot;0+unknown&quot;,</span>
<span class="s1">            &quot;full-revisionid&quot;: keywords[&quot;full&quot;].strip(),</span>
<span class="s1">            &quot;dirty&quot;: False, &quot;error&quot;: &quot;no suitable tags&quot;, &quot;date&quot;: None}</span>


<span class="s1">@register_vcs_handler(&quot;git&quot;, &quot;pieces_from_vcs&quot;)</span>
<span class="s1">def git_pieces_from_vcs(tag_prefix, root, verbose, run_command=run_command):</span>
<span class="s1">    &quot;&quot;&quot;Get version from &#39;git describe&#39; in the root of the source tree.</span>

<span class="s1">    This only gets called if the git-archive &#39;subst&#39; keywords were *not*</span>
<span class="s1">    expanded, and _version.py hasn&#39;t already been rewritten with a short</span>
<span class="s1">    version string, meaning we&#39;re inside a checked out source tree.</span>
<span class="s1">    &quot;&quot;&quot;</span>
<span class="s1">    GITS = [&quot;git&quot;]</span>
<span class="s1">    if sys.platform == &quot;win32&quot;:</span>
<span class="s1">        GITS = [&quot;git.cmd&quot;, &quot;git.exe&quot;]</span>

<span class="s1">    out, rc = run_command(GITS, [&quot;rev-parse&quot;, &quot;--git-dir&quot;], cwd=root,</span>
<span class="s1">                          hide_stderr=True)</span>
<span class="s1">    if rc != 0:</span>
<span class="s1">        if verbose:</span>
<span class="s1">            print(&quot;Directory </span><span class="si">%%</span><span class="s1">s not under git control&quot; </span><span class="si">%%</span><span class="s1"> root)</span>
<span class="s1">        raise NotThisMethod(&quot;&#39;git rev-parse --git-dir&#39; returned error&quot;)</span>

<span class="s1">    # if there is a tag matching tag_prefix, this yields TAG-NUM-gHEX[-dirty]</span>
<span class="s1">    # if there isn&#39;t one, this yields HEX[-dirty] (no NUM)</span>
<span class="s1">    describe_out, rc = run_command(GITS, [&quot;describe&quot;, &quot;--tags&quot;, &quot;--dirty&quot;,</span>
<span class="s1">                                          &quot;--always&quot;, &quot;--long&quot;,</span>
<span class="s1">                                          &quot;--match&quot;, &quot;</span><span class="si">%%</span><span class="s1">s*&quot; </span><span class="si">%%</span><span class="s1"> tag_prefix],</span>
<span class="s1">                                   cwd=root)</span>
<span class="s1">    # --long was added in git-1.5.5</span>
<span class="s1">    if describe_out is None:</span>
<span class="s1">        raise NotThisMethod(&quot;&#39;git describe&#39; failed&quot;)</span>
<span class="s1">    describe_out = describe_out.strip()</span>
<span class="s1">    full_out, rc = run_command(GITS, [&quot;rev-parse&quot;, &quot;HEAD&quot;], cwd=root)</span>
<span class="s1">    if full_out is None:</span>
<span class="s1">        raise NotThisMethod(&quot;&#39;git rev-parse&#39; failed&quot;)</span>
<span class="s1">    full_out = full_out.strip()</span>

<span class="s1">    pieces = </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">    pieces[&quot;long&quot;] = full_out</span>
<span class="s1">    pieces[&quot;short&quot;] = full_out[:7]  # maybe improved later</span>
<span class="s1">    pieces[&quot;error&quot;] = None</span>

<span class="s1">    # parse describe_out. It will be like TAG-NUM-gHEX[-dirty] or HEX[-dirty]</span>
<span class="s1">    # TAG might have hyphens.</span>
<span class="s1">    git_describe = describe_out</span>

<span class="s1">    # look for -dirty suffix</span>
<span class="s1">    dirty = git_describe.endswith(&quot;-dirty&quot;)</span>
<span class="s1">    pieces[&quot;dirty&quot;] = dirty</span>
<span class="s1">    if dirty:</span>
<span class="s1">        git_describe = git_describe[:git_describe.rindex(&quot;-dirty&quot;)]</span>

<span class="s1">    # now we have TAG-NUM-gHEX or HEX</span>

<span class="s1">    if &quot;-&quot; in git_describe:</span>
<span class="s1">        # TAG-NUM-gHEX</span>
<span class="s1">        mo = re.search(r&#39;^(.+)-(\d+)-g([0-9a-f]+)$&#39;, git_describe)</span>
<span class="s1">        if not mo:</span>
<span class="s1">            # unparseable. Maybe git-describe is misbehaving?</span>
<span class="s1">            pieces[&quot;error&quot;] = (&quot;unable to parse git-describe output: &#39;</span><span class="si">%%</span><span class="s1">s&#39;&quot;</span>
<span class="s1">                               </span><span class="si">%%</span><span class="s1"> describe_out)</span>
<span class="s1">            return pieces</span>

<span class="s1">        # tag</span>
<span class="s1">        full_tag = mo.group(1)</span>
<span class="s1">        if not full_tag.startswith(tag_prefix):</span>
<span class="s1">            if verbose:</span>
<span class="s1">                fmt = &quot;tag &#39;</span><span class="si">%%</span><span class="s1">s&#39; doesn&#39;t start with prefix &#39;</span><span class="si">%%</span><span class="s1">s&#39;&quot;</span>
<span class="s1">                print(fmt </span><span class="si">%%</span><span class="s1"> (full_tag, tag_prefix))</span>
<span class="s1">            pieces[&quot;error&quot;] = (&quot;tag &#39;</span><span class="si">%%</span><span class="s1">s&#39; doesn&#39;t start with prefix &#39;</span><span class="si">%%</span><span class="s1">s&#39;&quot;</span>
<span class="s1">                               </span><span class="si">%%</span><span class="s1"> (full_tag, tag_prefix))</span>
<span class="s1">            return pieces</span>
<span class="s1">        pieces[&quot;closest-tag&quot;] = full_tag[len(tag_prefix):]</span>

<span class="s1">        # distance: number of commits since tag</span>
<span class="s1">        pieces[&quot;distance&quot;] = int(mo.group(2))</span>

<span class="s1">        # commit: short hex revision ID</span>
<span class="s1">        pieces[&quot;short&quot;] = mo.group(3)</span>

<span class="s1">    else:</span>
<span class="s1">        # HEX: no tags</span>
<span class="s1">        pieces[&quot;closest-tag&quot;] = None</span>
<span class="s1">        count_out, rc = run_command(GITS, [&quot;rev-list&quot;, &quot;HEAD&quot;, &quot;--count&quot;],</span>
<span class="s1">                                    cwd=root)</span>
<span class="s1">        pieces[&quot;distance&quot;] = int(count_out)  # total number of commits</span>

<span class="s1">    # commit date: see ISO-8601 comment in git_versions_from_keywords()</span>
<span class="s1">    date = run_command(GITS, [&quot;show&quot;, &quot;-s&quot;, &quot;--format=</span><span class="si">%%</span><span class="s1">ci&quot;, &quot;HEAD&quot;],</span>
<span class="s1">                       cwd=root)[0].strip()</span>
<span class="s1">    pieces[&quot;date&quot;] = date.strip().replace(&quot; &quot;, &quot;T&quot;, 1).replace(&quot; &quot;, &quot;&quot;, 1)</span>

<span class="s1">    return pieces</span>


<span class="s1">def plus_or_dot(pieces):</span>
<span class="s1">    &quot;&quot;&quot;Return a + if we don&#39;t already have one, else return a .&quot;&quot;&quot;</span>
<span class="s1">    if &quot;+&quot; in pieces.get(&quot;closest-tag&quot;, &quot;&quot;):</span>
<span class="s1">        return &quot;.&quot;</span>
<span class="s1">    return &quot;+&quot;</span>


<span class="s1">def render_pep440(pieces):</span>
<span class="s1">    &quot;&quot;&quot;Build up version string, with post-release &quot;local version identifier&quot;.</span>

<span class="s1">    Our goal: TAG[+DISTANCE.gHEX[.dirty]] . Note that if you</span>
<span class="s1">    get a tagged build and then dirty it, you&#39;ll get TAG+0.gHEX.dirty</span>

<span class="s1">    Exceptions:</span>
<span class="s1">    1: no tags. git_describe was just HEX. 0+untagged.DISTANCE.gHEX[.dirty]</span>
<span class="s1">    &quot;&quot;&quot;</span>
<span class="s1">    if pieces[&quot;closest-tag&quot;]:</span>
<span class="s1">        rendered = pieces[&quot;closest-tag&quot;]</span>
<span class="s1">        if pieces[&quot;distance&quot;] or pieces[&quot;dirty&quot;]:</span>
<span class="s1">            rendered += plus_or_dot(pieces)</span>
<span class="s1">            rendered += &quot;</span><span class="si">%%</span><span class="s1">d.g</span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> (pieces[&quot;distance&quot;], pieces[&quot;short&quot;])</span>
<span class="s1">            if pieces[&quot;dirty&quot;]:</span>
<span class="s1">                rendered += &quot;.dirty&quot;</span>
<span class="s1">    else:</span>
<span class="s1">        # exception #1</span>
<span class="s1">        rendered = &quot;0+untagged.</span><span class="si">%%</span><span class="s1">d.g</span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> (pieces[&quot;distance&quot;],</span>
<span class="s1">                                          pieces[&quot;short&quot;])</span>
<span class="s1">        if pieces[&quot;dirty&quot;]:</span>
<span class="s1">            rendered += &quot;.dirty&quot;</span>
<span class="s1">    return rendered</span>


<span class="s1">def render_pep440_pre(pieces):</span>
<span class="s1">    &quot;&quot;&quot;TAG[.post.devDISTANCE] -- No -dirty.</span>

<span class="s1">    Exceptions:</span>
<span class="s1">    1: no tags. 0.post.devDISTANCE</span>
<span class="s1">    &quot;&quot;&quot;</span>
<span class="s1">    if pieces[&quot;closest-tag&quot;]:</span>
<span class="s1">        rendered = pieces[&quot;closest-tag&quot;]</span>
<span class="s1">        if pieces[&quot;distance&quot;]:</span>
<span class="s1">            rendered += &quot;.post.dev</span><span class="si">%%</span><span class="s1">d&quot; </span><span class="si">%%</span><span class="s1"> pieces[&quot;distance&quot;]</span>
<span class="s1">    else:</span>
<span class="s1">        # exception #1</span>
<span class="s1">        rendered = &quot;0.post.dev</span><span class="si">%%</span><span class="s1">d&quot; </span><span class="si">%%</span><span class="s1"> pieces[&quot;distance&quot;]</span>
<span class="s1">    return rendered</span>


<span class="s1">def render_pep440_post(pieces):</span>
<span class="s1">    &quot;&quot;&quot;TAG[.postDISTANCE[.dev0]+gHEX] .</span>

<span class="s1">    The &quot;.dev0&quot; means dirty. Note that .dev0 sorts backwards</span>
<span class="s1">    (a dirty tree will appear &quot;older&quot; than the corresponding clean one),</span>
<span class="s1">    but you shouldn&#39;t be releasing software with -dirty anyways.</span>

<span class="s1">    Exceptions:</span>
<span class="s1">    1: no tags. 0.postDISTANCE[.dev0]</span>
<span class="s1">    &quot;&quot;&quot;</span>
<span class="s1">    if pieces[&quot;closest-tag&quot;]:</span>
<span class="s1">        rendered = pieces[&quot;closest-tag&quot;]</span>
<span class="s1">        if pieces[&quot;distance&quot;] or pieces[&quot;dirty&quot;]:</span>
<span class="s1">            rendered += &quot;.post</span><span class="si">%%</span><span class="s1">d&quot; </span><span class="si">%%</span><span class="s1"> pieces[&quot;distance&quot;]</span>
<span class="s1">            if pieces[&quot;dirty&quot;]:</span>
<span class="s1">                rendered += &quot;.dev0&quot;</span>
<span class="s1">            rendered += plus_or_dot(pieces)</span>
<span class="s1">            rendered += &quot;g</span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> pieces[&quot;short&quot;]</span>
<span class="s1">    else:</span>
<span class="s1">        # exception #1</span>
<span class="s1">        rendered = &quot;0.post</span><span class="si">%%</span><span class="s1">d&quot; </span><span class="si">%%</span><span class="s1"> pieces[&quot;distance&quot;]</span>
<span class="s1">        if pieces[&quot;dirty&quot;]:</span>
<span class="s1">            rendered += &quot;.dev0&quot;</span>
<span class="s1">        rendered += &quot;+g</span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> pieces[&quot;short&quot;]</span>
<span class="s1">    return rendered</span>


<span class="s1">def render_pep440_old(pieces):</span>
<span class="s1">    &quot;&quot;&quot;TAG[.postDISTANCE[.dev0]] .</span>

<span class="s1">    The &quot;.dev0&quot; means dirty.</span>

<span class="s1">    Eexceptions:</span>
<span class="s1">    1: no tags. 0.postDISTANCE[.dev0]</span>
<span class="s1">    &quot;&quot;&quot;</span>
<span class="s1">    if pieces[&quot;closest-tag&quot;]:</span>
<span class="s1">        rendered = pieces[&quot;closest-tag&quot;]</span>
<span class="s1">        if pieces[&quot;distance&quot;] or pieces[&quot;dirty&quot;]:</span>
<span class="s1">            rendered += &quot;.post</span><span class="si">%%</span><span class="s1">d&quot; </span><span class="si">%%</span><span class="s1"> pieces[&quot;distance&quot;]</span>
<span class="s1">            if pieces[&quot;dirty&quot;]:</span>
<span class="s1">                rendered += &quot;.dev0&quot;</span>
<span class="s1">    else:</span>
<span class="s1">        # exception #1</span>
<span class="s1">        rendered = &quot;0.post</span><span class="si">%%</span><span class="s1">d&quot; </span><span class="si">%%</span><span class="s1"> pieces[&quot;distance&quot;]</span>
<span class="s1">        if pieces[&quot;dirty&quot;]:</span>
<span class="s1">            rendered += &quot;.dev0&quot;</span>
<span class="s1">    return rendered</span>


<span class="s1">def render_git_describe(pieces):</span>
<span class="s1">    &quot;&quot;&quot;TAG[-DISTANCE-gHEX][-dirty].</span>

<span class="s1">    Like &#39;git describe --tags --dirty --always&#39;.</span>

<span class="s1">    Exceptions:</span>
<span class="s1">    1: no tags. HEX[-dirty]  (note: no &#39;g&#39; prefix)</span>
<span class="s1">    &quot;&quot;&quot;</span>
<span class="s1">    if pieces[&quot;closest-tag&quot;]:</span>
<span class="s1">        rendered = pieces[&quot;closest-tag&quot;]</span>
<span class="s1">        if pieces[&quot;distance&quot;]:</span>
<span class="s1">            rendered += &quot;-</span><span class="si">%%</span><span class="s1">d-g</span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> (pieces[&quot;distance&quot;], pieces[&quot;short&quot;])</span>
<span class="s1">    else:</span>
<span class="s1">        # exception #1</span>
<span class="s1">        rendered = pieces[&quot;short&quot;]</span>
<span class="s1">    if pieces[&quot;dirty&quot;]:</span>
<span class="s1">        rendered += &quot;-dirty&quot;</span>
<span class="s1">    return rendered</span>


<span class="s1">def render_git_describe_long(pieces):</span>
<span class="s1">    &quot;&quot;&quot;TAG-DISTANCE-gHEX[-dirty].</span>

<span class="s1">    Like &#39;git describe --tags --dirty --always -long&#39;.</span>
<span class="s1">    The distance/hash is unconditional.</span>

<span class="s1">    Exceptions:</span>
<span class="s1">    1: no tags. HEX[-dirty]  (note: no &#39;g&#39; prefix)</span>
<span class="s1">    &quot;&quot;&quot;</span>
<span class="s1">    if pieces[&quot;closest-tag&quot;]:</span>
<span class="s1">        rendered = pieces[&quot;closest-tag&quot;]</span>
<span class="s1">        rendered += &quot;-</span><span class="si">%%</span><span class="s1">d-g</span><span class="si">%%</span><span class="s1">s&quot; </span><span class="si">%%</span><span class="s1"> (pieces[&quot;distance&quot;], pieces[&quot;short&quot;])</span>
<span class="s1">    else:</span>
<span class="s1">        # exception #1</span>
<span class="s1">        rendered = pieces[&quot;short&quot;]</span>
<span class="s1">    if pieces[&quot;dirty&quot;]:</span>
<span class="s1">        rendered += &quot;-dirty&quot;</span>
<span class="s1">    return rendered</span>


<span class="s1">def render(pieces, style):</span>
<span class="s1">    &quot;&quot;&quot;Render the given version pieces into the requested style.&quot;&quot;&quot;</span>
<span class="s1">    if pieces[&quot;error&quot;]:</span>
<span class="s1">        return {&quot;version&quot;: &quot;unknown&quot;,</span>
<span class="s1">                &quot;full-revisionid&quot;: pieces.get(&quot;long&quot;),</span>
<span class="s1">                &quot;dirty&quot;: None,</span>
<span class="s1">                &quot;error&quot;: pieces[&quot;error&quot;],</span>
<span class="s1">                &quot;date&quot;: None}</span>

<span class="s1">    if not style or style == &quot;default&quot;:</span>
<span class="s1">        style = &quot;pep440&quot;  # the default</span>

<span class="s1">    if style == &quot;pep440&quot;:</span>
<span class="s1">        rendered = render_pep440(pieces)</span>
<span class="s1">    elif style == &quot;pep440-pre&quot;:</span>
<span class="s1">        rendered = render_pep440_pre(pieces)</span>
<span class="s1">    elif style == &quot;pep440-post&quot;:</span>
<span class="s1">        rendered = render_pep440_post(pieces)</span>
<span class="s1">    elif style == &quot;pep440-old&quot;:</span>
<span class="s1">        rendered = render_pep440_old(pieces)</span>
<span class="s1">    elif style == &quot;git-describe&quot;:</span>
<span class="s1">        rendered = render_git_describe(pieces)</span>
<span class="s1">    elif style == &quot;git-describe-long&quot;:</span>
<span class="s1">        rendered = render_git_describe_long(pieces)</span>
<span class="s1">    else:</span>
<span class="s1">        raise ValueError(&quot;unknown style &#39;</span><span class="si">%%</span><span class="s1">s&#39;&quot; </span><span class="si">%%</span><span class="s1"> style)</span>

<span class="s1">    return {&quot;version&quot;: rendered, &quot;full-revisionid&quot;: pieces[&quot;long&quot;],</span>
<span class="s1">            &quot;dirty&quot;: pieces[&quot;dirty&quot;], &quot;error&quot;: None,</span>
<span class="s1">            &quot;date&quot;: pieces.get(&quot;date&quot;)}</span>


<span class="s1">def get_versions():</span>
<span class="s1">    &quot;&quot;&quot;Get version information or return default if unable to do so.&quot;&quot;&quot;</span>
<span class="s1">    # I am in _version.py, which lives at ROOT/VERSIONFILE_SOURCE. If we have</span>
<span class="s1">    # __file__, we can work backwards from there to the root. Some</span>
<span class="s1">    # py2exe/bbfreeze/non-CPython implementations don&#39;t do __file__, in which</span>
<span class="s1">    # case we can only use expanded keywords.</span>

<span class="s1">    cfg = get_config()</span>
<span class="s1">    verbose = cfg.verbose</span>

<span class="s1">    try:</span>
<span class="s1">        return git_versions_from_keywords(get_keywords(), cfg.tag_prefix,</span>
<span class="s1">                                          verbose)</span>
<span class="s1">    except NotThisMethod:</span>
<span class="s1">        pass</span>

<span class="s1">    try:</span>
<span class="s1">        root = os.path.realpath(__file__)</span>
<span class="s1">        # versionfile_source is the relative path from the top of the source</span>
<span class="s1">        # tree (where the .git directory might live) to this file. Invert</span>
<span class="s1">        # this to find the root from __file__.</span>
<span class="s1">        for i in cfg.versionfile_source.split(&#39;/&#39;):</span>
<span class="s1">            root = os.path.dirname(root)</span>
<span class="s1">    except NameError:</span>
<span class="s1">        return {&quot;version&quot;: &quot;0+unknown&quot;, &quot;full-revisionid&quot;: None,</span>
<span class="s1">                &quot;dirty&quot;: None,</span>
<span class="s1">                &quot;error&quot;: &quot;unable to find root of source tree&quot;,</span>
<span class="s1">                &quot;date&quot;: None}</span>

<span class="s1">    try:</span>
<span class="s1">        pieces = git_pieces_from_vcs(cfg.tag_prefix, root, verbose)</span>
<span class="s1">        return render(pieces, cfg.style)</span>
<span class="s1">    except NotThisMethod:</span>
<span class="s1">        pass</span>

<span class="s1">    try:</span>
<span class="s1">        if cfg.parentdir_prefix:</span>
<span class="s1">            return versions_from_parentdir(cfg.parentdir_prefix, root, verbose)</span>
<span class="s1">    except NotThisMethod:</span>
<span class="s1">        pass</span>

<span class="s1">    return {&quot;version&quot;: &quot;0+unknown&quot;, &quot;full-revisionid&quot;: None,</span>
<span class="s1">            &quot;dirty&quot;: None,</span>
<span class="s1">            &quot;error&quot;: &quot;unable to compute version&quot;, &quot;date&quot;: None}</span>
<span class="s1">&#39;&#39;&#39;</span>


<div class="viewcode-block" id="git_get_keywords"><a class="viewcode-back" href="../api/versioneer.html#versioneer.git_get_keywords">[docs]</a><span class="nd">@register_vcs_handler</span><span class="p">(</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;get_keywords&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">git_get_keywords</span><span class="p">(</span><span class="n">versionfile_abs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract version information from the given file.&quot;&quot;&quot;</span>
    <span class="c1"># the code embedded in _version.py can just fetch the value of these</span>
    <span class="c1"># keywords. When used from setup.py, we don&#39;t want to import _version.py,</span>
    <span class="c1"># so we do it with a regexp instead. This function is not used from</span>
    <span class="c1"># _version.py.</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">versionfile_abs</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;git_refnames =&quot;</span><span class="p">):</span>
                <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;=\s*&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;refnames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;git_full =&quot;</span><span class="p">):</span>
                <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;=\s*&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;full&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;git_date =&quot;</span><span class="p">):</span>
                <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;=\s*&quot;(.*)&quot;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mo</span><span class="p">:</span>
                    <span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">keywords</span></div>


<div class="viewcode-block" id="git_versions_from_keywords"><a class="viewcode-back" href="../api/versioneer.html#versioneer.git_versions_from_keywords">[docs]</a><span class="nd">@register_vcs_handler</span><span class="p">(</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;keywords&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">git_versions_from_keywords</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="n">tag_prefix</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get version information from git keywords.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">keywords</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotThisMethod</span><span class="p">(</span><span class="s2">&quot;no keywords at all, weird&quot;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">keywords</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># git-2.2.0 added &quot;%cI&quot;, which expands to an ISO-8601 -compliant</span>
        <span class="c1"># datestamp. However we prefer &quot;%ci&quot; (which expands to an &quot;ISO-8601</span>
        <span class="c1"># -like&quot; string, which we must then edit to make compliant), because</span>
        <span class="c1"># it&#39;s been around since git-1.5.3, and it&#39;s too difficult to</span>
        <span class="c1"># discover which version we&#39;re using, or to work around using an</span>
        <span class="c1"># older one.</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">refnames</span> <span class="o">=</span> <span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;refnames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">refnames</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;$Format&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;keywords are unexpanded, not using&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NotThisMethod</span><span class="p">(</span><span class="s2">&quot;unexpanded keywords, not a git-archive tarball&quot;</span><span class="p">)</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refnames</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;()&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)])</span>
    <span class="c1"># starting in git-1.8.3, tags are listed as &quot;tag: foo-1.0&quot; instead of</span>
    <span class="c1"># just &quot;foo-1.0&quot;. If we see a &quot;tag: &quot; prefix, prefer those.</span>
    <span class="n">TAG</span> <span class="o">=</span> <span class="s2">&quot;tag: &quot;</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">TAG</span><span class="p">):]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">TAG</span><span class="p">)])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
        <span class="c1"># Either we&#39;re using git &lt; 1.8.3, or there really are no tags. We use</span>
        <span class="c1"># a heuristic: assume all version tags have a digit. The old git %d</span>
        <span class="c1"># expansion behaves like git log --decorate=short and strips out the</span>
        <span class="c1"># refs/heads/ and refs/tags/ prefixes that would let us distinguish</span>
        <span class="c1"># between branches and tags. By ignoring refnames without digits, we</span>
        <span class="c1"># filter out many common branch names like &quot;release&quot; and</span>
        <span class="c1"># &quot;stabilization&quot;, as well as &quot;HEAD&quot; and &quot;master&quot;.</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;discarding &#39;</span><span class="si">%s</span><span class="s2">&#39;, no digits&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">refs</span> <span class="o">-</span> <span class="n">tags</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;likely tags: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">tags</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tags</span><span class="p">):</span>
        <span class="c1"># sorting will prefer e.g. &quot;2.0&quot; over &quot;2.0rc1&quot;</span>
        <span class="k">if</span> <span class="n">ref</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">):]</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;picking </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">r</span><span class="p">,</span>
                    <span class="s2">&quot;full-revisionid&quot;</span><span class="p">:</span> <span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                    <span class="s2">&quot;dirty&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="p">}</span>
    <span class="c1"># no suitable tags, so version is &quot;0+unknown&quot;, but full hex is still there</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no suitable tags, using unknown + full revision id&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0+unknown&quot;</span><span class="p">,</span>
            <span class="s2">&quot;full-revisionid&quot;</span><span class="p">:</span> <span class="n">keywords</span><span class="p">[</span><span class="s2">&quot;full&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="s2">&quot;dirty&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;no suitable tags&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span></div>


<div class="viewcode-block" id="git_pieces_from_vcs"><a class="viewcode-back" href="../api/versioneer.html#versioneer.git_pieces_from_vcs">[docs]</a><span class="nd">@register_vcs_handler</span><span class="p">(</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;pieces_from_vcs&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">git_pieces_from_vcs</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">run_command</span><span class="o">=</span><span class="n">run_command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get version from &#39;git describe&#39; in the root of the source tree.</span>

<span class="sd">    This only gets called if the git-archive &#39;subst&#39; keywords were *not*</span>
<span class="sd">    expanded, and _version.py hasn&#39;t already been rewritten with a short</span>
<span class="sd">    version string, meaning we&#39;re inside a checked out source tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">GITS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
        <span class="n">GITS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;git.cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;git.exe&quot;</span><span class="p">]</span>

    <span class="n">out</span><span class="p">,</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;rev-parse&quot;</span><span class="p">,</span> <span class="s2">&quot;--git-dir&quot;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
                          <span class="n">hide_stderr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Directory </span><span class="si">%s</span><span class="s2"> not under git control&quot;</span> <span class="o">%</span> <span class="n">root</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NotThisMethod</span><span class="p">(</span><span class="s2">&quot;&#39;git rev-parse --git-dir&#39; returned error&quot;</span><span class="p">)</span>

    <span class="c1"># if there is a tag matching tag_prefix, this yields TAG-NUM-gHEX[-dirty]</span>
    <span class="c1"># if there isn&#39;t one, this yields HEX[-dirty] (no NUM)</span>
    <span class="n">describe_out</span><span class="p">,</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;describe&quot;</span><span class="p">,</span> <span class="s2">&quot;--tags&quot;</span><span class="p">,</span> <span class="s2">&quot;--dirty&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;--always&quot;</span><span class="p">,</span> <span class="s2">&quot;--long&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;--match&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">*&quot;</span> <span class="o">%</span> <span class="n">tag_prefix</span><span class="p">],</span>
                                   <span class="n">cwd</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="c1"># --long was added in git-1.5.5</span>
    <span class="k">if</span> <span class="n">describe_out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotThisMethod</span><span class="p">(</span><span class="s2">&quot;&#39;git describe&#39; failed&quot;</span><span class="p">)</span>
    <span class="n">describe_out</span> <span class="o">=</span> <span class="n">describe_out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">full_out</span><span class="p">,</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;rev-parse&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">],</span> <span class="n">cwd</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">full_out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotThisMethod</span><span class="p">(</span><span class="s2">&quot;&#39;git rev-parse&#39; failed&quot;</span><span class="p">)</span>
    <span class="n">full_out</span> <span class="o">=</span> <span class="n">full_out</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">pieces</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;long&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_out</span>
    <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_out</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># maybe improved later</span>
    <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># parse describe_out. It will be like TAG-NUM-gHEX[-dirty] or HEX[-dirty]</span>
    <span class="c1"># TAG might have hyphens.</span>
    <span class="n">git_describe</span> <span class="o">=</span> <span class="n">describe_out</span>

    <span class="c1"># look for -dirty suffix</span>
    <span class="n">dirty</span> <span class="o">=</span> <span class="n">git_describe</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;-dirty&quot;</span><span class="p">)</span>
    <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dirty</span>
    <span class="k">if</span> <span class="n">dirty</span><span class="p">:</span>
        <span class="n">git_describe</span> <span class="o">=</span> <span class="n">git_describe</span><span class="p">[:</span><span class="n">git_describe</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s2">&quot;-dirty&quot;</span><span class="p">)]</span>

    <span class="c1"># now we have TAG-NUM-gHEX or HEX</span>

    <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">git_describe</span><span class="p">:</span>
        <span class="c1"># TAG-NUM-gHEX</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(.+)-(\d+)-g([0-9a-f]+)$&#39;</span><span class="p">,</span> <span class="n">git_describe</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
            <span class="c1"># unparseable. Maybe git-describe is misbehaving?</span>
            <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;unable to parse git-describe output: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                               <span class="o">%</span> <span class="n">describe_out</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pieces</span>

        <span class="c1"># tag</span>
        <span class="n">full_tag</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">full_tag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;tag &#39;</span><span class="si">%s</span><span class="s2">&#39; doesn&#39;t start with prefix &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">full_tag</span><span class="p">,</span> <span class="n">tag_prefix</span><span class="p">))</span>
            <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;tag &#39;</span><span class="si">%s</span><span class="s2">&#39; doesn&#39;t start with prefix &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">full_tag</span><span class="p">,</span> <span class="n">tag_prefix</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">pieces</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_tag</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tag_prefix</span><span class="p">):]</span>

        <span class="c1"># distance: number of commits since tag</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

        <span class="c1"># commit: short hex revision ID</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># HEX: no tags</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">count_out</span><span class="p">,</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;rev-list&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">,</span> <span class="s2">&quot;--count&quot;</span><span class="p">],</span>
                                    <span class="n">cwd</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">count_out</span><span class="p">)</span>  <span class="c1"># total number of commits</span>

    <span class="c1"># commit date: see ISO-8601 comment in git_versions_from_keywords()</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;show&quot;</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--format=</span><span class="si">%c</span><span class="s2">i&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">],</span>
                       <span class="n">cwd</span><span class="o">=</span><span class="n">root</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pieces</span></div>


<div class="viewcode-block" id="do_vcs_install"><a class="viewcode-back" href="../api/versioneer.html#versioneer.do_vcs_install">[docs]</a><span class="k">def</span> <span class="nf">do_vcs_install</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="n">versionfile_source</span><span class="p">,</span> <span class="n">ipy</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Git-specific installation logic for Versioneer.</span>

<span class="sd">    For Git, this means creating/changing .gitattributes to mark _version.py</span>
<span class="sd">    for export-subst keyword substitution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">GITS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
        <span class="n">GITS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;git.cmd&quot;</span><span class="p">,</span> <span class="s2">&quot;git.exe&quot;</span><span class="p">]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">manifest_in</span><span class="p">,</span> <span class="n">versionfile_source</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ipy</span><span class="p">:</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ipy</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">me</span> <span class="o">=</span> <span class="vm">__file__</span>
        <span class="k">if</span> <span class="n">me</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pyc&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">me</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pyo&quot;</span><span class="p">):</span>
            <span class="n">me</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">me</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.py&quot;</span>
        <span class="n">versioneer_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="n">versioneer_file</span> <span class="o">=</span> <span class="s2">&quot;versioneer.py&quot;</span>
    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">versioneer_file</span><span class="p">)</span>
    <span class="n">present</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;.gitattributes&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">versionfile_source</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;export-subst&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">present</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">present</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;.gitattributes&quot;</span><span class="p">,</span> <span class="s2">&quot;a+&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> export-subst</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">versionfile_source</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;.gitattributes&quot;</span><span class="p">)</span>
    <span class="n">run_command</span><span class="p">(</span><span class="n">GITS</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">files</span><span class="p">)</span></div>


<div class="viewcode-block" id="versions_from_parentdir"><a class="viewcode-back" href="../api/versioneer.html#versioneer.versions_from_parentdir">[docs]</a><span class="k">def</span> <span class="nf">versions_from_parentdir</span><span class="p">(</span><span class="n">parentdir_prefix</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Try to determine the version from the parent directory name.</span>

<span class="sd">    Source tarballs conventionally unpack into a directory that includes both</span>
<span class="sd">    the project name and a version string. We will also support searching up</span>
<span class="sd">    two directory levels for an appropriately named parent directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rootdirs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dirname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">parentdir_prefix</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">dirname</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">parentdir_prefix</span><span class="p">):],</span>
                    <span class="s2">&quot;full-revisionid&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;dirty&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rootdirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>  <span class="c1"># up a level</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tried directories </span><span class="si">%s</span><span class="s2"> but none started with prefix </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
              <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rootdirs</span><span class="p">),</span> <span class="n">parentdir_prefix</span><span class="p">))</span>
    <span class="k">raise</span> <span class="n">NotThisMethod</span><span class="p">(</span><span class="s2">&quot;rootdir doesn&#39;t start with parentdir_prefix&quot;</span><span class="p">)</span></div>


<span class="n">SHORT_VERSION_PY</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># This file was generated by &#39;versioneer.py&#39; (0.18) from</span>
<span class="s2"># revision-control system data, or from the parent directory name of an</span>
<span class="s2"># unpacked source archive. Distribution tarballs contain a pre-generated copy</span>
<span class="s2"># of this file.</span>

<span class="s2">import json</span>

<span class="s2">version_json = &#39;&#39;&#39;</span>
<span class="si">%s</span><span class="s2"></span>
<span class="s2">&#39;&#39;&#39;  # END VERSION_JSON</span>


<span class="s2">def get_versions():</span>
<span class="s2">    return json.loads(version_json)</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="versions_from_file"><a class="viewcode-back" href="../api/versioneer.html#versioneer.versions_from_file">[docs]</a><span class="k">def</span> <span class="nf">versions_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Try to determine the version from _version.py if present.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotThisMethod</span><span class="p">(</span><span class="s2">&quot;unable to read _version.py&quot;</span><span class="p">)</span>
    <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;version_json = &#39;&#39;&#39;\n(.*)&#39;&#39;&#39;  # END VERSION_JSON&quot;</span><span class="p">,</span>
                   <span class="n">contents</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
        <span class="n">mo</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;version_json = &#39;&#39;&#39;\r\n(.*)&#39;&#39;&#39;  # END VERSION_JSON&quot;</span><span class="p">,</span>
                       <span class="n">contents</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mo</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">NotThisMethod</span><span class="p">(</span><span class="s2">&quot;no version_json in _version.py&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">mo</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="write_to_version_file"><a class="viewcode-back" href="../api/versioneer.html#versioneer.write_to_version_file">[docs]</a><span class="k">def</span> <span class="nf">write_to_version_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">versions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write the given version number to the given _version.py file.&quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">versions</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;: &quot;</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SHORT_VERSION_PY</span> <span class="o">%</span> <span class="n">contents</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;set </span><span class="si">%s</span><span class="s2"> to &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">versions</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]))</span></div>


<div class="viewcode-block" id="plus_or_dot"><a class="viewcode-back" href="../api/versioneer.html#versioneer.plus_or_dot">[docs]</a><span class="k">def</span> <span class="nf">plus_or_dot</span><span class="p">(</span><span class="n">pieces</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a + if we don&#39;t already have one, else return a .&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">pieces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;.&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;+&quot;</span></div>


<div class="viewcode-block" id="render_pep440"><a class="viewcode-back" href="../api/versioneer.html#versioneer.render_pep440">[docs]</a><span class="k">def</span> <span class="nf">render_pep440</span><span class="p">(</span><span class="n">pieces</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build up version string, with post-release &quot;local version identifier&quot;.</span>

<span class="sd">    Our goal: TAG[+DISTANCE.gHEX[.dirty]] . Note that if you</span>
<span class="sd">    get a tagged build and then dirty it, you&#39;ll get TAG+0.gHEX.dirty</span>

<span class="sd">    Exceptions:</span>
<span class="sd">    1: no tags. git_describe was just HEX. 0+untagged.DISTANCE.gHEX[.dirty]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="n">plus_or_dot</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.g</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
                <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.dirty&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exception #1</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="s2">&quot;0+untagged.</span><span class="si">%d</span><span class="s2">.g</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span>
                                          <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.dirty&quot;</span>
    <span class="k">return</span> <span class="n">rendered</span></div>


<div class="viewcode-block" id="render_pep440_pre"><a class="viewcode-back" href="../api/versioneer.html#versioneer.render_pep440_pre">[docs]</a><span class="k">def</span> <span class="nf">render_pep440_pre</span><span class="p">(</span><span class="n">pieces</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TAG[.post.devDISTANCE] -- No -dirty.</span>

<span class="sd">    Exceptions:</span>
<span class="sd">    1: no tags. 0.post.devDISTANCE</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]:</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.post.dev</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exception #1</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="s2">&quot;0.post.dev</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">rendered</span></div>


<div class="viewcode-block" id="render_pep440_post"><a class="viewcode-back" href="../api/versioneer.html#versioneer.render_pep440_post">[docs]</a><span class="k">def</span> <span class="nf">render_pep440_post</span><span class="p">(</span><span class="n">pieces</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TAG[.postDISTANCE[.dev0]+gHEX] .</span>

<span class="sd">    The &quot;.dev0&quot; means dirty. Note that .dev0 sorts backwards</span>
<span class="sd">    (a dirty tree will appear &quot;older&quot; than the corresponding clean one),</span>
<span class="sd">    but you shouldn&#39;t be releasing software with -dirty anyways.</span>

<span class="sd">    Exceptions:</span>
<span class="sd">    1: no tags. 0.postDISTANCE[.dev0]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.post</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
                <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.dev0&quot;</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="n">plus_or_dot</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;g</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exception #1</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="s2">&quot;0.post</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.dev0&quot;</span>
        <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;+g</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">rendered</span></div>


<div class="viewcode-block" id="render_pep440_old"><a class="viewcode-back" href="../api/versioneer.html#versioneer.render_pep440_old">[docs]</a><span class="k">def</span> <span class="nf">render_pep440_old</span><span class="p">(</span><span class="n">pieces</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TAG[.postDISTANCE[.dev0]] .</span>

<span class="sd">    The &quot;.dev0&quot; means dirty.</span>

<span class="sd">    Eexceptions:</span>
<span class="sd">    1: no tags. 0.postDISTANCE[.dev0]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.post</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
                <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.dev0&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exception #1</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="s2">&quot;0.post</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;.dev0&quot;</span>
    <span class="k">return</span> <span class="n">rendered</span></div>


<div class="viewcode-block" id="render_git_describe"><a class="viewcode-back" href="../api/versioneer.html#versioneer.render_git_describe">[docs]</a><span class="k">def</span> <span class="nf">render_git_describe</span><span class="p">(</span><span class="n">pieces</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TAG[-DISTANCE-gHEX][-dirty].</span>

<span class="sd">    Like &#39;git describe --tags --dirty --always&#39;.</span>

<span class="sd">    Exceptions:</span>
<span class="sd">    1: no tags. HEX[-dirty]  (note: no &#39;g&#39; prefix)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]:</span>
            <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;-</span><span class="si">%d</span><span class="s2">-g</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exception #1</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
        <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;-dirty&quot;</span>
    <span class="k">return</span> <span class="n">rendered</span></div>


<div class="viewcode-block" id="render_git_describe_long"><a class="viewcode-back" href="../api/versioneer.html#versioneer.render_git_describe_long">[docs]</a><span class="k">def</span> <span class="nf">render_git_describe_long</span><span class="p">(</span><span class="n">pieces</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TAG-DISTANCE-gHEX[-dirty].</span>

<span class="sd">    Like &#39;git describe --tags --dirty --always -long&#39;.</span>
<span class="sd">    The distance/hash is unconditional.</span>

<span class="sd">    Exceptions:</span>
<span class="sd">    1: no tags. HEX[-dirty]  (note: no &#39;g&#39; prefix)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;closest-tag&quot;</span><span class="p">]</span>
        <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;-</span><span class="si">%d</span><span class="s2">-g</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exception #1</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;short&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">]:</span>
        <span class="n">rendered</span> <span class="o">+=</span> <span class="s2">&quot;-dirty&quot;</span>
    <span class="k">return</span> <span class="n">rendered</span></div>


<div class="viewcode-block" id="render"><a class="viewcode-back" href="../api/versioneer.html#versioneer.render">[docs]</a><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">pieces</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Render the given version pieces into the requested style.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                <span class="s2">&quot;full-revisionid&quot;</span><span class="p">:</span> <span class="n">pieces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;long&quot;</span><span class="p">),</span>
                <span class="s2">&quot;dirty&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">],</span>
                <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">style</span> <span class="ow">or</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;pep440&quot;</span>  <span class="c1"># the default</span>

    <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;pep440&quot;</span><span class="p">:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_pep440</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;pep440-pre&quot;</span><span class="p">:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_pep440_pre</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;pep440-post&quot;</span><span class="p">:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_pep440_post</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;pep440-old&quot;</span><span class="p">:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_pep440_old</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;git-describe&quot;</span><span class="p">:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_git_describe</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">style</span> <span class="o">==</span> <span class="s2">&quot;git-describe-long&quot;</span><span class="p">:</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_git_describe_long</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unknown style &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">style</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">rendered</span><span class="p">,</span> <span class="s2">&quot;full-revisionid&quot;</span><span class="p">:</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;long&quot;</span><span class="p">],</span>
            <span class="s2">&quot;dirty&quot;</span><span class="p">:</span> <span class="n">pieces</span><span class="p">[</span><span class="s2">&quot;dirty&quot;</span><span class="p">],</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">pieces</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)}</span></div>


<div class="viewcode-block" id="VersioneerBadRootError"><a class="viewcode-back" href="../api/versioneer.html#versioneer.VersioneerBadRootError">[docs]</a><span class="k">class</span> <span class="nc">VersioneerBadRootError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The project root directory is unknown or missing key files.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="get_versions"><a class="viewcode-back" href="../api/versioneer.html#versioneer.get_versions">[docs]</a><span class="k">def</span> <span class="nf">get_versions</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the project version from whatever source is available.</span>

<span class="sd">    Returns dict with two keys: &#39;version&#39; and &#39;full&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;versioneer&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="c1"># see the discussion in cmdclass.py:get_cmdclass()</span>
        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;versioneer&quot;</span><span class="p">]</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">get_root</span><span class="p">()</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_config_from_root</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">VCS</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;please set [versioneer]VCS= in setup.cfg&quot;</span>
    <span class="n">handlers</span> <span class="o">=</span> <span class="n">HANDLERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">VCS</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">handlers</span><span class="p">,</span> <span class="s2">&quot;unrecognized VCS &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">cfg</span><span class="o">.</span><span class="n">VCS</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span> <span class="ow">or</span> <span class="n">cfg</span><span class="o">.</span><span class="n">verbose</span>
    <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
        <span class="s2">&quot;please set versioneer.versionfile_source&quot;</span>
    <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;please set versioneer.tag_prefix&quot;</span>

    <span class="n">versionfile_abs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">)</span>

    <span class="c1"># extract version from first of: _version.py, VCS command (e.g. &#39;git</span>
    <span class="c1"># describe&#39;), parentdir. This is meant to work for developers using a</span>
    <span class="c1"># source checkout, for users of a tarball created by &#39;setup.py sdist&#39;,</span>
    <span class="c1"># and for users of a tarball/zipball created by &#39;git archive&#39; or github&#39;s</span>
    <span class="c1"># download-from-tag feature or the equivalent in other VCSes.</span>

    <span class="n">get_keywords_f</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;get_keywords&quot;</span><span class="p">)</span>
    <span class="n">from_keywords_f</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keywords&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">get_keywords_f</span> <span class="ow">and</span> <span class="n">from_keywords_f</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">keywords</span> <span class="o">=</span> <span class="n">get_keywords_f</span><span class="p">(</span><span class="n">versionfile_abs</span><span class="p">)</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">from_keywords_f</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got version from expanded keyword </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ver</span>
        <span class="k">except</span> <span class="n">NotThisMethod</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">versions_from_file</span><span class="p">(</span><span class="n">versionfile_abs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got version from file </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">versionfile_abs</span><span class="p">,</span> <span class="n">ver</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ver</span>
    <span class="k">except</span> <span class="n">NotThisMethod</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">from_vcs_f</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pieces_from_vcs&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">from_vcs_f</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pieces</span> <span class="o">=</span> <span class="n">from_vcs_f</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="n">pieces</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">style</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got version from VCS </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ver</span>
        <span class="k">except</span> <span class="n">NotThisMethod</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">parentdir_prefix</span><span class="p">:</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">versions_from_parentdir</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">parentdir_prefix</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;got version from parentdir </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ver</span>
    <span class="k">except</span> <span class="n">NotThisMethod</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;unable to compute version&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0+unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;full-revisionid&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;dirty&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;unable to compute version&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span></div>


<div class="viewcode-block" id="get_version"><a class="viewcode-back" href="../api/versioneer.html#versioneer.get_version">[docs]</a><span class="k">def</span> <span class="nf">get_version</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get the short version string for this project.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_versions</span><span class="p">()[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_cmdclass"><a class="viewcode-back" href="../api/versioneer.html#versioneer.get_cmdclass">[docs]</a><span class="k">def</span> <span class="nf">get_cmdclass</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get the custom setuptools/distutils subclasses used by Versioneer.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;versioneer&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;versioneer&quot;</span><span class="p">]</span>
        <span class="c1"># this fixes the &quot;python setup.py develop&quot; case (also &#39;install&#39; and</span>
        <span class="c1"># &#39;easy_install .&#39;), in which subdependencies of the main project are</span>
        <span class="c1"># built (using setup.py bdist_egg) in the same python process. Assume</span>
        <span class="c1"># a main project A and a dependency B, which use different versions</span>
        <span class="c1"># of Versioneer. A&#39;s setup.py imports A&#39;s Versioneer, leaving it in</span>
        <span class="c1"># sys.modules by the time B&#39;s setup.py is executed, causing B to run</span>
        <span class="c1"># with the wrong versioneer. Setuptools wraps the sub-dep builds in a</span>
        <span class="c1"># sandbox that restores sys.modules to it&#39;s pre-build state, so the</span>
        <span class="c1"># parent is protected against the child&#39;s &quot;import versioneer&quot;. By</span>
        <span class="c1"># removing ourselves from sys.modules here, before the child build</span>
        <span class="c1"># happens, we protect the child from the parent&#39;s versioneer too.</span>
        <span class="c1"># Also see https://github.com/warner/python-versioneer/issues/52</span>

    <span class="n">cmds</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># we add &quot;version&quot; to both distutils and setuptools</span>
    <span class="kn">from</span> <span class="nn">distutils.core</span> <span class="k">import</span> <span class="n">Command</span>

    <span class="k">class</span> <span class="nc">cmd_version</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;report generated version string&quot;</span>
        <span class="n">user_options</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">boolean_options</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">initialize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">def</span> <span class="nf">finalize_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">vers</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Version: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vers</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; full-revisionid: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;full-revisionid&quot;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; dirty: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dirty&quot;</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; date: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">vers</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">vers</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>
    <span class="n">cmds</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd_version</span>

    <span class="c1"># we override &quot;build_py&quot; in both distutils and setuptools</span>
    <span class="c1">#</span>
    <span class="c1"># most invocation pathways end up running build_py:</span>
    <span class="c1">#  distutils/build -&gt; build_py</span>
    <span class="c1">#  distutils/install -&gt; distutils/build -&gt;..</span>
    <span class="c1">#  setuptools/bdist_wheel -&gt; distutils/install -&gt;..</span>
    <span class="c1">#  setuptools/bdist_egg -&gt; distutils/install_lib -&gt; build_py</span>
    <span class="c1">#  setuptools/install -&gt; bdist_egg -&gt;..</span>
    <span class="c1">#  setuptools/develop -&gt; ?</span>
    <span class="c1">#  pip install:</span>
    <span class="c1">#   copies source tree to a tempdir before running egg_info/etc</span>
    <span class="c1">#   if .git isn&#39;t copied too, &#39;git describe&#39; will fail</span>
    <span class="c1">#   then does setup.py bdist_wheel, or sometimes setup.py install</span>
    <span class="c1">#  setup.py egg_info -&gt; ?</span>

    <span class="c1"># we override different &quot;build_py&quot; commands for both environments</span>
    <span class="k">if</span> <span class="s2">&quot;setuptools&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">setuptools.command.build_py</span> <span class="k">import</span> <span class="n">build_py</span> <span class="k">as</span> <span class="n">_build_py</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">distutils.command.build_py</span> <span class="k">import</span> <span class="n">build_py</span> <span class="k">as</span> <span class="n">_build_py</span>

    <span class="k">class</span> <span class="nc">cmd_build_py</span><span class="p">(</span><span class="n">_build_py</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">get_root</span><span class="p">()</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_config_from_root</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
            <span class="n">versions</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">()</span>
            <span class="n">_build_py</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># now locate _version.py in the new build/ directory and replace</span>
            <span class="c1"># it with an updated value</span>
            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_build</span><span class="p">:</span>
                <span class="n">target_versionfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_lib</span><span class="p">,</span>
                                                  <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_build</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPDATING </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_versionfile</span><span class="p">)</span>
                <span class="n">write_to_version_file</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">,</span> <span class="n">versions</span><span class="p">)</span>
    <span class="n">cmds</span><span class="p">[</span><span class="s2">&quot;build_py&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd_build_py</span>

    <span class="k">if</span> <span class="s2">&quot;cx_Freeze&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>  <span class="c1"># cx_freeze enabled?</span>
        <span class="kn">from</span> <span class="nn">cx_Freeze.dist</span> <span class="k">import</span> <span class="n">build_exe</span> <span class="k">as</span> <span class="n">_build_exe</span>
        <span class="c1"># nczeczulin reports that py2exe won&#39;t like the pep440-style string</span>
        <span class="c1"># as FILEVERSION, but it can be used for PRODUCTVERSION, e.g.</span>
        <span class="c1"># setup(console=[{</span>
        <span class="c1">#   &quot;version&quot;: versioneer.get_version().split(&quot;+&quot;, 1)[0], # FILEVERSION</span>
        <span class="c1">#   &quot;product_version&quot;: versioneer.get_version(),</span>
        <span class="c1">#   ...</span>

        <span class="k">class</span> <span class="nc">cmd_build_exe</span><span class="p">(</span><span class="n">_build_exe</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">get_root</span><span class="p">()</span>
                <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_config_from_root</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="n">versions</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">()</span>
                <span class="n">target_versionfile</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPDATING </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_versionfile</span><span class="p">)</span>
                <span class="n">write_to_version_file</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">,</span> <span class="n">versions</span><span class="p">)</span>

                <span class="n">_build_exe</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">LONG</span> <span class="o">=</span> <span class="n">LONG_VERSION_PY</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">VCS</span><span class="p">]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">LONG</span> <span class="o">%</span>
                            <span class="p">{</span><span class="s2">&quot;DOLLAR&quot;</span><span class="p">:</span> <span class="s2">&quot;$&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;STYLE&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
                             <span class="s2">&quot;TAG_PREFIX&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span><span class="p">,</span>
                             <span class="s2">&quot;PARENTDIR_PREFIX&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">parentdir_prefix</span><span class="p">,</span>
                             <span class="s2">&quot;VERSIONFILE_SOURCE&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">,</span>
                             <span class="p">})</span>
        <span class="n">cmds</span><span class="p">[</span><span class="s2">&quot;build_exe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd_build_exe</span>
        <span class="k">del</span> <span class="n">cmds</span><span class="p">[</span><span class="s2">&quot;build_py&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s1">&#39;py2exe&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>  <span class="c1"># py2exe enabled?</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">py2exe.distutils_buildexe</span> <span class="k">import</span> <span class="n">py2exe</span> <span class="k">as</span> <span class="n">_py2exe</span>  <span class="c1"># py3</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">py2exe.build_exe</span> <span class="k">import</span> <span class="n">py2exe</span> <span class="k">as</span> <span class="n">_py2exe</span>  <span class="c1"># py2</span>

        <span class="k">class</span> <span class="nc">cmd_py2exe</span><span class="p">(</span><span class="n">_py2exe</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">root</span> <span class="o">=</span> <span class="n">get_root</span><span class="p">()</span>
                <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_config_from_root</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
                <span class="n">versions</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">()</span>
                <span class="n">target_versionfile</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPDATING </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_versionfile</span><span class="p">)</span>
                <span class="n">write_to_version_file</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">,</span> <span class="n">versions</span><span class="p">)</span>

                <span class="n">_py2exe</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">LONG</span> <span class="o">=</span> <span class="n">LONG_VERSION_PY</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">VCS</span><span class="p">]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">LONG</span> <span class="o">%</span>
                            <span class="p">{</span><span class="s2">&quot;DOLLAR&quot;</span><span class="p">:</span> <span class="s2">&quot;$&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;STYLE&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
                             <span class="s2">&quot;TAG_PREFIX&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span><span class="p">,</span>
                             <span class="s2">&quot;PARENTDIR_PREFIX&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">parentdir_prefix</span><span class="p">,</span>
                             <span class="s2">&quot;VERSIONFILE_SOURCE&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">,</span>
                             <span class="p">})</span>
        <span class="n">cmds</span><span class="p">[</span><span class="s2">&quot;py2exe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd_py2exe</span>

    <span class="c1"># we override different &quot;sdist&quot; commands for both environments</span>
    <span class="k">if</span> <span class="s2">&quot;setuptools&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">setuptools.command.sdist</span> <span class="k">import</span> <span class="n">sdist</span> <span class="k">as</span> <span class="n">_sdist</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">distutils.command.sdist</span> <span class="k">import</span> <span class="n">sdist</span> <span class="k">as</span> <span class="n">_sdist</span>

    <span class="k">class</span> <span class="nc">cmd_sdist</span><span class="p">(</span><span class="n">_sdist</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">versions</span> <span class="o">=</span> <span class="n">get_versions</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_versioneer_generated_versions</span> <span class="o">=</span> <span class="n">versions</span>
            <span class="c1"># unless we update this, the command will keep using the old</span>
            <span class="c1"># version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">versions</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">_sdist</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">make_release_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">get_root</span><span class="p">()</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_config_from_root</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
            <span class="n">_sdist</span><span class="o">.</span><span class="n">make_release_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">files</span><span class="p">)</span>
            <span class="c1"># now locate _version.py in the new base_dir directory</span>
            <span class="c1"># (remembering that it may be a hardlink) and replace it with an</span>
            <span class="c1"># updated value</span>
            <span class="n">target_versionfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UPDATING </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_versionfile</span><span class="p">)</span>
            <span class="n">write_to_version_file</span><span class="p">(</span><span class="n">target_versionfile</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_versioneer_generated_versions</span><span class="p">)</span>
    <span class="n">cmds</span><span class="p">[</span><span class="s2">&quot;sdist&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd_sdist</span>

    <span class="k">return</span> <span class="n">cmds</span></div>


<span class="n">CONFIG_ERROR</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">setup.cfg is missing the necessary Versioneer configuration. You need</span>
<span class="s2">a section like:</span>

<span class="s2"> [versioneer]</span>
<span class="s2"> VCS = git</span>
<span class="s2"> style = pep440</span>
<span class="s2"> versionfile_source = src/myproject/_version.py</span>
<span class="s2"> versionfile_build = myproject/_version.py</span>
<span class="s2"> tag_prefix =</span>
<span class="s2"> parentdir_prefix = myproject-</span>

<span class="s2">You will also need to edit your setup.py to use the results:</span>

<span class="s2"> import versioneer</span>
<span class="s2"> setup(version=versioneer.get_version(),</span>
<span class="s2">       cmdclass=versioneer.get_cmdclass(), ...)</span>

<span class="s2">Please read the docstring in ./versioneer.py for configuration instructions,</span>
<span class="s2">edit setup.cfg, and re-run the installer or &#39;python versioneer.py setup&#39;.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">SAMPLE_CONFIG</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># See the docstring in versioneer.py for instructions. Note that you must</span>
<span class="s2"># re-run &#39;versioneer.py setup&#39; after changing this section, and commit the</span>
<span class="s2"># resulting files.</span>

<span class="s2">[versioneer]</span>
<span class="s2">#VCS = git</span>
<span class="s2">#style = pep440</span>
<span class="s2">#versionfile_source =</span>
<span class="s2">#versionfile_build =</span>
<span class="s2">#tag_prefix =</span>
<span class="s2">#parentdir_prefix =</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">INIT_PY_SNIPPET</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">from ._version import get_versions</span>
<span class="s2">__version__ = get_versions()[&#39;version&#39;]</span>
<span class="s2">del get_versions</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="do_setup"><a class="viewcode-back" href="../api/versioneer.html#versioneer.do_setup">[docs]</a><span class="k">def</span> <span class="nf">do_setup</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Main VCS-independent setup function for installing Versioneer.&quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">get_root</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">get_config_from_root</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">EnvironmentError</span><span class="p">,</span> <span class="n">configparser</span><span class="o">.</span><span class="n">NoSectionError</span><span class="p">,</span>
            <span class="n">configparser</span><span class="o">.</span><span class="n">NoOptionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="ne">EnvironmentError</span><span class="p">,</span> <span class="n">configparser</span><span class="o">.</span><span class="n">NoSectionError</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding sample versioneer config to setup.cfg&quot;</span><span class="p">,</span>
                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;setup.cfg&quot;</span><span class="p">),</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SAMPLE_CONFIG</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">CONFIG_ERROR</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; creating </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">LONG</span> <span class="o">=</span> <span class="n">LONG_VERSION_PY</span><span class="p">[</span><span class="n">cfg</span><span class="o">.</span><span class="n">VCS</span><span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">LONG</span> <span class="o">%</span> <span class="p">{</span><span class="s2">&quot;DOLLAR&quot;</span><span class="p">:</span> <span class="s2">&quot;$&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;STYLE&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">style</span><span class="p">,</span>
                        <span class="s2">&quot;TAG_PREFIX&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">tag_prefix</span><span class="p">,</span>
                        <span class="s2">&quot;PARENTDIR_PREFIX&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">parentdir_prefix</span><span class="p">,</span>
                        <span class="s2">&quot;VERSIONFILE_SOURCE&quot;</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">,</span>
                        <span class="p">})</span>

    <span class="n">ipy</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">),</span>
                       <span class="s2">&quot;__init__.py&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ipy</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ipy</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">old</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
            <span class="n">old</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">INIT_PY_SNIPPET</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; appending to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ipy</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ipy</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">INIT_PY_SNIPPET</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> unmodified&quot;</span> <span class="o">%</span> <span class="n">ipy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2"> doesn&#39;t exist, ok&quot;</span> <span class="o">%</span> <span class="n">ipy</span><span class="p">)</span>
        <span class="n">ipy</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Make sure both the top-level &quot;versioneer.py&quot; and versionfile_source</span>
    <span class="c1"># (PKG/_version.py, used by runtime code) are in MANIFEST.in, so</span>
    <span class="c1"># they&#39;ll be copied into source distributions. Pip won&#39;t be able to</span>
    <span class="c1"># install the package without this.</span>
    <span class="n">manifest_in</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;MANIFEST.in&quot;</span><span class="p">)</span>
    <span class="n">simple_includes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;include &quot;</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">include</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="n">simple_includes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">include</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">EnvironmentError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># That doesn&#39;t cover everything MANIFEST.in can do</span>
    <span class="c1"># (http://docs.python.org/2/distutils/sourcedist.html#commands), so</span>
    <span class="c1"># it might give some false negatives. Appending redundant &#39;include&#39;</span>
    <span class="c1"># lines is safe, though.</span>
    <span class="k">if</span> <span class="s2">&quot;versioneer.py&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">simple_includes</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; appending &#39;versioneer.py&#39; to MANIFEST.in&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;include versioneer.py</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &#39;versioneer.py&#39; already in MANIFEST.in&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">simple_includes</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; appending versionfile_source (&#39;</span><span class="si">%s</span><span class="s2">&#39;) to MANIFEST.in&quot;</span> <span class="o">%</span>
              <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;include </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; versionfile_source already in MANIFEST.in&quot;</span><span class="p">)</span>

    <span class="c1"># Make VCS-specific changes. For git, this means creating/changing</span>
    <span class="c1"># .gitattributes to mark _version.py for export-subst keyword</span>
    <span class="c1"># substitution.</span>
    <span class="n">do_vcs_install</span><span class="p">(</span><span class="n">manifest_in</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">versionfile_source</span><span class="p">,</span> <span class="n">ipy</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="scan_setup_py"><a class="viewcode-back" href="../api/versioneer.html#versioneer.scan_setup_py">[docs]</a><span class="k">def</span> <span class="nf">scan_setup_py</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Validate the contents of setup.py against Versioneer&#39;s expectations.&quot;&quot;&quot;</span>
    <span class="n">found</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">setters</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;setup.py&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;import versioneer&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;import&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;versioneer.get_cmdclass()&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;cmdclass&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;versioneer.get_version()&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;get_version&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;versioneer.VCS&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">setters</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="s2">&quot;versioneer.versionfile_source&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">setters</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your setup.py appears to be missing some important items&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;(but I might be wrong). Please make sure it has something&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;roughly like the following:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; import versioneer&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; setup( version=versioneer.get_version(),&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        cmdclass=versioneer.get_cmdclass(),  ...)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">setters</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You should remove lines like &#39;versioneer.VCS = &#39; and&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;versioneer.versionfile_source = &#39; . This configuration&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now lives in setup.cfg, and should be removed from setup.py&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">errors</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;setup&quot;</span><span class="p">:</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">do_setup</span><span class="p">()</span>
        <span class="n">errors</span> <span class="o">+=</span> <span class="n">scan_setup_py</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

		</div>
		  
	</div>
</div>
<footer class="footer">
	<div class="container">
		<div>
					<div>&copy; Copyright 2019, </div>
			<div><a href="https://semeon.io/">Semeon Risom</a>.</div>
				<div>Updated 2019-05-05T14:35:39-05:00.</div>
		</div>
	</div>
</footer>
  </body>
</html>