<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>imhr.eyetracking._eyelink &#8212; imhr-api 2019-05-26 documentation</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/semeon/css/user.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/clipboard.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/user.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/imhr.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="description" content="Results from our feasibility study for in-browser eyetracking.">
<meta name="author" content="Semeon Risom">
<meta name="email" content="semeon.risom@gmail.com">
<meta name="robots" content="index,follow">
<meta name="AdsBot-Google" content="noindex">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          imhr-api</a>
        <span class="navbar-text navbar-version pull-left"><b>2019-05-26</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../genindex.html">Glossary</a></li>
                <li><a href="../../../install.html">Install</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#installing">Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#accesesing-raw-data">Accesesing Raw Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#relational-plots">Relational plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/process_demographics.html">Process demographics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#get-metadata">get metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#prepare-data">prepare data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#demographic-statistics">demographic statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#list-of-variables">list of variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#descriptive-device">descriptive device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#descriptive-task">descriptive task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#summary-data">summary data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/download_data.html">Download data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#raw-data-(UTWeb)">raw data (UTWeb)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#REDCap">REDCap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#box">box</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/run_models.html">Run models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/create_plots.html">Create plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/process_data.html">Process data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_data.html#start">start</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html">Eyetracking demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Import-packages.">Import packages.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Set-task-parameters,-either-directly-from-PsychoPy-or-created-manually.">Set task parameters, either directly from PsychoPy or created manually.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Initialize-the-imhr.eyetracking-package.">Initialize the imhr.eyetracking package.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Connect-to-the-Eyelink-Host.">Connect to the Eyelink Host.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Set-the-dominamt-eye.">Set the dominamt eye.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Start-calibration.">Start calibration.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#(Optional)-Print-message-to-console/terminal.">(Optional) Print message to console/terminal.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#(Optional)-Drift-correction.">(Optional) Drift correction.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Start-recording.">Start recording.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Example-use-of-eyetracking.sample().">Example use of eyetracking.sample().</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Stop-recording.">Stop recording.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Close-PsychoPy.">Close PsychoPy.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/roi/index.html">Region of Interest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Parameters">Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Required-Parameters">Required Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Optional-Parameters">Optional Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Creating-ROI">Creating ROI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Manually-coded-images">Manually coded images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Classified-using-Haar-Cascades">Classified using Haar Cascades</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Output">Output</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Bounds">Bounds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Data">Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../studies/R33/index.html">R33</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../studies/Webgazer/index.html">Webgazer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.Download.html">imhr.Download</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.eyetracking.html">imhr.eyetracking</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.plot.html">imhr.plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.r33.html">imhr.r33</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.tests.html">imhr.tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/imhr.tests.test_basic.html">imhr.tests.test_basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/imhr.tests.test_roi.html">imhr.tests.test_roi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.settings.html">imhr.settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.Webgazer.html">imhr.Webgazer</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
	<div class="imhr-bars">
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
	</div>
	<div class="row">
<div class="toc col-md-3" style="width: 25%;">
	<div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a></li>
</ul>

	</div>
</div>
		<div class="col-md-9 content">
			
  <h1>Source code for imhr.eyetracking._eyelink</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">| `@purpose`: Interface for the SR Research Eyelink eyetracking system.  </span>
<span class="sd">| `@date`: Created on Wed Feb 13 15:37:43 2019  </span>
<span class="sd">| `@author`: Semeon Risom  </span>
<span class="sd">| `@email`: semeon.risom@gmail.com  </span>
<span class="sd">| `@url`: https://semeon.io/d/imhr</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># allowed imports</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Eyelink&#39;</span><span class="p">]</span>

<span class="c1"># required external libraries</span>
<span class="n">__required__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;psychopy&#39;</span><span class="p">,</span><span class="s1">&#39;platform&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span><span class="s1">&#39;pathlib&#39;</span><span class="p">]</span>

<span class="c1"># core</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>

<span class="c1"># debug</span>
<span class="kn">from</span> <span class="nn">pdb</span> <span class="k">import</span> <span class="n">set_trace</span> <span class="k">as</span> <span class="n">breakpoint</span>

<span class="c1"># local libraries</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">settings</span>
	<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Calibration</span>
	<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">pylink</span>

<div class="viewcode-block" id="Eyelink"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink">[docs]</a><span class="k">class</span> <span class="nc">Eyelink</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Interface for the SR Research Eyelink eyetracking system.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">timer</span><span class="p">,</span> <span class="n">isPsychopy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">subject</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interface for the SR Research Eyelink eyetracking system..</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window :  `psychopy.visual.Window &lt;https://www.psychopy.org/api/visual/window.html#window&gt;`_</span>
<span class="sd">            PsychoPy window instance.</span>
<span class="sd">        timer :  `psychopy.core.CountdownTimer &lt;https://www.psychopy.org/api/core.html#psychopy.core.CountdownTimer&gt;`_</span>
<span class="sd">            Psychopy timer instance.</span>
<span class="sd">        isPsychopy : :obj:`bool`</span>
<span class="sd">            Is Psychopy being used. Default `True`.</span>
<span class="sd">        subject : :obj:`int`</span>
<span class="sd">            Subject number.</span>
<span class="sd">        **kwargs : :obj:`str` or :obj:`None`, optional</span>
<span class="sd">            Here&#39;s a list of available properties:</span>

<span class="sd">            .. list-table::</span>
<span class="sd">                :class: kwargs</span>
<span class="sd">                :widths: 25 50</span>
<span class="sd">                :header-rows: 1</span>

<span class="sd">                * - Property</span>
<span class="sd">                  - Description</span>
<span class="sd">                * - **isFlag** : :obj:`bool`</span>
<span class="sd">                  - Bypass Eyelink flags (`isRecording`, `isConnected`) to run all functions without checking flags. Default is `True`.</span>
<span class="sd">                * - **isLibrary** : :obj:`bool`</span>
<span class="sd">                  - Check if required packages have been installed. Default is `False`.</span>
<span class="sd">                * - **demo** : :obj:`bool`</span>
<span class="sd">                  - Run demo mode, which includes region of interest highlighting and other testing methods. Default is `False`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eytracking = imhr.eyetracking(window=window, subject=subject)</span>

<span class="sd">	    Notes</span>
<span class="sd">	    -----</span>
<span class="sd">	    According to `pylink.chm &lt;../manual/pylink.chm&gt;`_, the sequence of operations for implementing a trial is:</span>
<span class="sd">	        1) Perform a DRIFT CORRECTION, which also serves as the pre-trial fixation target.</span>
<span class="sd">	        2) Start recording, allowing 100 milliseconds of data to accumulate before the trial display starts.</span>
<span class="sd">	        3) Draw the subject display, recording the time that the display appeared by placing a message in the EDF file.</span>
<span class="sd">	        4) Loop until one of these events occurs RECORDING halts, due to the tracker ABORT menu or an error, the maximum \</span>
<span class="sd">	        trial duration expires &#39;ESCAPE&#39; is pressed, the program is interrupted, or abutton on the EyeLink button box is pressed.</span>
<span class="sd">	        5) Add special code to handle gaze-contingent display updates.</span>
<span class="sd">	        6) Blank the display, stop recording after an additional 100 milliseconds of data has been collected.</span>
<span class="sd">	        7) Report the trial result, and return an appropriate error code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># psychopy</span>
        <span class="kn">from</span> <span class="nn">psychopy</span> <span class="k">import</span> <span class="n">visual</span><span class="p">,</span> <span class="n">core</span><span class="p">,</span> <span class="n">event</span>
        <span class="kn">from</span> <span class="nn">psychopy.constants</span> <span class="k">import</span> <span class="p">(</span><span class="n">NOT_STARTED</span><span class="p">,</span> <span class="n">STARTED</span><span class="p">,</span> <span class="n">FINISHED</span><span class="p">)</span>

        <span class="c1">#----introduction</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;imhr.eyetracking() found.&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

        <span class="c1">#----screen size</span>
        <span class="k">if</span> <span class="n">isPsychopy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if windows</span>
            <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
				<span class="c1">## try to import</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">win32api</span> <span class="k">import</span> <span class="n">GetSystemMetrics</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s2">&quot;No module named &#39;win32api&#39;. Installing from PyPI&quot;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
                    <span class="n">settings</span><span class="o">.</span><span class="n">library</span><span class="p">([</span><span class="s1">&#39;win32api&#39;</span><span class="p">])</span>
				<span class="c1"># get width, height	</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">GetSystemMetrics</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">GetSystemMetrics</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;imhr.eyetracking(): screensize [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">].&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
            <span class="c1"># else if osx</span>
            <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
                <span class="c1">## try to import</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">pyobjc</span>
                    <span class="kn">from</span> <span class="nn">AppKit</span> <span class="k">import</span> <span class="n">NSScreen</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s2">&quot;No module named &#39;pyobjc&#39;. Installing from PyPI&quot;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
                    <span class="n">settings</span><span class="o">.</span><span class="n">library</span><span class="p">([</span><span class="s1">&#39;pyobjc&#39;</span><span class="p">])</span>
				<span class="c1"># get width, height	</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">NSScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="p">()</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">NSScreen</span><span class="o">.</span><span class="n">mainScreen</span><span class="p">()</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;imhr.eyetracking(): screensize [</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">].&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>

        <span class="c1">#----parameters</span>
        <span class="c1"># instants</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>
        <span class="c1"># flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isConnected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isStarted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isCalibration</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isRecording</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isDriftCorrection</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isFinished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># counters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drift_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># pupil</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eye_used</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_eye</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_eye</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#----timing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routineTimer</span> <span class="o">=</span> <span class="n">timer</span>

        <span class="c1">#----drift correction</span>
        <span class="c1">#clock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drift_message_clock</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drift_clock</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>
        <span class="c1">#screen</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s2">&quot;On the next screen a fixation dot will appear.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Please look at the fixation dot until it disappears.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Press any key to continue.&quot;</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drift_text</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;drift_message&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s1">&#39;Helvetica&#39;</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">wrapWidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">ori</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">alignVert</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
        <span class="n">colorSpace</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="c1"># check if subject number has been entered</span>
        <span class="k">if</span> <span class="n">subject</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;Subject number not entered. Please enter the subject number.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span>

        <span class="c1">#----edf filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subject</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># check if integer</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w+$&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;Name must only include A-Z, 0-9, or _&#39;</span><span class="p">)</span>
        <span class="c1"># check length</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;Name must be &lt;= 8 characters.&#39;</span><span class="p">)</span>
        <span class="c1"># store name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.edf&#39;</span>

        <span class="c1"># generate file path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/data/edf/&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

		<span class="c1">#----kwargs</span>
        <span class="c1"># demo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isDemo</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;isDemo&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;isDemo&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="c1"># turn off eyelink flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isFlag</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;isFlag&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;isFlag&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="c1"># isLibrary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isLibrary</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;isLibrary&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;isLibrary&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="c1">#----check if required libraries are available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLibrary</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">library</span><span class="p">(</span><span class="n">__required__</span><span class="p">)</span>

        <span class="c1">#----kwargs</span>

<div class="viewcode-block" id="Eyelink.connect"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calibration_type</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">automatic_calibration_pacing</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">saccade_velocity_threshold</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
                <span class="n">saccade_acceleration_threshold</span><span class="o">=</span><span class="mi">9500</span><span class="p">,</span> <span class="n">sound</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">select_parser_configuration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">recording_parse_type</span><span class="o">=</span><span class="s2">&quot;GAZE&quot;</span><span class="p">,</span> <span class="n">enable_search_limits</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="s1">&#39;100.1.1.1&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect to Eyelink.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ip : :obj:`string`</span>
<span class="sd">            Host PC ip address.</span>
<span class="sd">        calibration_type : :obj:`int`</span>
<span class="sd">            Calibration type. Default is 13-point. [see `Eyelink 1000 Plus User Manual, 3.7 Calibration \</span>
<span class="sd">			&lt;../manual/EyeLink%201000%20Plus%20User%20Manual%201.0.12.pdf&gt;`_]</span>
<span class="sd">        automatic_calibration_pacing : :obj:`int`</span>
<span class="sd">            Select the delay in milliseconds, between successive calibration or validation targets </span>
<span class="sd">            if automatic target detection is activeSet automatic calibration pacing. [see `pylink.chm &lt;../manual/pylink.chm&gt;`_]</span>
<span class="sd">        saccade_velocity_threshold : :obj:`int`</span>
<span class="sd">            Sets velocity threshold of saccade detector: usually 30 for cognitive research, 22 for </span>
<span class="sd">            pursuit and neurological work. Default is 35. Note: EyeLink II and EyeLink 1000,</span>
<span class="sd">            select select_parser_configuration should be used instead. [see `EyeLink Programmer’s Guide, \</span>
<span class="sd">            Section 25.9: Parser Configuration &lt;../manual/EyeLink%20Programmers%20Guide.pdf&gt;`_; `Eyelink 1000 Plus \</span>
<span class="sd">			User Manual, Section 4.3.5 Saccadic Thresholds &lt;../manual/EyeLink%201000%20Plus%20User%20Manual%201.0.12.pdf&gt;`_]</span>
<span class="sd">        saccade_acceleration_threshold : :obj:`int`</span>
<span class="sd">            Sets acceleration threshold of saccade detector: usually 9500 for cognitive research, 5000 </span>
<span class="sd">            for pursuit and neurological work. Default is 9500. Note: For EyeLink II and EyeLink 1000,</span>
<span class="sd">            select select_parser_configuration should be used instead. [see `EyeLink Programmer’s Guide, \</span>
<span class="sd">            Section 25.9: Parser Configuration &lt;../manual/EyeLink%20Programmers%20Guide.pdf&gt;`_; \</span>
<span class="sd">			`Eyelink 1000 Plus User Manual, Section 4.3.5 Saccadic Thresholds &lt;../manual/EyeLink%201000%20Plus%20User%20Manual%201.0.12.pdf&gt;`_]</span>
<span class="sd">        select_parser_configuration : :obj:`int`</span>
<span class="sd">            Selects the preset standard parser setup (0) or more sensitive (1). These are equivalent</span>
<span class="sd">            to the cognitive and psychophysical configurations. Default is 0. [see `EyeLink Programmer’s \</span>
<span class="sd">            Guide, Section 25.9: Parser Configuration &lt;../manual/EyeLink%20Programmers%20Guide.pdf&gt;`_]</span>
<span class="sd">        sound : :obj:`bool`</span>
<span class="sd">            Should sound be used for calibration/validation/drift correction.</span>
<span class="sd">        recording_parse_type : :obj:`str`</span>
<span class="sd">            Sets how velocity information for saccade detection is to be computed.</span>
<span class="sd">            Enter either &#39;GAZE&#39; or &#39;HREF&#39;. Default is &#39;GAZE&#39;. [see `Eyelink 1000 Plus User Manual, \</span>
<span class="sd">			Section 4.4: File Data Types &lt;../manual/EyeLink%201000%20Plus%20User%20Manual%201.0.12.pdf&gt;`_]</span>
<span class="sd">        enable_search_limits : :obj:`bool`</span>
<span class="sd">            Enables tracking of pupil to global search limits. Default is True. [see `Eyelink 1000 Plus User Manual, \</span>
<span class="sd">			Section 4.4: File Data Types &lt;../manual/EyeLink%201000%20Plus%20User%20Manual%201.0.12.pdf&gt;`_]</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        ----------</span>
<span class="sd">        param : :class:`pandas.DataFrame`</span>
<span class="sd">            Returns dataframe of parameters for subject.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; param = eyetracking.connect(calibration_type=13)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#----initiate connection with eyetracker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">pylink</span><span class="o">.</span><span class="n">EyeLink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isConnected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Eyelink Connected&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">pylink</span><span class="o">.</span><span class="n">EyeLink</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isConnected</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Eyelink not detected at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">))</span>
            
        <span class="c1">#----tracker metadata</span>
        <span class="c1"># get eyelink version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">getTrackerVersion</span><span class="p">()</span>

        <span class="c1"># get host tracking software version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host_version</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker_version</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">tvstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">getTrackerVersionString</span><span class="p">()</span>
            <span class="n">vindex</span> <span class="o">=</span> <span class="n">tvstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;EYELINK CL&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">host_version</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">tvstr</span><span class="p">[(</span><span class="n">vindex</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;EYELINK CL&quot;</span><span class="p">)):]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

        <span class="c1">#----preset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_parser_configuration</span> <span class="o">=</span> <span class="n">select_parser_configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saccade_acceleration_threshold</span> <span class="o">=</span> <span class="n">saccade_acceleration_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saccade_velocity_threshold</span> <span class="o">=</span> <span class="n">saccade_velocity_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recording_parse_type</span> <span class="o">=</span> <span class="n">recording_parse_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_search_limits</span> <span class="o">=</span> <span class="s2">&quot;YES&quot;</span> <span class="k">if</span> <span class="n">enable_search_limits</span> <span class="k">else</span> <span class="s2">&quot;NO&quot;</span>
        <span class="c1"># calibration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration_type</span> <span class="o">=</span> <span class="n">calibration_type</span>  <span class="c1"># []-point calibration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">automatic_calibration_pacing</span> <span class="o">=</span> <span class="n">automatic_calibration_pacing</span>
        <span class="c1"># specify the EVENT and SAMPLE data that are stored in EDF or retrievable from the Link</span>
        <span class="c1"># [see Section 4.6 Data Files of the  EyeLink 1000 Plus user manual]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fef</span> <span class="o">=</span> <span class="s2">&quot;LEFT,RIGHT,FIXATION,SACCADE,BLINK,MESSAGE,BUTTON,INPUT&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lef</span> <span class="o">=</span> <span class="s2">&quot;LEFT,RIGHT,FIXATION,FIXUPDATE,SACCADE,BLINK,BUTTON,INPUT&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_version</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsd</span> <span class="o">=</span> <span class="s2">&quot;LEFT,RIGHT,GAZE,AREA,GAZERES,STATUS,HTARGET,INPUT&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lsd</span> <span class="o">=</span> <span class="s2">&quot;LEFT,RIGHT,GAZE,GAZERES,AREA,STATUS,HTARGET,INPUT&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsd</span> <span class="o">=</span> <span class="s2">&quot;LEFT,RIGHT,GAZE,AREA,GAZERES,STATUS&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lsd</span> <span class="o">=</span> <span class="s2">&quot;LEFT,RIGHT,GAZE,GAZERES,AREA,STATUS&quot;</span>

        <span class="c1">#---store param for export</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">tracker_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tracker_version</span><span class="p">,</span> 
            <span class="n">host_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host_version</span><span class="p">,</span>
            <span class="n">select_parser_configuration</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">select_parser_configuration</span><span class="p">,</span>
            <span class="n">saccade_acceleration_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_acceleration_threshold</span><span class="p">,</span>
            <span class="n">saccade_velocity_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_velocity_threshold</span><span class="p">,</span>
            <span class="n">recording_parse_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">recording_parse_type</span><span class="p">,</span>
            <span class="n">enable_search_limits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_search_limits</span><span class="p">,</span>
            <span class="n">automatic_calibration_pacing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">automatic_calibration_pacing</span><span class="p">,</span>
            <span class="n">file_event_filter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fef</span><span class="p">,</span>
            <span class="n">file_sample_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fsd</span><span class="p">,</span>
            <span class="n">link_event_filter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lef</span><span class="p">,</span>
            <span class="n">link_sample_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lsd</span><span class="p">,</span>
            <span class="n">calibration_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration_type</span>
        <span class="p">)</span>

        <span class="c1">#----open edf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">openDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">flushGetkeyQueue</span><span class="p">()</span>

        <span class="c1">#----send settings to eyelink</span>
        <span class="c1"># place EyeLink tracker in offline (idle) mode before changing settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">setOfflineMode</span><span class="p">()</span>

        <span class="c1"># Set the tracker to parse events using either GAZE or HREF</span>
        <span class="c1"># note: [see `Data Viewer User Manual, Section 7: Protocol for EyeLink Data to Viewer Integration &lt;../manual/EyeLink%20Data%20Viewer%20User%20Manual%203.2.1.pdf&gt;`_]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;recording_parse_type = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recording_parse_type</span><span class="p">))</span>
   
        <span class="c1"># inform the tracker the resolution of the subject display</span>
        <span class="c1"># note: [see Eyelink Installation Guide, Section 8.4: Customizing Your PHYSICAL.INI Settings]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;screen_pixel_coords = 0 0 </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
   
        <span class="c1"># save display resolution in EDF data file for Data Viewer integration purposes</span>
        <span class="c1"># note: [see `Data Viewer User Manual, Section 7: Protocol for EyeLink Data to Viewer Integration &lt;../manual/EyeLink%20Data%20Viewer%20User%20Manual%203.2.1.pdf&gt;`_]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s2">&quot;DISPLAY_COORDS = 0 0 </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># set calibration type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;calibration_type = HV</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration_type</span><span class="p">))</span>
        <span class="c1"># set automatic calibraiton pacing interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;automatic_calibration_pacing = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">automatic_calibration_pacing</span><span class="p">))</span>

        <span class="c1"># if using tracker version 2 or greater</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker_version</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;select_parser_configuration </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">select_parser_configuration</span><span class="p">))</span>
            <span class="c1"># turn of scene link</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker_version</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;scene_camera_gazemap = NO&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;saccade_velocity_threshold = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saccade_velocity_threshold</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;saccade_acceleration_threshold = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saccade_acceleration_threshold</span><span class="p">))</span>

        <span class="c1"># if using tracker version 3 or above</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker_version</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span>
                <span class="s2">&quot;enable_search_limits=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_search_limits</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;track_search_limits=YES&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;autothreshold_click=YES&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;autothreshold_repeat=YES&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;enable_camera_position_detect=YES&quot;</span><span class="p">)</span>

        <span class="c1"># set content of edf file</span>
        <span class="c1"># edf filters #event types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s1">&#39;file_event_filter = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fef</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s1">&#39;file_sample_data = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fsd</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s1">&#39;link_event_filter = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lef</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s1">&#39;link_sample_data = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lsd</span><span class="p">))</span>

        <span class="c1"># program button &#39;5&#39; for drift correction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;button_function 5 &#39;accept_target_fixation&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># select sound for calibration and drift correct</span>
        <span class="c1"># &quot;&quot; = sound, &quot;off&quot; = no sound</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">setCalibrationSounds</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">setDriftCorrectSounds</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        
        <span class="c1"># export param to txt file</span>
        <span class="c1">## prevent metadata from being truncated</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">)</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># create df</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="n">param</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
        <span class="c1"># reset truncation</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="c1">#if ipython		</span>
		<span class="c1"># from IPython.display import display</span>
        <span class="c1"># display(param)</span>
        
        <span class="k">return</span> <span class="n">param</span></div>

<div class="viewcode-block" id="Eyelink.set_eye_used"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.set_eye_used">[docs]</a>    <span class="k">def</span> <span class="nf">set_eye_used</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eye</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set dominant eye. This step is required for recieving gaze coordinates from Eyelink-&gt;Psychopy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        eye : :obj:`str`</span>
<span class="sd">            Dominant eye (left, right). This will be used for outputting Eyelink gaze samples.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; dominant_eye = &#39;left&#39;</span>
<span class="sd">        &gt;&gt;&gt; eye_used = eyetracking.set_eye_used(eye=dominant_eye)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.set_eye_used()&quot;</span><span class="p">)</span>
        <span class="n">eye_entered</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">eye</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eye_entered</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">):</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eye_entered = </span><span class="si">%s</span><span class="s2">(&#39;left&#39;)&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">eye_entered</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eye_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_eye</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eye_entered = </span><span class="si">%s</span><span class="s2">(&#39;right&#39;)&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">eye_entered</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eye_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_eye</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_used</span></div>

<div class="viewcode-block" id="Eyelink.calibration"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.calibration">[docs]</a>    <span class="k">def</span> <span class="nf">calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start calibration procedure.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        isCalibration : :obj:`bool`</span>
<span class="sd">            Message indicating status of calibration.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eyetracking.calibration()</span>
<span class="sd">        &quot;&quot;&quot;</span>		
        <span class="c1"># calibration</span>
        <span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Calibration</span>

        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.calibration()&quot;</span><span class="p">)</span>
        
        <span class="c1">#----if connected to eyetracker</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isConnected</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFlag</span><span class="p">):</span>
            <span class="c1"># put the tracker in offline mode before we change its configurations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">setOfflineMode</span><span class="p">()</span>
            <span class="c1"># Generate custom calibration stimuli</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">genv</span> <span class="o">=</span> <span class="n">Calibration</span><span class="p">(</span><span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
            <span class="c1"># execute custom calibration display</span>
            <span class="n">pylink</span><span class="o">.</span><span class="n">openGraphicsEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">genv</span><span class="p">)</span>
            <span class="c1"># calibrate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">doTrackerSetup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="c1">#flip screen after finishing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
            
        <span class="c1">#----finished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isCalibration</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.calibration() finished&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isCalibration</span></div>
    
    <span class="k">def</span> <span class="nf">_drift_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#----prepare to start Routine &#39;drift_message&#39;</span>
        <span class="n">endExpNow</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag for &#39;escape&#39; or other condition =&gt; quit the exp</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drift_message_clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>  <span class="c1"># clock</span>
        <span class="n">frameN</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">continueRoutine</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># update component parameters for each repeat</span>
        <span class="n">drift_response</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">BuilderKeyResponse</span><span class="p">()</span>
        <span class="c1"># keep track of which components have finished</span>
        <span class="n">drift_message_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">drift_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_text</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">thisComponent</span> <span class="ow">in</span> <span class="n">drift_message_components</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thisComponent</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">):</span>
                <span class="n">thisComponent</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">NOT_STARTED</span>
        
        <span class="c1"># -------Start Routine &quot;drift_message&quot;-------</span>
        <span class="k">while</span> <span class="n">continueRoutine</span><span class="p">:</span>
            <span class="c1"># get current time</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_message_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
            <span class="n">frameN</span> <span class="o">=</span> <span class="n">frameN</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># number of completed frames (so 0 is the first frame)</span>
            <span class="c1"># update/draw components on each frame</span>
            
            <span class="c1"># *drift_response* updates</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">drift_response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">NOT_STARTED</span><span class="p">:</span>
                <span class="c1"># keep track of start time/frame for later</span>
                <span class="n">drift_response</span><span class="o">.</span><span class="n">tStart</span> <span class="o">=</span> <span class="n">t</span>
                <span class="n">drift_response</span><span class="o">.</span><span class="n">frameNStart</span> <span class="o">=</span> <span class="n">frameN</span>  <span class="c1"># exact frame index</span>
                <span class="n">drift_response</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">STARTED</span>
                <span class="c1"># keyboard checking is just starting</span>
                <span class="n">event</span><span class="o">.</span><span class="n">clearEvents</span><span class="p">(</span><span class="n">eventType</span><span class="o">=</span><span class="s1">&#39;keyboard&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drift_response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">STARTED</span><span class="p">:</span>
                <span class="n">theseKeys</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">getKeys</span><span class="p">()</span>
                
                <span class="c1"># check for quit:</span>
                <span class="k">if</span> <span class="s2">&quot;escape&quot;</span> <span class="ow">in</span> <span class="n">theseKeys</span><span class="p">:</span>
                    <span class="n">endExpNow</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">theseKeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># at least one key was pressed</span>
                    <span class="c1"># a response ends the routine</span>
                    <span class="n">continueRoutine</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="c1"># *drift_text* updates</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">drift_text</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">NOT_STARTED</span><span class="p">:</span>
                <span class="c1"># keep track of start time/frame for later</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drift_text</span><span class="o">.</span><span class="n">tStart</span> <span class="o">=</span> <span class="n">t</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drift_text</span><span class="o">.</span><span class="n">frameNStart</span> <span class="o">=</span> <span class="n">frameN</span>  <span class="c1"># exact frame index</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">drift_text</span><span class="o">.</span><span class="n">setAutoDraw</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="c1"># check for quit (typically the Esc key)</span>
            <span class="k">if</span> <span class="n">endExpNow</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">getKeys</span><span class="p">(</span><span class="n">keyList</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;escape&quot;</span><span class="p">]):</span>
                <span class="n">core</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            
            <span class="c1"># check if all components have finished</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">continueRoutine</span><span class="p">:</span>  <span class="c1"># a component has requested a forced-end of Routine</span>
                <span class="k">break</span>
            <span class="n">continueRoutine</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># will revert to True if at least one component still running</span>
            <span class="k">for</span> <span class="n">thisComponent</span> <span class="ow">in</span> <span class="n">drift_message_components</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thisComponent</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">thisComponent</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">FINISHED</span><span class="p">:</span>
                    <span class="n">continueRoutine</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>  <span class="c1"># at least one component has not yet finished</span>
            
            <span class="c1"># refresh the screen</span>
            <span class="k">if</span> <span class="n">continueRoutine</span><span class="p">:</span>  <span class="c1"># don&#39;t flip if this routine is over or we&#39;ll get a blank screen</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
        
        <span class="c1"># -------Ending Routine &quot;drift_message&quot;-------</span>
        <span class="k">for</span> <span class="n">thisComponent</span> <span class="ow">in</span> <span class="n">drift_message_components</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thisComponent</span><span class="p">,</span> <span class="s2">&quot;setAutoDraw&quot;</span><span class="p">):</span>
                <span class="n">thisComponent</span><span class="o">.</span><span class="n">setAutoDraw</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                
        <span class="c1"># the Routine &quot;drift_message&quot; was not non-slip safe, so reset the non-slip timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routineTimer</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        
<div class="viewcode-block" id="Eyelink.drift_correction"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.drift_correction">[docs]</a>    <span class="k">def</span> <span class="nf">drift_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;call&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts drift correction. This can be done at any point after calibration, including before </span>
<span class="sd">        and after eyetracking.start_recording has already been initiated.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        origin : :obj:`str`</span>
<span class="sd">            Origin of call, either `manual` (default) or from gaze contigent event (`gc`).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        isDriftCorrection : :obj:`bool`</span>
<span class="sd">            Message indicating status of drift correction.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Running drift_correction will end any start_recording event to function properly. Once drift</span>
<span class="sd">        correction has occured, it is safe to run start_recording.</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eyetracking.drift_correction()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.drift_correction()&quot;</span><span class="p">)</span>
        
        <span class="c1">#----present drift correction message (only if manually accessing)</span>
        <span class="k">if</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;call&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_drift_message</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">clearBuffer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
        
        <span class="c1">#check if recording</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRecording</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFlag</span><span class="p">):</span>
            <span class="c1"># end of trial message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s1">&#39;drift correction&#39;</span><span class="p">)</span>

            <span class="c1"># end realtime mode</span>
            <span class="n">pylink</span><span class="o">.</span><span class="n">endRealTimeMode</span><span class="p">()</span>
            <span class="n">pylink</span><span class="o">.</span><span class="n">msecDelay</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

            <span class="c1"># send trial-level variables</span>
            <span class="c1">#if running from self.gc</span>
            <span class="k">if</span> <span class="n">origin</span><span class="o">==</span><span class="s1">&#39;gc&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_variable</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">trial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trial</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">,</span> <span class="n">issues</span><span class="o">=</span><span class="s1">&#39;gc window failed&#39;</span><span class="p">))</span>

            <span class="c1"># specify end of trial</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s2">&quot;TRIAL_RESULT 1&quot;</span><span class="p">)</span>

            <span class="c1"># stop recording eye data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">stopRecording</span><span class="p">()</span>
        
        <span class="c1"># flag isRecording</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isRecording</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># initiate drift correction, flag isDriftCorrection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isDriftCorrection</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">doDriftCorrect</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">doTrackerSetup</span><span class="p">()</span>

        <span class="c1">#----finished</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.drift_correction() finished&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDriftCorrection</span></div>
    
<div class="viewcode-block" id="Eyelink.start_recording"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.start_recording">[docs]</a>    <span class="k">def</span> <span class="nf">start_recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts recording of Eyelink.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trial : :obj:`str`</span>
<span class="sd">            Trial Number.</span>
<span class="sd">        block : :obj:`str`</span>
<span class="sd">            Block Number.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        isRecording : :obj:`bool`</span>
<span class="sd">            Message indicating status of Eyelink recording.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        tracker.beginRealTimeMode():</span>
<span class="sd">            To ensure that no data is missed before the important part of the trial starts. The EyeLink </span>
<span class="sd">            tracker requires 10 to 30 milliseconds after the recording command to begin writing data. </span>
<span class="sd">            This extra data also allows the detection of blinks or saccades just before the trial start, </span>
<span class="sd">            allowing bad trials to be discarded in saccadic RT analysis. A &quot;SYNCTIME&quot; message later </span>
<span class="sd">            in the trial marks the actual zero-time in the trial&#39;s data record for analysis.</span>
<span class="sd">            [see `pylink.chm &lt;../manual/pylink.chm&gt;`_]</span>
<span class="sd">        TrialID:</span>
<span class="sd">            The &quot;TRIALID&quot; message is sent to the EDF file next. This message must be placed </span>
<span class="sd">            in the EDF file before the drift correction and before recording begins, and is critical </span>
<span class="sd">            for data analysis. The viewer will not parse any messages, events, or samples that exist</span>
<span class="sd">            in the data file prior to this message. The command identifier can be changed in the data</span>
<span class="sd">            loading preference settings.</span>
<span class="sd">            [see `Data Viewer User Manual, Section 7: Protocol for EyeLink Data to Viewer Integration \</span>
<span class="sd">			&lt;../manual/EyeLink%20Data%20Viewer%20User%20Manual%203.2.1.pdf&gt;`_]</span>
<span class="sd">        SYNCTIME:</span>
<span class="sd">            Marks the zero-time in a trial. A number may follow, which is interpreted as the delay of </span>
<span class="sd">            the message from the actual stimulus onset. It is suggested that recording start 100 </span>
<span class="sd">            milliseconds before the display is drawn or unblanked at zero-time, so that no data at the </span>
<span class="sd">            trial start is lost.</span>
<span class="sd">            [see `pylink.chm &lt;../manual/pylink.chm&gt;`_]</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eyetracking.start_recording(trial=1, block=1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.start_recording()&quot;</span><span class="p">)</span>
        
        <span class="c1"># indicates start of trial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s1">&#39;TRIALID </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">trial</span><span class="p">)))</span>
    
        <span class="c1"># Message to post to Eyelink display Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s2">&quot;record_status_message &#39;Trial </span><span class="si">%s</span><span class="s2"> Block </span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">trial</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">block</span><span class="p">)))</span>

        <span class="c1"># start recording, parameters specify whether events and samples are</span>
        <span class="c1"># stored in file, and available over the link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">startRecording</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># buffer to prevent loss of data</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">beginRealTimeMode</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># indicates zero-time of trial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s1">&#39;SYNCTIME&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s1">&#39;start recording&#39;</span><span class="p">)</span>
            
        <span class="c1"># flag isDriftCorrection, isRecording, trial, block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isDriftCorrection</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isRecording</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial</span> <span class="o">=</span> <span class="n">trial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">block</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRecording</span></div>
    
<div class="viewcode-block" id="Eyelink.gc"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.gc">[docs]</a>    <span class="k">def</span> <span class="nf">gc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">min_</span><span class="p">,</span> <span class="n">max_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates gaze contigent event. This function needs to be run while recording.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bound : :obj:`dict` [:obj:`str`, :obj:`int`]:</span>
<span class="sd">            Dictionary of the bounding box for each region of interest. Keys are each side of the </span>
<span class="sd">            bounding box and values are their corresponding coordinates in pixels.</span>
<span class="sd">        min_ : :obj:`int`</span>
<span class="sd">            Mininum duration (msec) in which gaze contigent capture is collecting data before allowing</span>
<span class="sd">            the task to continue.</span>
<span class="sd">        max_ : :obj:`int` or :obj:`None`</span>
<span class="sd">            Maxinum duration (msec) before task is forced to go into drift correction. </span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # Collect samples within the center of the screen, for 2000 msec, </span>
<span class="sd">        &gt;&gt;&gt; # with a max limit of 10000 msec.</span>
<span class="sd">        &gt;&gt;&gt; region = dict(left=860, top=440, right=1060, bottom=640)</span>
<span class="sd">        &gt;&gt;&gt; eyetracking.gc(bound=bound, min_=2000, max_=10000)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#if eyetracker is recording</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRecording</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFlag</span><span class="p">):</span>
            <span class="c1"># if demo</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDemo</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="mi">6</span>
                <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bound</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">line</span>
                <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bound</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">line</span>
                <span class="n">center</span> <span class="o">=</span> <span class="p">((</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">)</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">bound</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bound&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;pix&#39;</span><span class="p">,</span>
                                  <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">colorSpace</span><span class="o">=</span><span class="s1">&#39;rgb255&#39;</span><span class="p">,</span>
                                  <span class="n">lineWidth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">lineColor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lineColorSpace</span><span class="o">=</span><span class="s1">&#39;rgb255&#39;</span><span class="p">,</span>
                                  <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">box</span><span class="o">.</span><span class="n">setAutoDraw</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                
            <span class="c1"># draw box</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s1">&#39;draw_box </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> 6&#39;</span><span class="o">%</span> <span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">],</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">],</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">],</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]))</span>
            
            <span class="c1">#get start time</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
            <span class="c1">#get current time</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
            
            <span class="c1">#----check gc window</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>    
                <span class="c1">#flip screen</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
                
                <span class="c1">#get gaze sample</span>
                <span class="n">gxy</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
                
                <span class="c1">#is gaze with gaze contigent window for min_ time</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">gxy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bound</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">bound</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">gxy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bound</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">])):</span>
                    <span class="c1"># if demo</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDemo</span><span class="p">:</span>
                        <span class="n">box</span><span class="o">.</span><span class="n">lineColor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1"># has mininum time for gc window occured</span>
                    <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">current_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
                    <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="n">min_</span><span class="p">:</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.gc() success in </span><span class="si">%d</span><span class="s2"> msec&quot;</span><span class="o">%</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;gc window success&#39;</span><span class="p">)</span>
                        <span class="c1"># clear bounding box (if demo)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDemo</span><span class="p">:</span>
                            <span class="n">box</span><span class="o">.</span><span class="n">setAutoDraw</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="c1"># not in window</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if demo</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDemo</span><span class="p">:</span>
                        <span class="n">box</span><span class="o">.</span><span class="n">lineColor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1">#reset current time</span>
                    <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
                
                <span class="c1"># if reached maxinum time</span>
                <span class="k">if</span> <span class="n">max_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># has maxinum time for gc window occured</span>
                    <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
                    <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="n">max_</span><span class="p">:</span>
                        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.gc() failed, drift correction started&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;gc window failed&#39;</span><span class="p">)</span>
                        <span class="c1"># clear bounding box (if demo)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDemo</span><span class="p">:</span>
                            <span class="n">box</span><span class="o">.</span><span class="n">setAutoDraw</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="c1"># start drift correction</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">drift_correction</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;gc&#39;</span><span class="p">)</span>
                        <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracker not recording&quot;</span><span class="p">)</span></div>
                     
<div class="viewcode-block" id="Eyelink.sample"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.sample">[docs]</a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects new gaze coordinates from Eyelink.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gxy : :class:`tuple`</span>
<span class="sd">            Gaze coordiantes.</span>
<span class="sd">        ps : :obj:`tuple`</span>
<span class="sd">            Pupil size (area).</span>
<span class="sd">        sample : :class:`EyeLink.getNewestSample`</span>
<span class="sd">            Eyelink newest sample.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eyetracking.sample(eye_used=eye_used)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check for new sample update</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">getNewestSample</span><span class="p">()</span>
        
        <span class="c1">#if sample available</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sample</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># if dominant eye entered as right in both psychopy and eyelink</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eye_used</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_eye</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">isRightSample</span><span class="p">())):</span>
                <span class="n">gxy</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">getRightEye</span><span class="p">()</span><span class="o">.</span><span class="n">getGaze</span><span class="p">()</span>
                <span class="n">ps</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">getRightEye</span><span class="p">()</span><span class="o">.</span><span class="n">getPupilSize</span><span class="p">()</span>
            <span class="k">elif</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eye_used</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_eye</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">isLeftSample</span><span class="p">())):</span>
                <span class="n">gxy</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">getLeftEye</span><span class="p">()</span><span class="o">.</span><span class="n">getGaze</span><span class="p">()</span>
                <span class="n">ps</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">getLeftEye</span><span class="p">()</span><span class="o">.</span><span class="n">getPupilSize</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                 <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;eye_used (</span><span class="si">%s</span><span class="s1">) ≠ Eyelink &quot;Eye Tracked&quot; (</span><span class="si">%s</span><span class="s1">). </span><span class="se">\</span>
<span class="s1">                                      Please make sure the eye used in PsychoPy and Eyelink match.&#39;</span>\
                                      <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eye_used</span><span class="p">,</span> <span class="n">sample</span><span class="o">.</span><span class="n">getEye</span><span class="p">()))</span>
                
            <span class="c1"># gaze coordinates, pupil area    </span>
            <span class="k">return</span> <span class="n">gxy</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">sample</span>
        
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sample</span></div>

<div class="viewcode-block" id="Eyelink.send_message"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.send_message">[docs]</a>    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send message to Eyelink. This allows post-hoc processing of event markers (i.e. &quot;stimulus onset&quot;).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        msg : :obj:`str`</span>
<span class="sd">            Message to be recieved by eyelink.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; eyetracking.console(c=&quot;blue&quot;, msg=&quot;eyetracking.calibration() started&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Eyelink.send_variable"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.send_variable">[docs]</a>    <span class="k">def</span> <span class="nf">send_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variables</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        send trial variable to eyelink at the end of trial.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variable : :obj:`dict` or :obj:`None`</span>
<span class="sd">            Trial-related variables to be read by eyelink.          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;!V TRIAL_VAR </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">pylink</span><span class="o">.</span><span class="n">msecDelay</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># finished</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;variables sent&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;no variables entered&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Eyelink.stop_recording"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.stop_recording">[docs]</a>    <span class="k">def</span> <span class="nf">stop_recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops recording of Eyelink. Also allows transmission of trial-level variables to Eyelink.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trial : :obj:`int`</span>
<span class="sd">            Trial Number.</span>
<span class="sd">        block : :obj:`int`</span>
<span class="sd">            Block Number.</span>
<span class="sd">        variables : :obj:`dict` or :obj:`None`</span>
<span class="sd">            Dict of variables to send to eyelink (variable name, value).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        isRecording : :obj:`bool`</span>
<span class="sd">            Message indicating status of Eyelink recording.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        pylink.pumpDelay():</span>
<span class="sd">            Does a unblocked delay using currentTime(). This is the preferred delay function </span>
<span class="sd">            when accurate timing is not needed.</span>
<span class="sd">            [see `pylink.chm &lt;../../pylink.chm&gt;`_]</span>
<span class="sd">        pylink.msecDelay():</span>
<span class="sd">            During calls to pylink.msecDelay(), Windows is not able to handle messages. One result of </span>
<span class="sd">            this is that windows may not appear. This is the preferred delay function when accurate </span>
<span class="sd">            timing is needed.</span>
<span class="sd">            [see `pylink.chm &lt;../../pylink.chm&gt;`_]</span>
<span class="sd">        tracker.endRealTimeMode():</span>
<span class="sd">            Returns the application to a priority slightly above normal, to end realtime mode. This </span>
<span class="sd">            function should execute rapidly, but there is the possibility that Windows will allow other </span>
<span class="sd">            tasks to run after this call, causing delays of 1-20 milliseconds. This function is equivalent </span>
<span class="sd">            to the C API void end_realtime_mode(void).</span>
<span class="sd">            [see `pylink.chm &lt;../../pylink.chm&gt;`_]</span>
<span class="sd">        TRIAL_VAR: </span>
<span class="sd">            Lets users specify a trial variable and value for the given trial. One</span>
<span class="sd">            message should be sent for each trial condition variable and its corresponding value. If</span>
<span class="sd">            this command is used there is no need to use TRIAL_VAR_LABELS. The default command identifier </span>
<span class="sd">            can be changed in the data loading preference settings. Please note that the eye tracker </span>
<span class="sd">            can handle about 20 messages every 10 milliseconds. So be careful not to send too many </span>
<span class="sd">            messages too quickly if you have many trial condition messages to send. Add one millisecond </span>
<span class="sd">            delay between message lines if this is the case.</span>
<span class="sd">            [see `pylink.chm &lt;../../pylink.chm&gt;`_]</span>
<span class="sd">        TRIAL_RESULT: </span>
<span class="sd">            Defines the end of a trial. The viewer will not parse any messages, events, or samples that </span>
<span class="sd">            exist in the data file after this message. The command identifier can be changed in the </span>
<span class="sd">            data loading preference settings.</span>
<span class="sd">            [see `Data Viewer User Manual, Section 7: Protocol for EyeLink Data to Viewer Integration \</span>
<span class="sd">			&lt;../manual/EyeLink%20Data%20Viewer%20User%20Manual%203.2.1.pdf&gt;`_]</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; variables = dict(stimulus=&#39;face.png&#39;, event=&#39;stimulus&#39;)</span>
<span class="sd">        &gt;&gt;&gt; eyetracking.stop_recording(trial=trial, block=block, variables=variables)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.stop_recording()&quot;</span><span class="p">)</span>
        
        <span class="c1"># end of trial message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s1">&#39;end recording&#39;</span><span class="p">)</span>

        <span class="c1"># end realtime mode</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">endRealTimeMode</span><span class="p">()</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">msecDelay</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># send trial-level variables</span>
        <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trial</span>
        <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;block&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span>
        <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;issues&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_variable</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>

        <span class="c1"># specify end of trial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="s2">&quot;TRIAL_RESULT 1&quot;</span><span class="p">)</span>

        <span class="c1"># stop recording eye data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">stopRecording</span><span class="p">()</span>

        <span class="c1"># flag isRecording</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isRecording</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRecording</span></div>

<div class="viewcode-block" id="Eyelink.finish_recording"><a class="viewcode-back" href="../../../api/imhr.eyetracking._eyelink.html#imhr.eyetracking.Eyelink.finish_recording">[docs]</a>    <span class="k">def</span> <span class="nf">finish_recording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ending Eyelink recording.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : :obj:`str` or :obj:`None`</span>
<span class="sd">            Path to save data. If None, path will be default from PsychoPy task.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        isFinished : :obj:`bool`</span>
<span class="sd">            Message indicating status of Eyelink recording.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        pylink.pumpDelay():</span>
<span class="sd">            Does a unblocked delay using currentTime(). This is the preferred delay function </span>
<span class="sd">            when accurate timing is not needed.</span>
<span class="sd">            [see `pylink.chm &lt;../manual/pylink.chm&gt;`_]</span>
<span class="sd">        pylink.msecDelay():</span>
<span class="sd">            During calls to pylink.msecDelay(), Windows is not able to handle messages. One result of </span>
<span class="sd">            this is that windows may not appear. This is the preferred delay function when accurate </span>
<span class="sd">            timing is needed.</span>
<span class="sd">            [see `pylink.chm &lt;../manual/pylink.chm&gt;`_]</span>
<span class="sd">        tracker.setOfflineMode():</span>
<span class="sd">            Places EyeLink tracker in offline (idle) mode. Wait till the tracker has finished the </span>
<span class="sd">            mode transition.</span>
<span class="sd">            [see `pylink.chm &lt;../manual/pylink.chm&gt;`_]</span>
<span class="sd">        tracker.endRealTimeMode():</span>
<span class="sd">            Returns the application to a priority slightly above normal, to end realtime mode. This </span>
<span class="sd">            function should execute rapidly, but there is the possibility that Windows will allow other </span>
<span class="sd">            tasks to run after this call, causing delays of 1-20 milliseconds. This function is </span>
<span class="sd">            equivalent to the C API void end_realtime_mode(void).</span>
<span class="sd">            [see `pylink.chm &lt;../manual/pylink.chm&gt;`_]</span>
<span class="sd">        tracker.receiveDataFile():</span>
<span class="sd">            This receives a data file from the EyeLink tracker PC. Source filename and destination </span>
<span class="sd">            filename should be given.</span>
<span class="sd">            [see `pylink.chm &lt;../manual/pylink.chm&gt;`_]</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; #end recording session</span>
<span class="sd">        &gt;&gt;&gt; eyetracking.finish_recording()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;eyetracking.finish_recording()&quot;</span><span class="p">)</span>
        
        <span class="c1">#clear host display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">sendCommand</span><span class="p">(</span><span class="s1">&#39;clear_screen 0&#39;</span><span class="p">)</span> 
        
        <span class="c1"># double check realtime mode has ended</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">endRealTimeMode</span><span class="p">()</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">pumpDelay</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="c1"># rlaces eyeLink tracker in offline (idle) mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">setOfflineMode</span><span class="p">()</span>

        <span class="c1"># allow buffer to prepare data for closing</span>
        <span class="n">pylink</span><span class="o">.</span><span class="n">msecDelay</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

        <span class="c1"># closes any currently opened EDF file on the EyeLink tracker computer&#39;s hard disk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">closeDataFile</span><span class="p">()</span>

        <span class="c1"># This receives a data file from the eyelink tracking computer</span>
        <span class="c1">#if no path entered, use psychopy destination</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">receiveDataFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;File saved at: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)))</span>

        <span class="c1"># sends a disconnect message to the EyeLink tracker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># flag isFinished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isFinished</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1">#---finish</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFinished</span></div></div>
</pre></div>

		</div>
		  
	</div>
</div>
<footer class="footer">
	<div class="container">
		<div>
			<div>&copy; Copyright 2019, </div>
			<div><a href="https://semeon.io/">Semeon Risom</a>.</div>
			<div>Updated 2019-05-26T18:48:42-05:00.</div>
		</div>
	</div>
</footer>
  </body>
</html>