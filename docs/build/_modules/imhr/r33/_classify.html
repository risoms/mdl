<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>imhr.r33._classify &#8212; imhr-api 2019-05-23 documentation</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/semeon/css/user.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/clipboard.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/user.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/imhr.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="description" content="Results from our feasibility study for in-browser eyetracking.">
<meta name="author" content="Semeon Risom">
<meta name="email" content="semeon.risom@gmail.com">
<meta name="robots" content="index,follow">
<meta name="AdsBot-Google" content="noindex">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          imhr-api</a>
        <span class="navbar-text navbar-version pull-left"><b>2019-05-23</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../genindex.html">Glossary</a></li>
                <li><a href="../../../install.html">Install</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#installing">Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#accesesing-raw-data">Accesesing Raw Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#relational-plots">Relational plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/process_demographics.html">Process demographics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#get-metadata">get metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#prepare-data">prepare data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#demographic-statistics">demographic statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#list-of-variables">list of variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#descriptive-device">descriptive device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#descriptive-task">descriptive task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#summary-data">summary data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/download_data.html">Download data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#raw-data-(UTWeb)">raw data (UTWeb)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#REDCap">REDCap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#box">box</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/run_models.html">Run models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/create_plots.html">Create plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/process_data.html">Process data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_data.html#start">start</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html">Eyetracking demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Import-packages.">Import packages.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Set-task-parameters,-either-directly-from-PsychoPy-or-created-manually.">Set task parameters, either directly from PsychoPy or created manually.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Initialize-the-imhr.eyetracking-package.">Initialize the imhr.eyetracking package.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Connect-to-the-Eyelink-Host.">Connect to the Eyelink Host.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Set-the-dominamt-eye.">Set the dominamt eye.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Start-calibration.">Start calibration.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#(Optional)-Print-message-to-console/terminal.">(Optional) Print message to console/terminal.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#(Optional)-Drift-correction.">(Optional) Drift correction.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Start-recording.">Start recording.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Example-use-of-eyetracking.sample().">Example use of eyetracking.sample().</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Stop-recording.">Stop recording.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/eyetracking_demo.html#Close-PsychoPy.">Close PsychoPy.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/roi/index.html">Region of Interest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Document-Tree">Document Tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#ROI-Detection">ROI Detection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Highlighted-ROI-from-Photoshop-(.psd)">Highlighted ROI from Photoshop (.psd)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Classified-using-Haar-Cascades">Classified using Haar Cascades</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Boundary-Shape">Boundary Shape</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Polygon">Polygon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Hull">Hull</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Circle">Circle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Rectangle-(rotated)">Rectangle (rotated)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Rectangle-(straight)">Rectangle (straight)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Output-Format">Output Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Excel-(.xlsx)">Excel (.xlsx)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#EyeLink-DataViewer-(.ias)">EyeLink DataViewer (.ias)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../studies/R33/index.html">R33</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../studies/Webgazer/index.html">Webgazer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.Download.html">imhr.Download</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.eyetracking.html">imhr.eyetracking</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.plot.html">imhr.plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.r33.html">imhr.r33</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.tests.html">imhr.tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/imhr.tests.test_basic.html">imhr.tests.test_basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/imhr.tests.test_roi.html">imhr.tests.test_roi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.settings.html">imhr.settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.Webgazer.html">imhr.Webgazer</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
	<div class="imhr-bars">
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
	</div>
	<div class="row">
<div class="toc col-md-3" style="width: 25%;">
	<div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a></li>
</ul>

	</div>
</div>
		<div class="col-md-9 content">
			
  <h1>Source code for imhr.r33._classify</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">| @purpose: Classification of eyetracking data for imhr.r33.procesing.   </span>
<span class="sd">| @date: Created on Sat May 1 15:12:38 2019   </span>
<span class="sd">| @author: Semeon Risom   </span>
<span class="sd">| @email: semeon.risom@gmail.com   </span>
<span class="sd">| @url: https://semeon.io/d/R33-analysis  </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># available functions</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Classify&#39;</span><span class="p">]</span>

<span class="c1"># required external library</span>
<span class="n">__required__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span><span class="s1">&#39;nslr&#39;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">pdb</span> <span class="k">import</span> <span class="n">set_trace</span> <span class="k">as</span> <span class="n">breakpoint</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># local libraries</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">settings</span>

<div class="viewcode-block" id="Classify"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify">[docs]</a><span class="k">class</span> <span class="nc">Classify</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;Analysis methods for imhr.processing.preprocesing.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isLibrary</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Analysis methods for imhr.processing.preprocesing.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		isLibrary : :obj:`bool`</span>
<span class="sd">			Check if required libraries are available. Default `False`.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1">#check libraries</span>
		<span class="k">if</span> <span class="n">isLibrary</span><span class="p">:</span>
			<span class="n">settings</span><span class="o">.</span><span class="n">library</span><span class="p">(</span><span class="n">__required__</span><span class="p">)</span>

<div class="viewcode-block" id="Classify.VisualAngle"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify.VisualAngle">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">VisualAngle</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">g_x</span><span class="p">,</span> <span class="n">g_y</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Convert pixel eye-coordinates to visual angle.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		g_x,g_y : :class:`numpy.ndarray`</span>
<span class="sd">			List of gaze coordinates.</span>
<span class="sd">		drift : :obj:`dict`</span>
<span class="sd">			Counter of drift correct runs.</span>
<span class="sd">		config : :class:`dict`</span>
<span class="sd">			Configuration data for data analysis. i.e. trial number, location.</span>

<span class="sd">		Notes</span>
<span class="sd">		-----</span>
<span class="sd">		* Stimulus positions (g_x,g_y) are defined in x and y pixel units, with the origin (0,0) being at the **center** of </span>
<span class="sd">		  the display, as to match the PsychoPy pix unit coord type.  </span>
<span class="sd">		* The pix2deg method is vectorized, meaning that is will perform the pixel to angle calculations on all elements </span>
<span class="sd">		  of the provided pixel position numpy arrays in one numpy call.  </span>
<span class="sd">		* The convertion process can use either a fixed eye to calibration plane distance, or a numpy array of eye distances </span>
<span class="sd">		  passed as eye_distance_mm. In this case the eye distance array must be the same length as g_x, g_y arrays.  </span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">d_x</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;monitor.cm&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">d_y</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;monitor.cm&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">r_x</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;resolution.px&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">r_y</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;resolution.px&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">dist</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span>
		<span class="n">mmpp_x</span> <span class="o">=</span> <span class="n">d_x</span><span class="o">/</span><span class="n">r_x</span>
		<span class="n">mmpp_y</span> <span class="o">=</span> <span class="n">d_y</span><span class="o">/</span><span class="n">r_y</span>

		<span class="n">x_mm</span> <span class="o">=</span> <span class="n">mmpp_x</span> <span class="o">*</span> <span class="n">g_x</span>
		<span class="n">y_mm</span> <span class="o">=</span> <span class="n">mmpp_y</span> <span class="o">*</span> <span class="n">g_y</span>

		<span class="n">breakpoint</span><span class="p">()</span> <span class="c1">#TODO!</span>

		<span class="n">Ah</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">x_mm</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">y_mm</span><span class="p">))</span>
		<span class="n">Av</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y_mm</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">x_mm</span><span class="p">))</span>

		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">Ah</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">Av</span><span class="p">)</span>   </div>

<div class="viewcode-block" id="Classify.Velocity"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify.Velocity">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">Velocity</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">d_x</span><span class="p">,</span> <span class="n">d_y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Calculate the instantaneous velocity (degrees / second) for data points in d_x and (optionally) d_y, using the </span>
<span class="sd">		time numpy array for time delta information.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		time : :class:`numpy.ndarray`</span>
<span class="sd">			Timestamp of each coordinate.</span>
<span class="sd">		d_x,d_y : :class:`numpy.ndarray`</span>
<span class="sd">			List of gaze coordinates.</span>
<span class="sd">		config : :class:`dict`</span>
<span class="sd">			Configuration data for data analysis. i.e. trial number, location.</span>

<span class="sd">		Notes</span>
<span class="sd">		-----</span>
<span class="sd">		Numpy arrays time, d_x, and d_y must all be 1D arrays of the same length. If both d_x and d_y are provided, then</span>
<span class="sd">		the euclidian distance between each set of points is calculated and used in the velocity calculation. Time must be</span>
<span class="sd">		in seconds.msec units, while d_x and d_y are expected to be in visual degrees. If the position traces</span>
<span class="sd">		are in pixel coordinate space, use the VisualAngleCalc class to convert the data into degrees.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">d_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">data</span><span class="o">=</span><span class="n">d_x</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_x</span><span class="o">*</span><span class="n">d_x</span><span class="o">+</span><span class="n">d_y</span><span class="o">*</span><span class="n">d_y</span><span class="p">)</span>

		<span class="n">velocity_between</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">time</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">velocity</span> <span class="o">=</span> <span class="p">(</span><span class="n">velocity_between</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">velocity_between</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
		<span class="k">return</span> <span class="n">velocity</span></div>

<div class="viewcode-block" id="Classify.Acceleration"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify.Acceleration">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">Acceleration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Calculate the acceleration (deg/sec/sec) for data points in d_x and (optionally) d_y, using the time numpy array for</span>
<span class="sd">		time delta information.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		time : :class:`numpy.ndarray`</span>
<span class="sd">			Timestamp of each coordinate.</span>
<span class="sd">		d_x,d_y : :class:`numpy.ndarray`</span>
<span class="sd">			List of gaze coordinates.</span>
<span class="sd">		config : :class:`dict`</span>
<span class="sd">			Configuration data for data analysis. i.e. trial number, location.</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">velocity</span><span class="o">=</span><span class="n">Velocity</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">data_x</span><span class="p">,</span><span class="n">data_y</span><span class="p">)</span>
		<span class="n">accel</span> <span class="o">=</span> <span class="n">Velocity</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">velocity</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">accel</span></div>

<div class="viewcode-block" id="Classify.savitzky_golay"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify.savitzky_golay">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">savitzky_golay</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Smooth (and optionally differentiate) data with a Savitzky-Golay filter.</span>

<span class="sd">		The Savitzky-Golay filter removes high frequency noise from data. It has the advantage of preserving the original</span>
<span class="sd">		shape and features of the signal better than other types of filtering approaches, such as moving averages techniques.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		y : :class:`numpy.ndarray`, shape (N,)</span>
<span class="sd">			the values of the time history of the signal.</span>
<span class="sd">		window_size : :obj:`int`</span>
<span class="sd">			the length of the window. Must be an odd integer number.</span>
<span class="sd">		order : :obj:`int`</span>
<span class="sd">			the order of the polynomial used in the filtering.</span>
<span class="sd">			Must be less then `window_size` - 1.</span>
<span class="sd">		deriv : :obj:`int`</span>
<span class="sd">			the order of the derivative to compute (default = 0 means only smoothing)</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		ys : :class:`numpy.ndarray`, shape (N)</span>
<span class="sd">			the smoothed signal (or it&#39;s n-th derivative).</span>

<span class="sd">		Notes</span>
<span class="sd">		-----</span>
<span class="sd">		The Savitzky-Golay is a type of low-pass filter, particularly suited for smoothing noisy data. The main idea behind this</span>
<span class="sd">		approach is to make for each point a least-square fit with a polynomial of high order over a odd-sized window centered at</span>
<span class="sd">		the point. For more information, see: http://wiki.scipy.org/Cookbook/SavitzkyGolay.</span>

<span class="sd">		Examples</span>
<span class="sd">		--------</span>
<span class="sd">		&gt;&gt;&gt; t = np.linspace(-4, 4, 500)</span>
<span class="sd">		&gt;&gt;&gt; y = np.exp( -t**2 ) + np.random.normal(0, 0.05, t.shape)</span>
<span class="sd">		&gt;&gt;&gt; ysg = savitzky_golay(y, window_size=31, order=4)</span>
<span class="sd">		&gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">		&gt;&gt;&gt; plt.plot(t, y, label=&#39;Noisy signal&#39;)</span>
<span class="sd">		&gt;&gt;&gt; plt.plot(t, np.exp(-t**2), &#39;k&#39;, lw=1.5, label=&#39;Original signal&#39;)</span>
<span class="sd">		&gt;&gt;&gt; plt.plot(t, ysg, &#39;r&#39;, label=&#39;Filtered signal&#39;)</span>
<span class="sd">		&gt;&gt;&gt; plt.legend()</span>
<span class="sd">		&gt;&gt;&gt; plt.show()</span>

<span class="sd">		References</span>
<span class="sd">		----------</span>
<span class="sd">		.. [1] A. Savitzky, Golay, M. (1964). Smoothing and Differentiation of Data by Simplified Least Squares Procedures. </span>
<span class="sd">			Analytical Chemistry. 36(8), pp 1627-1639.</span>

<span class="sd">		.. [2] S.A. Teukolsky, W.T. Vetterling, B.P. Flannery Numerical Recipes 3rd Edition: The Art of Scientific </span>
<span class="sd">			Computing. W.H. Press,Cambridge University Press ISBN-13: 9780521880688.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
		<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">factorial</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">window_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">window_size</span><span class="p">))</span>
			<span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">order</span><span class="p">))</span>
		<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;window_size and order have to be of type int&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">window_size</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">window_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;window_size size must be a positive odd number&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">window_size</span> <span class="o">&lt;</span> <span class="n">order</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;window_size is too small for the polynomials order&quot;</span><span class="p">)</span>
		<span class="n">order_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">half_window</span> <span class="o">=</span> <span class="p">(</span><span class="n">window_size</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
		<span class="c1"># precompute coefficients</span>
		<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mat</span><span class="p">([[</span><span class="n">k</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">order_range</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">half_window</span><span class="p">,</span> <span class="n">half_window</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
		<span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">A</span><span class="p">[</span><span class="n">deriv</span><span class="p">]</span> <span class="o">*</span> <span class="n">rate</span><span class="o">**</span><span class="n">deriv</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">deriv</span><span class="p">)</span>
		<span class="c1"># pad the signal at the extremes with</span>
		<span class="c1"># values taken from the signal itself</span>
		<span class="n">firstvals</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">half_window</span><span class="o">+</span><span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="c1">#breakpoint() #TODO!</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
			<span class="n">y_m1</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">y_m1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">lastvals</span> <span class="o">=</span> <span class="n">y_m1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="n">half_window</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_m1</span><span class="p">)</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">firstvals</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">lastvals</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span> <span class="n">m</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Classify.ivt"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify.ivt">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">ivt</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">data</span><span class="p">,</span> <span class="n">v_threshold</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Identification with Velocity Threshold.</span>

<span class="sd">		In the I-VT model, the velocity value is computed for every eye position sample.  The velocity value is then compared </span>
<span class="sd">		to the threshold. If the sampled velocity is less than the threshold, the corresponding eye-position sample is </span>
<span class="sd">		marked as part of a fixation, otherwise it is marked as a part of a saccade.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		data : :class:`numpy.ndarray`, shape (N,)</span>
<span class="sd">			the smoothed signal (or it&#39;s n-th derivative).</span>
<span class="sd">		v_threshold : :obj:`str`</span>
<span class="sd">			Velocity threshold in pix/sec.</span>
<span class="sd">		config : :class:`dict`</span>
<span class="sd">			Configuration data for data analysis. i.e. trial number, location.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		ys : :class:`numpy.ndarray`, shape (N,)</span>
<span class="sd">			the smoothed signal (or it&#39;s n-th derivative).</span>

<span class="sd">		Notes</span>
<span class="sd">		-----</span>
<span class="sd">		From https://github.com/ecekt/eyegaze. Formula from: https://dl.acm.org/citation.cfm?id=355028</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">l_time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>

		<span class="n">ts</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">l_time</span><span class="p">:</span>
			<span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span>

		<span class="n">Xs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
		<span class="n">Ys</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

		<span class="n">difX</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">difY</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">tdif</span> <span class="o">=</span> <span class="p">[]</span>


		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
			<span class="n">difX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Xs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">Xs</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="n">difY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Ys</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">Ys</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="n">tdif</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l_time</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">l_time</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

		<span class="n">dif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">difX</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">difY</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="c1">#in pix</span>
		<span class="c1">#print (dif)</span>

		<span class="n">velocity</span> <span class="o">=</span> <span class="n">dif</span> <span class="o">/</span> <span class="n">tdif</span>
		<span class="c1">#print velocity in pix/sec</span>
		<span class="c1">#print tdif</span>

		<span class="n">mvmts</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#length is len(data)-1</span>

		<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">velocity</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="n">v_threshold</span><span class="p">):</span>
				<span class="c1">#fixation</span>
				<span class="n">mvmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
				<span class="c1">#print v, v_threshold</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">mvmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

		<span class="n">fixations</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>


		<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mvmts</span><span class="p">)):</span>
			<span class="k">if</span><span class="p">(</span><span class="n">mvmts</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
				<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
					<span class="n">fixations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
					<span class="n">fs</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">fs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

		<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
			<span class="n">fixations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

		<span class="c1">#print fixations</span>
		<span class="n">centroidsX</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">centroidsY</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">time0</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">time1</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fixations</span><span class="p">:</span>
			<span class="n">cX</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">cY</span> <span class="o">=</span> <span class="mi">0</span>

			<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
				<span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">cX</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="mf">2.0</span>
				<span class="n">cY</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="mf">2.0</span>
				<span class="n">t0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
				<span class="n">t1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

			<span class="k">else</span><span class="p">:</span>
				<span class="n">t0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
				<span class="n">t1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

				<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)):</span>

					<span class="n">cX</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="p">]])</span> 
					<span class="n">cY</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">[</span><span class="n">e</span><span class="p">]])</span>

				<span class="n">cX</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> 
				<span class="n">cY</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> 

				<span class="n">cX</span> <span class="o">=</span> <span class="n">cX</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">cY</span> <span class="o">=</span> <span class="n">cY</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

			<span class="n">centroidsX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cX</span><span class="p">)</span>
			<span class="n">centroidsY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cY</span><span class="p">)</span>
			<span class="n">time0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
			<span class="n">time1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>

		<span class="c1">#create dataframe</span>
		<span class="n">cxy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">centroidsX</span><span class="p">,</span> <span class="n">centroidsY</span><span class="p">,</span> <span class="n">time0</span><span class="p">,</span> <span class="n">time1</span><span class="p">]),</span> 
					 <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="s1">&#39;cy&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>

		<span class="k">return</span> <span class="n">cxy_df</span></div>

<div class="viewcode-block" id="Classify.hmm"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify.hmm">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">hmm</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Hidden Makov Model, adapted from https://gitlab.com/nslr/nslr-hmm.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		data : :class:`pandas.DataFrame`</span>
<span class="sd">			Pandas dataframe of x,y and timestamp positions.</span>
<span class="sd">		filter_type : :class:`dict`</span>
<span class="sd">			Types of filters to use.</span>
<span class="sd">		config : :class:`dict`</span>
<span class="sd">			Configuration data for data analysis. i.e. trial number, location.</span>

<span class="sd">		Attributes</span>
<span class="sd">		----------</span>
<span class="sd">		data : :class:`numpy.ndarray`</span>
<span class="sd">			The smoothed signal (or it&#39;s n-th derivative).</span>
<span class="sd">		dr_th : :obj:`str`</span>
<span class="sd">			Data threshold.</span>

<span class="sd">		Notes</span>
<span class="sd">		-----</span>
<span class="sd">		**Definitions**</span>
<span class="sd">			* **Saccade**: The saccade is a ballistic movement, meaning it is pre-programmed and does not change once it</span>
<span class="sd">			  has started. Saccades of amplitude 40° peak at velocities of 300–600°/s and last for 80–150 ms.</span>
<span class="sd">			* **Fixation**: The point between any two saccades, during which the eyes are relatively stationary and</span>
<span class="sd">			  virtually all visual input occurs. Regular eye movement alternates between saccades and visual fixations, the</span>
<span class="sd">			  notable exception being in smooth pursuit.</span>
<span class="sd">			* **Smooth pursuit**: Smooth pursuit movements are much slower tracking movements of the eyes designed to</span>
<span class="sd">			  keep a moving stimulus on the fovea. Such movements are under voluntary control in the sense that the observer</span>
<span class="sd">			  can choose whether or not to track a moving stimulus. (Neuroscience 2nd edition).</span>

<span class="sd">		References</span>
<span class="sd">		----------</span>
<span class="sd">		.. [1] Pekkanen, J., &amp; Lappi, O. (2017). A new and general approach to signal denoising and eye movement</span>
<span class="sd">			classification based on segmented linear regression. Scientific Reports, 7(1). doi:10.1038/s41598-017-17983-x.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">nslr_hmm</span>

		<span class="n">t</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

		<span class="c1">#class_df (list of fixations), c_sample (list of samples with associated classification)</span>
		<span class="n">class_df</span><span class="p">,</span> <span class="n">c_sample</span> <span class="o">=</span> <span class="n">nslr_hmm</span><span class="o">.</span><span class="n">classify_gaze</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

		<span class="c1">#keep fixation events only</span>
		<span class="n">class_df</span> <span class="o">=</span> <span class="n">class_df</span><span class="p">[(</span><span class="n">class_df</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>

		<span class="c1">#if trial has at least one fixation</span>
		<span class="k">if</span> <span class="n">class_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
			<span class="c1">###split cxy0 tuple into cx0 and cy0</span>
			<span class="n">class_df</span><span class="p">[[</span><span class="s1">&#39;cx0&#39;</span><span class="p">,</span> <span class="s1">&#39;cy0&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">class_df</span><span class="p">[</span><span class="s1">&#39;cxy0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> 
			<span class="c1">###split cxy0 tuple into cx1 and cy1 </span>
			<span class="n">class_df</span><span class="p">[[</span><span class="s1">&#39;cx1&#39;</span><span class="p">,</span> <span class="s1">&#39;cy1&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">class_df</span><span class="p">[</span><span class="s1">&#39;cxy1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>

			<span class="c1">###drop column</span>
			<span class="n">class_df</span> <span class="o">=</span> <span class="n">class_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;cxy0&#39;</span><span class="p">,</span><span class="s1">&#39;cxy1&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

			<span class="c1">###merge c_sample</span>
			<span class="n">data</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_class&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filter_type</span><span class="p">)]</span> <span class="o">=</span> <span class="n">c_sample</span>

		<span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">class_df</span></div>

<div class="viewcode-block" id="Classify.idt"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify.idt">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">idt</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">data</span><span class="p">,</span> <span class="n">dis_threshold</span><span class="p">,</span> <span class="n">dur_threshold</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Identification with Dispersion Threshold.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		data : :class:`numpy.ndarray`</span>
<span class="sd">			The smoothed signal (or it&#39;s n-th derivative).</span>
<span class="sd">		dr_th : :obj:`str`</span>
<span class="sd">			Fixation duration threshold in pix/msec</span>
<span class="sd">		di_th : :obj:`str`</span>
<span class="sd">			Dispersion threshold in pixels</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		ys : :class:`numpy.ndarray`</span>
<span class="sd">			The smoothed signal (or it&#39;s n-th derivative).</span>

<span class="sd">		Notes</span>
<span class="sd">		-----</span>
<span class="sd">		The I-DT algorithm has two parameters: a dispersion threshold and the length of a time window in which the dispersion </span>
<span class="sd">		is calculated. The length of the time window is often set to the minimum duration of a fixation, which is around</span>
<span class="sd">		100-200 ms.</span>

<span class="sd">		&quot;&quot;&quot;</span>

		<span class="n">current</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#pointer to represent the current beginning point of the window</span>
		<span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="c1">#final lists for fixation info</span>
		<span class="n">centroidsX</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">centroidsY</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">time0</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">time1</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="k">while</span> <span class="p">(</span><span class="n">current</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>

			<span class="n">t0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">current</span><span class="p">])</span> <span class="c1">#beginning time</span>
			<span class="n">t1</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">dur_threshold</span><span class="p">)</span>     <span class="c1">#time after a min. fix. threshold has been observed</span>

			<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span> 
				<span class="k">if</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">])</span><span class="o">&gt;=</span> <span class="n">t0</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">r</span><span class="p">])</span><span class="o">&lt;=</span> <span class="n">t1</span><span class="p">):</span>
					<span class="c1">#print &quot;if&quot;,r</span>
					<span class="n">last</span> <span class="o">=</span> <span class="n">r</span> <span class="c1">#this will find the last index still in the duration threshold</span>


			<span class="c1">#now check the dispersion in this window</span>
			<span class="c1">#print &quot;window&quot;, current, last</span>
			<span class="n">points</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">current</span><span class="p">:</span><span class="n">last</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">dispersion</span> <span class="o">=</span> <span class="mi">0</span>

			<span class="n">argxmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
			<span class="n">argxmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>

			<span class="n">argymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
			<span class="n">argymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>

			<span class="n">dispersion</span> <span class="o">=</span> <span class="p">((</span><span class="n">argxmax</span> <span class="o">-</span> <span class="n">argxmin</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">argymax</span> <span class="o">-</span> <span class="n">argymin</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">dispersion</span> <span class="o">&lt;=</span> <span class="n">dis_threshold</span><span class="p">):</span>

				<span class="c1">#add new points</span>
				<span class="k">while</span><span class="p">(</span><span class="n">dispersion</span> <span class="o">&lt;=</span> <span class="n">dis_threshold</span> <span class="ow">and</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>

					<span class="n">last</span> <span class="o">+=</span> <span class="mi">1</span>

					<span class="n">points</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">current</span><span class="p">:</span><span class="n">last</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
					<span class="n">dispersion</span> <span class="o">=</span> <span class="mi">0</span>

					<span class="n">argxmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
					<span class="n">argxmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>

					<span class="n">argymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>
					<span class="n">argymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">))</span>

					<span class="n">dispersion</span> <span class="o">=</span> <span class="p">((</span><span class="n">argxmax</span> <span class="o">-</span> <span class="n">argxmin</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">argymax</span> <span class="o">-</span> <span class="n">argymin</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>

				<span class="c1">#dispersion threshold is exceeded</span>
				<span class="c1">#fixation at the centroid [current,last]</span>

				<span class="n">cX</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="n">cY</span> <span class="o">=</span> <span class="mi">0</span>

				<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
					<span class="n">cX</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">])</span>
					<span class="n">cY</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">])</span>

				<span class="n">cX</span> <span class="o">=</span> <span class="n">cX</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">cY</span> <span class="o">=</span> <span class="n">cY</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">current</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

				<span class="n">t0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">current</span><span class="p">])</span>
				<span class="n">t1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">][</span><span class="n">last</span><span class="p">])</span>

				<span class="n">centroidsX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cX</span><span class="p">)</span>
				<span class="n">centroidsY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cY</span><span class="p">)</span>
				<span class="n">time0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
				<span class="n">time1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>

				<span class="n">current</span> <span class="o">=</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1">#this will move the pointer to a novel window</span>

			<span class="k">else</span><span class="p">:</span>
				<span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">#this will remove the first point</span>
				<span class="n">last</span> <span class="o">=</span> <span class="n">current</span> <span class="c1">#this is not necessary</span>

		<span class="c1">#create dataframe</span>
		<span class="n">cxy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">centroidsX</span><span class="p">,</span> <span class="n">centroidsY</span><span class="p">,</span> <span class="n">time0</span><span class="p">,</span> <span class="n">time1</span><span class="p">]),</span> 
					 <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="s1">&#39;cy&#39;</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span><span class="s1">&#39;end&#39;</span><span class="p">])</span>

		<span class="k">return</span> <span class="n">cxy_df</span></div>

<div class="viewcode-block" id="Classify.simple"><a class="viewcode-back" href="../../../api/imhr.r33._classify.html#imhr.r33.Classify.simple">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">simple</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">maxdist</span><span class="p">,</span> <span class="n">mindur</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Detects fixations, defined as consecutive samples with an inter-sample distance of less than a set amount of </span>
<span class="sd">		pixels (disregarding missing data).</span>
<span class="sd">   </span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		df : :class:`pandas.DataFrame`</span>
<span class="sd">			Pandas dataframe of x,y and timestamp positions</span>
<span class="sd">		missing : :obj:`str`</span>
<span class="sd">			Value to be used for missing data (default = 0.0)</span>
<span class="sd">		maxdist : :obj:`str`</span>
<span class="sd">			Maximal inter-sample distance in pixels (default = 25)</span>
<span class="sd">		mindur : :obj:`str`</span>
<span class="sd">			Minimal duration of a fixation in milliseconds; detected fixation cadidates will be </span>
<span class="sd">			disregarded if they are below this duration (default = 100).</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		Sfix : :class:`numpy.ndarray` shape (N)</span>
<span class="sd">			list of lists, each containing [starttime]</span>
<span class="sd">		Efix : :class:`numpy.ndarray` shape (N)</span>
<span class="sd">			list of lists, each containing [starttime, endtime, duration, endx, endy]</span>

<span class="sd">		Notes</span>
<span class="sd">		-----</span>
<span class="sd">		From https://github.com/esdalmaijer/PyGazeAnalyser/blob/master/pygazeanalyser/detectors.py</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
		<span class="n">time</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
		<span class="c1"># empty list to contain data</span>
		<span class="n">Sfix</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">Efix</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="c1"># loop through all coordinates</span>
		<span class="n">si</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">fixstart</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
			<span class="c1"># calculate Euclidean distance from the current fixation coordinate</span>
			<span class="c1"># to the next coordinate</span>
			<span class="n">dist</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">si</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">si</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
			<span class="c1"># check if the next coordinate is below maximal distance</span>
			<span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">maxdist</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fixstart</span><span class="p">:</span>
				<span class="c1"># start a new fixation</span>
				<span class="n">si</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">i</span>
				<span class="n">fixstart</span> <span class="o">=</span> <span class="kc">True</span>
				<span class="n">Sfix</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
			<span class="k">elif</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="n">maxdist</span> <span class="ow">and</span> <span class="n">fixstart</span><span class="p">:</span>
				<span class="c1"># end the current fixation</span>
				<span class="n">fixstart</span> <span class="o">=</span> <span class="kc">False</span>
				<span class="c1"># only store the fixation if the duration is ok</span>
				<span class="k">if</span> <span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Sfix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mindur</span><span class="p">:</span>
					<span class="n">Efix</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">Sfix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Sfix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">si</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">si</span><span class="p">]])</span>
				<span class="c1"># delete the last fixation start if it was too short</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">Sfix</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">si</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">i</span>
			<span class="k">elif</span> <span class="ow">not</span> <span class="n">fixstart</span><span class="p">:</span>
				<span class="n">si</span> <span class="o">+=</span> <span class="mi">1</span>


		<span class="c1">#return Sfix, Efix</span>
		<span class="k">return</span> <span class="n">Sfix</span><span class="p">,</span> <span class="n">Efix</span></div></div>
</pre></div>

		</div>
		  
	</div>
</div>
<footer class="footer">
	<div class="container">
		<div>
			<div>&copy; Copyright 2019, </div>
			<div><a href="https://semeon.io/">Semeon Risom</a>.</div>
			<div>Updated 2019-05-23T18:08:55-05:00.</div>
		</div>
	</div>
</footer>
  </body>
</html>