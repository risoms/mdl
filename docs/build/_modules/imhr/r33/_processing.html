<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>imhr.r33._processing &#8212; imhr 0.3.37 documentation</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/semeon/css/user.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script type="text/javascript" src="../../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/clipboard.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/user.js"></script>
    <script type="text/javascript" src="../../../_static/semeon/js/copybutton.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../../_static/imhr.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="description" content="Results from our feasibility study for in-browser eyetracking.">
<meta name="author" content="Semeon Risom">
<meta name="email" content="semeon.risom@gmail.com">
<meta name="robots" content="index,follow">
<meta name="AdsBot-Google" content="noindex">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          imhr</a>
        <span class="navbar-text navbar-version pull-left"><b>2019-06-02.0.3.37</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../genindex.html">Glossary</a></li>
                <li><a href="../../../install.html">Install</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#installing">Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#accesesing-raw-data">Accesesing Raw Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../features.html#relational-plots">Relational plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/process_demographics.html">Process demographics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#get-metadata">get metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#prepare-data">prepare data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#demographic-statistics">demographic statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#list-of-variables">list of variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#descriptive-device">descriptive device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#descriptive-task">descriptive task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/process_demographics.html#summary-data">summary data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/download_data.html">Download data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#raw-data-(UTWeb)">raw data (UTWeb)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#REDCap">REDCap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/R33/download_data.html#box">box</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/run_models.html">Run models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/R33/create_plots.html">Create plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/eyetracking/_psychopy/index.html">PsychoPy Builder</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/_psychopy/index.html#Before-Running-the-Participant">Before Running the Participant</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html">Eyetracking demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Before-Running-the-Participant">Before Running the Participant</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Import-package">Import package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Initialize-imhr.eyetracking.Eyelink">Initialize <code class="docutils literal notranslate"><span class="pre">imhr.eyetracking.Eyelink</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Connect-to-the-Eyelink-Host">Connect to the Eyelink Host</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Preparing-the-Participant">Preparing the Participant</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Set-the-dominant-eye">Set the dominant eye</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Start-calibration">Start calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#(Optional)-Print-message-to-console/terminal">(Optional) Print message to console/terminal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#(Optional)-Drift-correction">(Optional) Drift correction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Task-Starting">Task Starting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Start-recording">Start recording</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#(Optional)-Initiate-gaze-contigent-event">(Optional) Initiate gaze contigent event</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#(Optional)-Collect-real-time-gaze-coordinates-from-Eyelink">(Optional) Collect real-time gaze coordinates from Eyelink</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#(Optional)-Send-messages-to-Eyelink">(Optional) Send messages to Eyelink</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Task-Ending">Task Ending</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Stop-recording">Stop recording</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Finish-recording">Finish recording</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Close-PsychoPy">Close PsychoPy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Other-Resources">Other Resources</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../examples/eyetracking/demo/index.html#Calculate-Visual-Angle">Calculate Visual Angle</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/roi/index.html">Region of Interest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Parameters">Parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Required-Parameters">Required Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Optional-Parameters">Optional Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Creating-ROI">Creating ROI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Manual-coding">Manual coding</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Haar-Cascades">Haar Cascades</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../examples/roi/index.html#Output">Output</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Bounds">Bounds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../examples/roi/index.html#Data">Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../studies/R33/index.html">R33</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../studies/Webgazer/index.html">Webgazer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/index.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.data.html">imhr.data</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.eyetracking.html">imhr.eyetracking</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.r33.html">imhr.r33</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.tests.html">imhr.tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/imhr.tests.test_basic.html">imhr.tests.test_basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/imhr.tests.test_roi.html">imhr.tests.test_roi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/imhr.tests.test_eyetracking.html">imhr.tests.test_eyetracking</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.settings.html">imhr.settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/imhr.Webgazer.html">imhr.Webgazer</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/index.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
	<div class="imhr-bars">
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
	</div>
	<div class="row">
<div class="toc col-md-3" style="width: 25%;">
	<div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../studies/index.html">Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/index.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/imhr.html">API Reference</a></li>
</ul>

	</div>
</div>
		<div class="col-md-9 content">
			
  <h1>Source code for imhr.r33._processing</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">pdb</span> <span class="k">import</span> <span class="n">set_trace</span> <span class="k">as</span> <span class="n">breakpoint</span>

<span class="c1"># local</span>
<span class="kn">import</span> <span class="nn">imhr</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">settings</span><span class="p">,</span> <span class="n">data</span>

<span class="n">__required__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pandas&#39;</span><span class="p">,</span><span class="s1">&#39;numpy&#39;</span><span class="p">]</span>

<span class="c1"># check if packages ae available</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">glob</span>
	<span class="kn">import</span> <span class="nn">os</span>
	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
	<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
	<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
	<span class="kn">import</span> <span class="nn">datetime</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
	<span class="n">pkg</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span>
	<span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cv2&#39;</span><span class="p">:</span><span class="s1">&#39;opencv-python&#39;</span><span class="p">,</span> <span class="s1">&#39;psd_tools&#39;</span><span class="p">:</span><span class="s1">&#39;psd-tools&#39;</span><span class="p">}</span>
	<span class="n">pkg</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">pkg</span><span class="p">]</span> <span class="k">if</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="n">pkg</span>
	<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No module named &#39;</span><span class="si">%s</span><span class="s2">&#39;. Please install from PyPI before continuing.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">pkg</span><span class="p">),</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Processing"><a class="viewcode-back" href="../../../api/imhr.r33._processing.html#imhr.r33.Processing">[docs]</a><span class="k">class</span> <span class="nc">Processing</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;Hub for running processing and analyzing raw data.&quot;&quot;&quot;</span>
	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Hub for running processing and analyzing raw data.</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		**kwargs : :obj:`str` or :obj:`None`, optional</span>
<span class="sd">			Optional properties to control how this class will run:</span>

<span class="sd">			These properties control additional core parameters for the API:</span>

<span class="sd">			.. list-table::</span>
<span class="sd">				:class: kwargs</span>
<span class="sd">				:widths: 25 50</span>
<span class="sd">				:header-rows: 1</span>

<span class="sd">				* - Property</span>
<span class="sd">				  - Description</span>
<span class="sd">				* - **cores** : :obj:`bool`</span>
<span class="sd">				  - (if **isMultiprocessing** == **True**) Number of cores to use. Default is total available cores - 1.</span>
<span class="sd">				* - **isLibrary** : :obj:`bool`</span>
<span class="sd">				  - Check if required packages have been installed. Default is **False**.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">imhr</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>

		<span class="c1"># get console and time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">console</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">console</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">debug</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">time</span>

		<span class="c1"># check library</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">isLibrary</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;isLibrary&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;isLibrary&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">False</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLibrary</span><span class="p">:</span>
			<span class="n">settings</span><span class="o">.</span><span class="n">library</span><span class="p">(</span><span class="n">__required__</span><span class="p">)</span>


<div class="viewcode-block" id="Processing.preprocessing"><a class="viewcode-back" href="../../../api/imhr.r33._processing.html#imhr.r33.Processing.preprocessing">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">preprocessing</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">isMultiprocessing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cores</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Preprocessing data for formatting and initial calculations. Steps include:</span>
<span class="sd">		* Dates converted to ISO format.</span>
<span class="sd">		* Variables formatted to camelCase.</span>
<span class="sd">		* Variables naming patterns consistant (i.e. osFullName, browserFullName).</span>
<span class="sd">		* Calculations for  stimulus onset error,  DotLoc onset error, median response time, median stimulus onset error, median DotLoc onset error</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		source : [type]</span>
<span class="sd">			[description]</span>
<span class="sd">		isMultiprocessing : bool, optional</span>
<span class="sd">			[description], by default False</span>
<span class="sd">		cores : int, optional</span>
<span class="sd">			[description], by default 0</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		df : :obj:`pandas.DataFrame`</span>
<span class="sd">			Pandas dataframe output.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">core</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">queue</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
			<span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">			Parameters</span>
<span class="sd">			----------</span>
<span class="sd">			directory : [type], optional</span>
<span class="sd">				[description], by default None</span>
<span class="sd">			core : [type], optional</span>
<span class="sd">				[description], by default None</span>
<span class="sd">			queue : [type], optional</span>
<span class="sd">				[description], by default None</span>

<span class="sd">			Returns</span>
<span class="sd">			-------</span>
<span class="sd">			[type]</span>
<span class="sd">				[description]</span>
<span class="sd">			&quot;&quot;&quot;</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;processing.preprocessing.run(); core: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">core</span><span class="p">),</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>
			<span class="c1"># constants</span>
			<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

			<span class="c1"># for each subject</span>
			<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
				<span class="c1"># filename</span>
				<span class="n">name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
				<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;reading: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

				<span class="c1">#collect subject data </span>
				<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">float_precision</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">)</span>

				<span class="c1"># drop practice</span>
				<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Prac&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

				<span class="c1"># rename variables</span>
				<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lum&#39;</span><span class="p">:</span><span class="s1">&#39;luminance&#39;</span><span class="p">,</span><span class="s1">&#39;isWindowSuccess&#39;</span><span class="p">:</span><span class="s1">&#39;isCalibrated&#39;</span><span class="p">,</span><span class="s1">&#39;windowSize.px&#39;</span><span class="p">:</span><span class="s1">&#39;windowSize&#39;</span><span class="p">,</span>
				<span class="s1">&#39;monitorSize.px&#39;</span><span class="p">:</span><span class="s1">&#39;monitorSize&#39;</span><span class="p">,</span><span class="s1">&#39;webcamSize.px&#39;</span><span class="p">:</span><span class="s1">&#39;webcamSize&#39;</span><span class="p">,</span><span class="s1">&#39;diagonalSize.in&#39;</span><span class="p">:</span><span class="s1">&#39;diagonalSize&#39;</span><span class="p">,</span><span class="s1">&#39;sample_time&#39;</span><span class="p">:</span><span class="s1">&#39;sampleTime&#39;</span><span class="p">,</span>
				<span class="s1">&#39;Key_Resp.rt&#39;</span><span class="p">:</span><span class="s1">&#39;KeyRespRt&#39;</span><span class="p">,</span><span class="s1">&#39;Key_Resp.acc&#39;</span><span class="p">:</span><span class="s1">&#39;KeyRespAcc&#39;</span><span class="p">,</span><span class="s1">&#39;DotLoc_onset.t&#39;</span><span class="p">:</span><span class="s1">&#39;dotLocOnset&#39;</span><span class="p">,</span><span class="s1">&#39;Stim_onset.t&#39;</span><span class="p">:</span><span class="s1">&#39;stimOnset&#39;</span><span class="p">})</span>

				<span class="c1"># calculate errors</span>
				<span class="c1"># stimulus onset</span>
				<span class="n">df</span><span class="p">[</span><span class="s1">&#39;diffStim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;stimOnset&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1500</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
				<span class="c1"># dotloc onset</span>
				<span class="n">df</span><span class="p">[</span><span class="s1">&#39;diffDotLoc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;dotLocOnset&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1500</span> <span class="o">+</span> <span class="mi">4500</span><span class="p">))</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;iaps&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;dotLocOnset&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="mi">1500</span> <span class="o">+</span> <span class="mi">3000</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

				<span class="c1"># get median onset error</span>
				<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mDiffDotLoc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;participant&quot;</span><span class="p">])[</span><span class="s1">&#39;diffDotLoc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
				<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mDiffStim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;participant&quot;</span><span class="p">])[</span><span class="s1">&#39;diffStim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
				<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mRT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;participant&quot;</span><span class="p">])[</span><span class="s1">&#39;KeyRespRt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
				<span class="n">df</span><span class="p">[</span><span class="s1">&#39;sAcc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;participant&quot;</span><span class="p">])[</span><span class="s1">&#39;KeyRespAcc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>

				<span class="c1"># format data</span>
				<span class="c1">## adjust size back to value before manually multiplying by devicePixelratio</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="c1">## split</span>
					<span class="n">df</span><span class="p">[[</span><span class="s1">&#39;monitorWidth&#39;</span><span class="p">,</span><span class="s1">&#39;monitorHeight&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorSize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)]))</span>
					<span class="c1">## unscale</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorWidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorWidth&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;devicePixelRatio&#39;</span><span class="p">]</span>           
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorHeight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorHeight&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;devicePixelRatio&#39;</span><span class="p">]</span>
					<span class="c1"># #recombine</span>
					<span class="n">df</span><span class="p">[</span><span class="s2">&quot;monitorSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorWidth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorHeight&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
					<span class="c1"># console message</span>
					<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;Error - file </span><span class="si">%s</span><span class="s1">; error: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;monitor&#39;</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
					<span class="c1"># store error</span>
					<span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="p">)])</span>
					<span class="k">pass</span>
				<span class="c1">## process date</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span> <span class="c1"># convert to pandas datetime format</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
					<span class="c1"># console message</span>
					<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;Error - file </span><span class="si">%s</span><span class="s1">; error: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
					<span class="c1"># store error</span>
					<span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="p">)])</span>
					<span class="k">pass</span>
				<span class="c1">## gpu</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpu&#39;</span><span class="p">]</span>
					<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gpu&#39;</span><span class="p">])</span>
					<span class="c1">### gpu type</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;integrated&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;AMD&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;gpuType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dedicated&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Nvidia&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;gpuType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dedicated&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;NVIDIA&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;gpuType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dedicated&#39;</span>
					<span class="c1">### gpu brand</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ANGLE &#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(A&#39;</span> <span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(I&#39;</span> <span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(N&#39;</span> <span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;vs_5_&#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ps_5_&#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;vs_3_&#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;ps_3_&#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; 0 0)&#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(R)&#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(TM)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;OpenGL&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Engine&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Direct3D11&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Direct3D9Ex&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Family&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Mesa DRI &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; (Skylake GT2)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>  
					<span class="c1">### remove trailing whitespace in gpu  </span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
					<span class="c1"># console message</span>
					<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;Error - file </span><span class="si">%s</span><span class="s1">; error: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;gpu&#39;</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
					<span class="c1"># store error</span>
					<span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="p">)])</span>
					<span class="k">pass</span>
				<span class="c1">## webcam device</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;WebcamDevice&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;WebcamDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
					<span class="c1"># console message</span>
					<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;Error - file </span><span class="si">%s</span><span class="s1">; error: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;WebcamDevice&#39;</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
					<span class="c1"># store error</span>
					<span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="p">)])</span>
					<span class="k">pass</span>
				<span class="c1">## browser</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;browser&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
					<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;browser&#39;</span><span class="p">])</span>
					<span class="c1">### browser brand</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Chrome&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;browserBrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Chrome&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Safari&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;browserBrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Safari&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Edge&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;browserBrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Edge&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Firefox&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;browserBrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Firefox&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;IE&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;browserBrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;IE&#39;</span>
					<span class="c1">### browser version</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;Chrome&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;aAbBcC&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;Safari&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;aAbBcC&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;Edge&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;aAbBcC&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;Firefox&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;aAbBcC&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;IE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;aAbBcC&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
					<span class="c1"># console message</span>
					<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;Error - file </span><span class="si">%s</span><span class="s1">; error: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
					<span class="c1"># store error</span>
					<span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="p">)])</span>
					<span class="k">pass</span>
				<span class="c1">## os</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;osFullName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
					<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;os&#39;</span><span class="p">])</span>
					<span class="c1">###os brand</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;osFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Windows&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;osBrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Microsoft Windows&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;osFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Mac&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;osBrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;macOS&#39;</span>
					<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;osFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Chrome&#39;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="s1">&#39;osBrand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Chrome OS&#39;</span>
					<span class="c1">### os version</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;osVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;osFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;Windows&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;aAbBcC&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;osVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;osVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;Mac OS X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;aAbBcC&#39;</span><span class="p">))</span>  
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;osVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;osVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;Chrome OS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;aAbBcC&#39;</span><span class="p">))</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;osVersion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;osVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
					<span class="c1"># console message</span>
					<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;Error - file </span><span class="si">%s</span><span class="s1">; error: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
					<span class="c1"># store error</span>
					<span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="p">)])</span>
					<span class="k">pass</span>
				<span class="c1">## clean unusual dpi     </span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;devicePixelRatio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;devicePixelRatio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
					<span class="c1"># console message</span>
					<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;Error - file </span><span class="si">%s</span><span class="s1">; error: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="s1">&#39;devicePixelRatio&#39;</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
					<span class="c1"># store error</span>
					<span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="p">)])</span>
					<span class="k">pass</span>

				<span class="c1"># resave</span>
				<span class="c1">## check folder</span>
				<span class="n">_folder</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/preprocessed/&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
				<span class="n">_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
				<span class="n">_filepath</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_folder</span><span class="p">,</span><span class="n">_name</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_folder</span><span class="p">):</span>
					<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>				
				<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">_filepath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
				<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;preprocessed file saved to: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_filepath</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

			<span class="c1"># add to multithreading queue</span>
			<span class="k">if</span> <span class="n">isMultiprocessing</span><span class="p">:</span>
				<span class="c1">#queue</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span> <span class="n">errors</span> <span class="o">=</span> <span class="kc">None</span>
				<span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

			<span class="k">if</span> <span class="ow">not</span> <span class="n">isMultiprocessing</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">errors</span>

		<span class="c1"># finished</span>
		<span class="k">def</span> <span class="nf">finished</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
			<span class="sd">&quot;&quot;&quot;[summary]</span>

<span class="sd">			Parameters</span>
<span class="sd">			----------</span>
<span class="sd">			output : [type]</span>
<span class="sd">				[description]</span>

<span class="sd">			Returns</span>
<span class="sd">			-------</span>
<span class="sd">			[type]</span>
<span class="sd">				[description]</span>
<span class="sd">			&quot;&quot;&quot;</span>
			<span class="k">if</span> <span class="n">isMultiprocessing</span><span class="p">:</span>
				<span class="c1"># create df_error</span>
				<span class="c1"># check if errors are empty</span>
				<span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">error</span><span class="p">:</span> 
					<span class="n">df_error</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
					<span class="k">return</span> <span class="n">df_error</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">return</span> <span class="kc">None</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">output</span>

		<span class="c1"># imports</span>
		<span class="kn">import</span> <span class="nn">multiprocessing</span>

		<span class="c1"># start</span>
		<span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
		<span class="n">_f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;starting processing.preprocessing()&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>

		<span class="c1"># get directory</span>
		<span class="n">d_</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">source</span> <span class="o">+</span> <span class="s2">&quot;/*.csv&quot;</span><span class="p">)</span>

		<span class="c1"># check if multiproccessing</span>
		<span class="c1">## if requested cores is 1, run without multiprocessing</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">cores</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">cores</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">isMultiprocessing</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)):</span>
			<span class="n">isMultiprocessing</span> <span class="o">=</span> <span class="kc">False</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;processing.preprocessing() not multiprocessing&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>
		<span class="c1">## else if requested cores are less than/equal 7, and less than available cores plus 1</span>
		<span class="k">elif</span> <span class="p">((</span><span class="n">cores</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">cores</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
			<span class="n">isMultiprocessing</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="n">d_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">d_</span><span class="p">,</span> <span class="n">cores</span><span class="p">)</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;processing.preprocessing() multiprocessing with </span><span class="si">%s</span><span class="s1"> cores&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cores</span><span class="p">),</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>
		<span class="c1">## else use less than half of total available cores</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">isMultiprocessing</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="n">cores</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cores</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
			<span class="n">d_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">d_</span><span class="p">,</span> <span class="n">cores</span><span class="p">)</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;processing.preprocessing() multiprocessing with </span><span class="si">%s</span><span class="s1"> cores&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cores</span><span class="p">),</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>

		<span class="c1"># starting</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">isMultiprocessing</span><span class="p">:</span>
			<span class="c1"># start</span>
			<span class="n">output</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">d_</span><span class="p">,</span> <span class="n">cores</span><span class="p">)</span>
			<span class="c1"># finished</span>
			<span class="n">df_error</span> <span class="o">=</span> <span class="n">finished</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
			<span class="c1"># end</span>
			<span class="k">return</span> <span class="n">df_error</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># start</span>
			<span class="c1">## collect each pipe (this is used to build send and recieve portions of output)</span>
			<span class="n">queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
			<span class="c1"># collect each thread</span>
			<span class="n">process</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">d_p</span><span class="p">[</span><span class="n">core</span><span class="p">],</span> <span class="n">core</span><span class="p">,</span> <span class="n">queue</span><span class="p">,))</span> <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cores</span><span class="p">)]</span>
			<span class="c1">## start each thread</span>
			<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">process</span><span class="p">:</span>
				<span class="n">p</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
				<span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
			<span class="c1">## return queues</span>
			<span class="c1"># note: see https://stackoverflow.com/a/45829852</span>
			<span class="n">returns</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">process</span><span class="p">:</span>
				<span class="n">returns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
			<span class="c1">## wait for each process to finish</span>
			<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">process</span><span class="p">:</span>
				<span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

			<span class="c1"># finished</span>
			<span class="n">df_error</span> <span class="o">=</span> <span class="n">finished</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">returns</span><span class="p">)</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>

			<span class="c1"># end</span>
			<span class="k">return</span> <span class="n">df_error</span></div>

<div class="viewcode-block" id="Processing.summary"><a class="viewcode-back" href="../../../api/imhr.r33._processing.html#imhr.r33.Processing.summary">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isHTML</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Generate summary from online raw data.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		source : :obj:`str`</span>
<span class="sd">			Source path.</span>
<span class="sd">		destination : :obj:`str`</span>
<span class="sd">			Destination path.</span>
<span class="sd">		metadata : :obj:`str`</span>
<span class="sd">			Metadata path.</span>
<span class="sd">		isHTML : :obj:`bool`</span>
<span class="sd">			Whether or not to export html.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		df : :obj:`pandas.DataFrame`</span>
<span class="sd">			Pandas dataframe output.</span>
<span class="sd">		error : :obj:`pandas.DataFrame`</span>
<span class="sd">			Pandas dataframe error output.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="c1">#timestamp</span>
		<span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
		<span class="n">_f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;starting processing.summary()&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>

		<span class="c1"># constant</span>
		<span class="n">df_all</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="c1"># get directory</span>
		<span class="n">directory</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">source</span> <span class="o">+</span> <span class="s2">&quot;/*.csv&quot;</span><span class="p">)</span>

		<span class="c1">## for each subject</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
			<span class="c1"># filename</span>
			<span class="n">name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
			<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;reading: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

			<span class="c1">#collect metadata </span>
			<span class="n">df_</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

			<span class="c1"># try reading each participants raw data</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">df_</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[[</span>
				 <span class="s1">&#39;participant&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;session&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;code&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;expName&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;date&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;heap.used&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;heap.limit&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;osFullName&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;osBrand&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;osVersion&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;gpuFullName&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;gpuType&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;browserFullName&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;browserBrand&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;browserVersion&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;isWebcamUsed&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;WebcamMessage&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;WebcamDevice&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;webcamSize&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;luminance&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;isCalibrated&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;monitorSize&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;windowSize&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;diagonalSize&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;devicePixelRatio&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;isPageVisible&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;isFullscreen&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;scaling&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

				<span class="c1"># append to list of files</span>
				<span class="n">df_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
				<span class="c1"># console message</span>
				<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;Error - file </span><span class="si">%s</span><span class="s1">; error: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">error</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
				<span class="c1"># store error</span>
				<span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="p">)])</span>
				<span class="k">pass</span>
		<span class="c1"># combine dataframes, save data</span>
		<span class="c1"># summary</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_all</span><span class="p">)</span>
		<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span><span class="s1">&#39;session&#39;</span><span class="p">])</span>

		<span class="c1"># get metadata</span>
		<span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1">## import online metadata file</span>
			<span class="n">df_metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
			<span class="n">df_metadata</span> <span class="o">=</span> <span class="n">df_metadata</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;subsession&#39;</span><span class="p">])</span>
			<span class="n">df_metadata</span> <span class="o">=</span> <span class="n">df_metadata</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;subject&#39;</span><span class="p">:</span><span class="s1">&#39;participant&#39;</span><span class="p">})</span>
			<span class="n">df_metadata</span> <span class="o">=</span> <span class="n">df_metadata</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="c1">## exclude bogus participant</span>
			<span class="n">df_metadata</span> <span class="o">=</span> <span class="n">df_metadata</span><span class="p">[</span><span class="o">~</span><span class="n">df_metadata</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;5uEl74dsH2&#39;</span><span class="p">])]</span>
			<span class="c1">## convert both participant columns to float</span>
			<span class="n">df</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
			<span class="n">df</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
			<span class="n">df_metadata</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_metadata</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
			<span class="n">df_metadata</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_metadata</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
			<span class="c1">## merge</span>
			<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_metadata</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span><span class="s1">&#39;session&#39;</span><span class="p">])</span>

		<span class="c1"># number of subjects</span>
		<span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">subjectnum</span> <span class="o">=</span> <span class="n">df_</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>

		<span class="c1"># save</span>
		<span class="c1">## check folder</span>
		<span class="n">_folder</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
		<span class="n">_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_folder</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>
		<span class="c1">## save data</span>
		<span class="n">df</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
		<span class="n">df</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
		<span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span><span class="s1">&#39;session&#39;</span><span class="p">])</span>
		<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;data saved to: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">destination</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
		<span class="c1">## errors</span>
		<span class="n">error_destination</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">_error.xlsx&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_folder</span><span class="p">,</span> <span class="n">_name</span><span class="p">)</span>
		<span class="n">df_error</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
		<span class="n">df_error</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">error_destination</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;errors saved to: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">error_destination</span><span class="p">),</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>

		<span class="c1"># export html</span>
		<span class="k">if</span> <span class="n">isHTML</span><span class="p">:</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;summary&quot;</span>
			<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/mdl-admin/Desktop/r33/data/html/summary/index.html&quot;</span>
			<span class="n">html_title</span> <span class="o">=</span> <span class="s1">&#39;Participant characteristics&#39;</span>
			<span class="n">figure_title</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Table 1.&lt;/b&gt; Participant characteristics (N = </span><span class="si">%s</span><span class="s1">).&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subjectnum</span><span class="p">))</span>
			<span class="n">footnote</span> <span class="o">=</span> <span class="s2">&quot;&lt;div id=&#39;note&#39;&gt;N = Summary data for all participants.&quot;</span>
			<span class="n">HTML</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">html_title</span><span class="o">=</span><span class="n">html_title</span><span class="p">,</span> <span class="n">figure_title</span><span class="o">=</span><span class="n">figure_title</span><span class="p">,</span> <span class="n">footnote</span><span class="o">=</span><span class="n">footnote</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">HTML</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">HTML</span></div>

<div class="viewcode-block" id="Processing.variables"><a class="viewcode-back" href="../../../api/imhr.r33._processing.html#imhr.r33.Processing.variables">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">variables</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">isHTML</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Output list of variables for easy html viewing.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		source : :obj:`str`</span>
<span class="sd">			Source path.</span>
<span class="sd">		destination : :obj:`str`</span>
<span class="sd">			Destination path.</span>
<span class="sd">		isHTML : :obj:`bool`</span>
<span class="sd">			Whether or not to export html.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		df_definitions : :class:`pandas.DataFrame`</span>
<span class="sd">			Variables output.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="c1">#timestamp</span>
		<span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
		<span class="n">_f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;starting processing.variables()&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>

		<span class="c1">#collect source</span>
		<span class="n">ext</span> <span class="o">=</span> <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="c1">## if xlsx</span>
		<span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.xlsx&#39;</span><span class="p">:</span>
			<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
		<span class="c1">## if csv</span>
		<span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.csv&#39;</span><span class="p">:</span>
			<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

		<span class="c1">#blank df for appending</span>
		<span class="n">df_v</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

		<span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
			<span class="c1">#&#39;bias&#39;: [&#39;score&#39;,&#39;baseline&#39;],</span>
			<span class="s1">&#39;behavioral&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;trialNumTask&#39;</span><span class="p">,</span><span class="s1">&#39;trialID&#39;</span><span class="p">,</span><span class="s1">&#39;DotLoc&#39;</span><span class="p">,</span><span class="s1">&#39;LEmotion&#39;</span><span class="p">,</span><span class="s1">&#39;LStim&#39;</span><span class="p">,</span><span class="s1">&#39;LDescription&#39;</span><span class="p">,</span><span class="s1">&#39;REmotion&#39;</span><span class="p">,</span><span class="s1">&#39;RStim&#39;</span><span class="p">,</span><span class="s1">&#39;RDescription&#39;</span><span class="p">,</span><span class="s1">&#39;trialType&#39;</span><span class="p">,</span>
			 <span class="s1">&#39;isCongruent&#39;</span><span class="p">,</span><span class="s1">&#39;event&#39;</span><span class="p">,</span>
			<span class="s1">&#39;KeyRespRt&#39;</span><span class="p">,</span><span class="s1">&#39;KeyRespAcc&#39;</span><span class="p">,</span><span class="s1">&#39;mRT&#39;</span><span class="p">,</span><span class="s1">&#39;sAcc&#39;</span><span class="p">,</span><span class="s1">&#39;dotLocOnset&#39;</span><span class="p">,</span><span class="s1">&#39;stimOnset&#39;</span><span class="p">,</span><span class="s1">&#39;diffDotLoc&#39;</span><span class="p">,</span><span class="s1">&#39;diffStim&#39;</span><span class="p">,</span><span class="s1">&#39;mDiffDotLoc&#39;</span><span class="p">,</span><span class="s1">&#39;mDiffStim&#39;</span><span class="p">],</span>
			<span class="s1">&#39;eyetracking&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sampleNum&#39;</span><span class="p">,</span><span class="s1">&#39;sampleTime&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">],</span>
			<span class="s1">&#39;device&#39;</span><span class="p">:[</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span><span class="s1">&#39;session&#39;</span><span class="p">,</span><span class="s1">&#39;code&#39;</span><span class="p">,</span><span class="s1">&#39;expName&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">,</span> <span class="s1">&#39;gpuType&#39;</span><span class="p">,</span> <span class="s1">&#39;browserFullName&#39;</span><span class="p">,</span>
		       <span class="s1">&#39;browserBrand&#39;</span><span class="p">,</span> <span class="s1">&#39;browserVersion&#39;</span><span class="p">,</span> <span class="s1">&#39;osFullName&#39;</span><span class="p">,</span> <span class="s1">&#39;osBrand&#39;</span><span class="p">,</span> <span class="s1">&#39;osVersion&#39;</span><span class="p">,</span><span class="s1">&#39;heap.used&#39;</span><span class="p">,</span><span class="s1">&#39;heap.limit&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;isWebcamUsed&#39;</span><span class="p">,</span><span class="s1">&#39;WebcamMessage&#39;</span><span class="p">,</span><span class="s1">&#39;WebcamDevice&#39;</span><span class="p">,</span> <span class="s1">&#39;webcamSize&#39;</span><span class="p">,</span><span class="s1">&#39;luminance&#39;</span><span class="p">,</span><span class="s1">&#39;isCalibrated&#39;</span><span class="p">,</span> <span class="s1">&#39;monitorSize&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;windowSize&#39;</span><span class="p">,</span><span class="s1">&#39;diagonalSize&#39;</span><span class="p">,</span><span class="s1">&#39;devicePixelRatio&#39;</span><span class="p">,</span><span class="s1">&#39;isPageVisible&#39;</span><span class="p">,</span><span class="s1">&#39;isFullscreen&#39;</span><span class="p">,</span><span class="s1">&#39;scaling&#39;</span><span class="p">]</span>
		<span class="p">}</span>

		<span class="c1">#for each source</span>
		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="c1">#convert to correct formats</span>
			<span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="s1">&#39;example&#39;</span><span class="p">})</span>

			<span class="c1">#add column for definitions, type; reorganize</span>
			<span class="n">df_</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;type&#39;</span><span class="p">})[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
			<span class="n">df_</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
			<span class="n">df_</span> <span class="o">=</span> <span class="n">df_</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="s1">&#39;group&#39;</span><span class="p">]]</span>

			<span class="c1">#if key == behavioral, add row for trialnum, and trialnum_</span>
			<span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="s1">&#39;behavioral&#39;</span><span class="p">:</span>
				<span class="n">df_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TrialNum&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;behavioral&#39;</span><span class="p">]</span>
				<span class="n">df_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TrialNum_&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;behavioral&#39;</span><span class="p">]</span>
				<span class="n">df_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;behavioral&#39;</span><span class="p">]</span>
				<span class="n">df_</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;trialType_&#39;</span><span class="p">,</span><span class="s1">&#39;object&#39;</span><span class="p">,</span><span class="s1">&#39;iaps&#39;</span><span class="p">,</span><span class="s1">&#39;behavioral&#39;</span><span class="p">]</span>

			<span class="c1">#append</span>
			<span class="n">df_v</span> <span class="o">=</span> <span class="n">df_v</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_</span><span class="p">)</span>

		<span class="c1">#reset index</span>
		<span class="n">df_v</span> <span class="o">=</span> <span class="n">df_v</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="c1">#import list of definitions and add to dataframe</span>
		<span class="c1">#to initially get list of variable to fill in definitions #df_variable.to_csv(definitions_path, index=None)</span>

		<span class="c1">#import definitions and merge to variables list</span>
		<span class="kn">import</span> <span class="nn">imhr</span>
		<span class="n">f_</span> <span class="o">=</span> <span class="n">imhr</span><span class="o">.</span><span class="vm">__file__</span>
		<span class="n">p_</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f_</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
		<span class="n">s_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/imhr/dist/r33/definitions.xlsx&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">p_</span><span class="p">)</span>
		<span class="n">df_d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">s_</span><span class="p">)</span>
		<span class="n">df_v</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_v</span><span class="p">,</span> <span class="n">df_d</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>

		<span class="c1">#change order</span>
		<span class="n">df_v</span> <span class="o">=</span> <span class="n">df_v</span><span class="p">[[</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span><span class="s1">&#39;group&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="s1">&#39;definition&#39;</span><span class="p">]]</span>

		<span class="c1"># export</span>
		<span class="c1">## check folder</span>
		<span class="n">_folder</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
		<span class="n">_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_folder</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>
		<span class="n">df_v</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

		<span class="c1"># export html</span>
		<span class="k">if</span> <span class="n">isHTML</span><span class="p">:</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;definitions&quot;</span>
			<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/mdl-admin/Desktop/r33/data/html/definitions/index.html&quot;</span>
			<span class="n">html_title</span> <span class="o">=</span> <span class="s1">&#39;Participant characteristics&#39;</span>
			<span class="n">figure_title</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Table 1.&lt;/b&gt; Task Variables and Definitions.&#39;</span>
			<span class="n">HTML</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_v</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">html_title</span><span class="o">=</span><span class="n">html_title</span><span class="p">,</span> <span class="n">figure_title</span><span class="o">=</span><span class="n">figure_title</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">HTML</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">df_v</span><span class="p">,</span> <span class="n">HTML</span></div>

<div class="viewcode-block" id="Processing.device"><a class="viewcode-back" href="../../../api/imhr.r33._processing.html#imhr.r33.Processing.device">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">device</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">isHTML</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Output list of variables for easy html viewing.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		source : :obj:`str`</span>
<span class="sd">			Source path.</span>
<span class="sd">		destination : :obj:`str`</span>
<span class="sd">			Destination path.</span>
<span class="sd">		isHTML : :obj:`bool`</span>
<span class="sd">			Whether or not to export html.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		df_definitions : :class:`pandas.DataFrame`</span>
<span class="sd">			Variables output.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="c1">#timestamp</span>
		<span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
		<span class="n">_f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;starting processing.variables()&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
		
		<span class="n">df_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
		<span class="c1"># get subjects</span>
		<span class="n">subjectnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
		<span class="n">N</span> <span class="o">=</span> <span class="n">subjectnum</span>
		<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="c1">##--------os browser gpu type Webcam resolution Webcam message</span>
		<span class="n">os_</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;osBrand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">os_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Operating System&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">os_</span>

		<span class="c1"># ##--------os_version</span>
		<span class="n">os_</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;osFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">os_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Operating System version&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">os_</span>
		    
		<span class="c1">##--------browser</span>
		<span class="n">browser</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;browserBrand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">browser</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Browser brand&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">browser</span>

		<span class="c1">##--------browser_version</span>
		<span class="n">browser</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;browserVersion&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">browser</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Browser version&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">browser</span>

		<span class="c1">##--------gpu type </span>
		<span class="n">gpu_type</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;gpuType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">gpu_type</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;GPU type&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">gpu_type</span>

		<span class="c1">##--------gpu brand</span>
		<span class="n">gpu</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;gpuFullName&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">gpu</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;GPU model&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">gpu</span>

		<span class="c1">##--------devicepixelratio</span>
		<span class="n">display</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;devicePixelRatio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">display</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;devicePixelRatio&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">display</span>
		    
		<span class="c1">##--------display resolution</span>
		<span class="n">display</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;monitorSize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">display</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Display resolution&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">display</span>

		<span class="c1">##--------webcam message</span>
		<span class="n">webcam_m</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;WebcamMessage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">webcam_m</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Webcam message&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>

		<span class="c1">##--------webcam brand</span>
		<span class="n">webcamb</span> <span class="o">=</span> <span class="n">df_s</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="s2">&quot;session&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;WebcamDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">webcamb</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Webcam brand&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">webcamb</span>   

		<span class="c1">##--------Webcam resolution</span>
		<span class="n">webcamr</span> <span class="o">=</span> <span class="n">df_s</span><span class="p">[</span><span class="o">~</span><span class="n">df_s</span><span class="p">[</span><span class="s1">&#39;webcamSize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;.x.&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span>
		                <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;webcamSize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">webcamr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		    <span class="n">above_pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Webcam resolution&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">above_pct</span><span class="p">)])</span>
		<span class="k">del</span> <span class="n">webcamr</span>

		<span class="c1">#-------to df</span>
		<span class="n">descriptive</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
		<span class="n">descriptive</span> <span class="o">=</span> <span class="n">descriptive</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Statistic&#39;</span><span class="p">})</span>
		<span class="k">del</span> <span class="n">descriptive</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>

		<span class="c1">#footnote</span>
		<span class="c1"># export</span>
		<span class="c1">## check folder</span>
		<span class="n">_folder</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
		<span class="n">_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_folder</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>
		<span class="n">descriptive</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

		<span class="c1"># export html</span>
		<span class="k">if</span> <span class="n">isHTML</span><span class="p">:</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;device&quot;</span>
			<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/mdl-admin/Desktop/r33/data/html/device/index.html&quot;</span>
			<span class="n">html_title</span> <span class="o">=</span> <span class="s1">&#39;Device characteristics&#39;</span>
			<span class="n">figure_title</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Table 1.&lt;/b&gt; Device characteristics (N = </span><span class="si">%s</span><span class="s1">).&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
			<span class="n">footnote</span> <span class="o">=</span> <span class="p">[</span>
			<span class="s1">&#39;&lt;div class=&quot;description&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
			    <span class="s1">&#39;N = Number of sessions for all subjects. During data collection, participants screen resolution were multiplied by the pixel density ratio, or</span><span class="se">\</span>
<span class="s1">			    &lt;a class=&quot;ref&quot; href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio&quot;&gt;&lt;i&gt;devicePixelRatio&lt;/i&gt;&lt;/a&gt;</span><span class="se">\</span>
<span class="s1">			    (i.e. width = screen.width / devicePixelRatio = 1920 * 1.5). This was done with the intent of storing true device </span><span class="se">\</span>
<span class="s1">			    physical resolution. However to simplify analysis using webgazer, which uses the same initial value </span><span class="se">\</span>
<span class="s1">			    to calculate gaze location, participants screen resolution is reverted back to its original value.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
			<span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
			<span class="n">footnote</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">footnote</span><span class="p">)</span>

			<span class="n">HTML</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">descriptive</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">html_title</span><span class="o">=</span><span class="n">html_title</span><span class="p">,</span> <span class="n">figure_title</span><span class="o">=</span><span class="n">figure_title</span><span class="p">,</span> <span class="n">footnote</span><span class="o">=</span><span class="n">footnote</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">HTML</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
		
		<span class="k">return</span> <span class="n">descriptive</span><span class="p">,</span> <span class="n">HTML</span></div>

<div class="viewcode-block" id="Processing.demographics"><a class="viewcode-back" href="../../../api/imhr.r33._processing.html#imhr.r33.Processing.demographics">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">demographics</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">isHTML</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Output list of demographics for easy html viewing.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		source : :obj:`str`</span>
<span class="sd">			Source path.</span>
<span class="sd">		destination : :obj:`str`</span>
<span class="sd">			Destination path.</span>
<span class="sd">		isHTML : :obj:`bool`</span>
<span class="sd">			Whether or not to export html.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		df_definitions : :class:`pandas.DataFrame`</span>
<span class="sd">			demographics output.</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="c1">#timestamp</span>
		<span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
		<span class="n">_f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;starting processing.variables()&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
		
		<span class="c1">#get data</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

		<span class="c1"># rename</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
			<span class="n">columns</span><span class="o">=</span><span class="p">{</span>
				<span class="s1">&#39;record_id&#39;</span><span class="p">:</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_age&#39;</span><span class="p">:</span><span class="s1">&#39;age&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_english&#39;</span><span class="p">:</span><span class="s1">&#39;english_fluency&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_student&#39;</span><span class="p">:</span><span class="s1">&#39;is_student&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_austin&#39;</span><span class="p">:</span><span class="s1">&#39;austin&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_smartphone&#39;</span><span class="p">:</span><span class="s1">&#39;smartphone&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_vision&#39;</span><span class="p">:</span><span class="s1">&#39;is_normalvision&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_corrected_vision&#39;</span><span class="p">:</span><span class="s1">&#39;is_corrective&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_handedness&#39;</span><span class="p">:</span><span class="s1">&#39;is_handedness&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_cigarettes&#39;</span><span class="p">:</span><span class="s1">&#39;cigarettes&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_gender___1&#39;</span><span class="p">:</span><span class="s1">&#39;male&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_gender___2&#39;</span><span class="p">:</span><span class="s1">&#39;female&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_gender___3&#39;</span><span class="p">:</span><span class="s1">&#39;transmale&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_gender___4&#39;</span><span class="p">:</span><span class="s1">&#39;transfemale&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_gender___5&#39;</span><span class="p">:</span><span class="s1">&#39;genderqueer&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_gender___6&#39;</span><span class="p">:</span><span class="s1">&#39;other&#39;</span><span class="p">,</span>
				<span class="s1">&#39;es_gender___7&#39;</span><span class="p">:</span><span class="s1">&#39;no&#39;</span>
		<span class="p">})</span> 
		<span class="c1">#normal vision</span>
		<span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_normalvision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_normalvision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="c1">#corrective</span>
		<span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_corrective&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;is_corrective&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		

	    <span class="c1">#create gender column</span>
		<span class="n">df</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;es_gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,],</span> <span class="p">[</span><span class="s1">&#39;male&#39;</span><span class="p">,</span><span class="s1">&#39;female&#39;</span><span class="p">,</span><span class="s1">&#39;transmale&#39;</span><span class="p">,</span><span class="s1">&#39;transfemale&#39;</span><span class="p">,</span><span class="s1">&#39;genderqueer&#39;</span><span class="p">,</span><span class="s1">&#39;other&#39;</span><span class="p">,</span><span class="s1">&#39;no&#39;</span><span class="p">])</span>
		
		<span class="c1"># race</span>
		<span class="c1">###AIAN</span>
		<span class="n">race_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;es_race___1&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
		<span class="n">race_2</span> <span class="o">=</span> <span class="s1">&#39;American Indian or Alaska Native&#39;</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">race_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">race_2</span><span class="p">})</span>
		<span class="n">df</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">race_2</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">###asian</span>
		<span class="n">race_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;es_race___2&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
		<span class="n">race_2</span> <span class="o">=</span> <span class="s1">&#39;Asian&#39;</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">race_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">race_2</span><span class="p">})</span>
		<span class="n">df</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">race_2</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">###black</span>
		<span class="n">race_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;es_race___3&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
		<span class="n">race_2</span> <span class="o">=</span> <span class="s1">&#39;Black or African American&#39;</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">race_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">race_2</span><span class="p">})</span>
		<span class="n">df</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">race_2</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">###pacific</span>
		<span class="n">race_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;es_race___4&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
		<span class="n">race_2</span> <span class="o">=</span> <span class="s1">&#39;Native Hawaiian and Other Pacific Islander&#39;</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">race_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">race_2</span><span class="p">})</span>
		<span class="n">df</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">race_2</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">###white</span>
		<span class="n">race_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;es_race___5&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
		<span class="n">race_2</span> <span class="o">=</span> <span class="s1">&#39;White&#39;</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">race_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">race_2</span><span class="p">})</span>
		<span class="n">df</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">race_2</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">###none</span>
		<span class="n">race_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;es_race___6&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
		<span class="n">race_2</span> <span class="o">=</span> <span class="s1">&#39;None of the above&#39;</span>
		<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">race_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">race_2</span><span class="p">})</span>
		<span class="n">df</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">race_2</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">race_2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

		<span class="c1">##collapse</span>
		<span class="n">race</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;American Indian or Alaska Native&#39;</span><span class="p">,</span><span class="s1">&#39;Asian&#39;</span><span class="p">,</span><span class="s1">&#39;Black or African American&#39;</span><span class="p">,</span>
			  <span class="s1">&#39;Native Hawaiian and Other Pacific Islander&#39;</span><span class="p">,</span><span class="s1">&#39;White&#39;</span><span class="p">,</span><span class="s1">&#39;None of the above&#39;</span><span class="p">]</span>
		<span class="n">df</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">race</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="c1">##create new mixed race group</span>
		<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">),</span> <span class="s1">&#39;race&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Two or more races&#39;</span>
		
		<span class="c1">##convert to categorical</span>
		<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;race&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
		<span class="c1">##finish</span>
		<span class="n">df</span>  <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;participant&#39;</span><span class="p">,</span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="s1">&#39;is_handedness&#39;</span><span class="p">,</span><span class="s1">&#39;english_fluency&#39;</span><span class="p">,</span><span class="s1">&#39;is_student&#39;</span><span class="p">,</span><span class="s1">&#39;is_normalvision&#39;</span><span class="p">,</span><span class="s1">&#39;is_corrective&#39;</span><span class="p">,</span><span class="s1">&#39;race&#39;</span><span class="p">,</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span>
			   <span class="s1">&#39;zipcode&#39;</span><span class="p">,</span><span class="s1">&#39;austin&#39;</span><span class="p">,</span><span class="s1">&#39;smartphone&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

		<span class="c1"># subject number</span>
		<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

		<span class="c1"># constants</span>
		<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>

		<span class="c1">#----normal vision, corrective vision, handedness, hispanic</span>
		<span class="n">l_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Vision&#39;</span><span class="p">,</span><span class="s1">&#39;Vision&#39;</span><span class="p">,</span><span class="s1">&#39;Right-Handed (%)&#39;</span><span class="p">,</span><span class="s1">&#39;Austin Resident (%)&#39;</span><span class="p">,</span><span class="s1">&#39;Smartphone User (%)&#39;</span><span class="p">]</span>
		<span class="n">l_group</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span><span class="s1">&#39;Corrective&#39;</span><span class="p">,</span> <span class="s1">&#39;Handedness&#39;</span><span class="p">,</span> <span class="s1">&#39;Austin local&#39;</span><span class="p">,</span> <span class="s1">&#39;Smartphone&#39;</span><span class="p">]</span>
		<span class="n">l_category</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;is_normalvision&#39;</span><span class="p">,</span><span class="s1">&#39;is_corrective&#39;</span><span class="p">,</span><span class="s1">&#39;is_handedness&#39;</span><span class="p">,</span><span class="s1">&#39;austin&#39;</span><span class="p">,</span><span class="s1">&#39;smartphone&#39;</span><span class="p">]</span>
		<span class="n">l_condition</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
		<span class="c1">#Handedness (Right), Corrective, is_corrective, True</span>
		<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">condition</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">l_label</span><span class="p">,</span> <span class="n">l_group</span><span class="p">,</span> <span class="n">l_category</span><span class="p">,</span> <span class="n">l_condition</span><span class="p">):</span>
		    <span class="c1">#cesd low</span>
		    <span class="n">df_sum</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">==</span> <span class="n">condition</span><span class="p">)]</span>
		    <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sum</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
		    <span class="n">pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">pct</span><span class="p">)</span>
		    <span class="c1">#append</span>
		    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">group</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span>

		<span class="c1"># gender, race</span>
		<span class="n">l_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Race&#39;</span><span class="p">,</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span>
		<span class="n">l_category</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">,</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">category</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">l_label</span><span class="p">,</span> <span class="n">l_category</span><span class="p">):</span>
		    <span class="n">l_group</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
		    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">l_group</span><span class="p">:</span>
		        <span class="c1">#cesd low</span>
		        <span class="n">df_sum</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">)]</span>
		        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sum</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
		        <span class="n">pct</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">count</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">pct</span><span class="p">)</span>
		        <span class="c1">#append</span>
		        <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Or&#39;</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;And&#39;</span><span class="p">,</span><span class="s1">&#39;and&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Of&#39;</span><span class="p">,</span><span class="s1">&#39;of&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;The&#39;</span><span class="p">,</span><span class="s1">&#39;the&#39;</span><span class="p">)</span>
		        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">group</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span>


		<span class="n">descriptive</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
		<span class="n">descriptive</span> <span class="o">=</span> <span class="n">descriptive</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Value&#39;</span><span class="p">})</span>

		<span class="c1"># export html</span>
		<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
			<span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;demographic&quot;</span>
			<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/Users/mdl-admin/Desktop/r33/data/html/demographics/index.html&quot;</span>
			<span class="n">html_title</span> <span class="o">=</span> <span class="s1">&#39;Demographic characteristics&#39;</span>
			<span class="n">figure_title</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Table 1.&lt;/b&gt; Demographic characteristics (N = </span><span class="si">%s</span><span class="s1">).&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
			<span class="n">footnote</span> <span class="o">=</span> <span class="p">[</span>
			<span class="s1">&#39;&lt;div class=&quot;description&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
			    <span class="s1">&#39;N = Number of sessions for all subjects. During data collection, participants screen resolution were multiplied by the pixel density ratio, or</span><span class="se">\</span>
<span class="s1">			    &lt;a class=&quot;ref&quot; href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio&quot;&gt;&lt;i&gt;devicePixelRatio&lt;/i&gt;&lt;/a&gt;</span><span class="se">\</span>
<span class="s1">			    (i.e. width = screen.width / devicePixelRatio = 1920 * 1.5). This was done with the intent of storing true device </span><span class="se">\</span>
<span class="s1">			    physical resolution. However to simplify analysis using webgazer, which uses the same initial value </span><span class="se">\</span>
<span class="s1">			    to calculate gaze location, participants screen resolution is reverted back to its original value.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
			<span class="s1">&#39;&lt;/div&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
			<span class="n">footnote</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">footnote</span><span class="p">)</span>

			<span class="n">HTML</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">descriptive</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">html_title</span><span class="o">=</span><span class="n">html_title</span><span class="p">,</span> <span class="n">figure_title</span><span class="o">=</span><span class="n">figure_title</span><span class="p">,</span> <span class="n">footnote</span><span class="o">=</span><span class="n">footnote</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">HTML</span> <span class="o">=</span> <span class="kc">None</span>

		<span class="c1"># finish</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">df</span>	</div>

<div class="viewcode-block" id="Processing.html"><a class="viewcode-back" href="../../../api/imhr.r33._processing.html#imhr.r33.Processing.html">[docs]</a>	<span class="nd">@classmethod</span>
	<span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figure_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intro</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">footnote</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Create HTML output.</span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		destination : :obj:`str`</span>
<span class="sd">			Path to save file to.</span>
<span class="sd">		df : :class:`pandas.DataFrame`</span>
<span class="sd">			Pandas dataframe of analysis results data.</span>
<span class="sd">		raw_data : :class:`pandas.DataFrame`</span>
<span class="sd">			Pandas dataframe of raw data.</span>
<span class="sd">		name : :obj:`str`</span>
<span class="sd">			(py::`if source is logit`) The name of csv file created.</span>
<span class="sd">		path : :obj:`str`</span>
<span class="sd">			The directory path of the html file.</span>
<span class="sd">		source : :obj:`str`</span>
<span class="sd">			The type of data being recieved.</span>
<span class="sd">		figure_title : :obj:`str`</span>
<span class="sd">			The title of the table or figure.</span>
<span class="sd">		intro : :obj:`str`</span>
<span class="sd">			The introduction of the group of figures or tables.</span>
<span class="sd">		footnote : :obj:`str`</span>
<span class="sd">			The footnote of the table or figure.</span>
<span class="sd">		metadata : :obj:`dict`</span>
<span class="sd">			Additional data to be included.</span>
<span class="sd">		**kwargs : :obj:`str`, :obj:`int`, or :obj:`None`, optional</span>
<span class="sd">			Additional properties, relevent for specific content types. Here&#39;s a list of available properties:</span>

<span class="sd">			These properties control additional parameters for displaying figures:</span>

<span class="sd">			.. list-table::</span>
<span class="sd">				:class: kwargs</span>
<span class="sd">				:widths: 25 50</span>
<span class="sd">				:header-rows: 1</span>

<span class="sd">				* - Property</span>
<span class="sd">				  - Description</span>
<span class="sd">				* - **html_title** : :obj:`str`</span>
<span class="sd">				  - HTML title. This is visible on as a header for the html page.</span>
<span class="sd">				* - **metadata** : :obj:`str`</span>
<span class="sd">				  - Additional data to be included.</span>


<span class="sd">			While these properties control additional parameters for displaying bokeh plots:</span>

<span class="sd">			.. list-table::</span>
<span class="sd">				:class: kwargs</span>
<span class="sd">				:widths: 25 50</span>
<span class="sd">				:header-rows: 1</span>

<span class="sd">				* - Property</span>
<span class="sd">				  - Description</span>
<span class="sd">				* - **short**, **long** : :obj:`str`</span>
<span class="sd">				  - Short (aoi) and long form (Area of Interest) label of html page. This is primarily used for constructing metadata tags in html.</span>
<span class="sd">				* - **display** : :obj:`str`</span>
<span class="sd">				  - (For bokeh) The type of calibration/validation display.</span>
<span class="sd">				* - **trial** : :obj:`str`</span>
<span class="sd">				  - (For bokeh) The trial number for the eyetracking task.</span>
<span class="sd">				* - **session** : :obj:`int`</span>
<span class="sd">				  - (For bokeh) The session number for the eyetracking task.</span>
<span class="sd">				* - **day** : :obj:`str`</span>
<span class="sd">				  - (For bokeh) The day the eyetracking task was run.</span>
<span class="sd">				* - **bokeh_type** : :obj:`str`</span>
<span class="sd">				  - (If Bokeh) Control directory location. If trial, create trial plots.</span>

<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		html : :obj:`str`</span>
<span class="sd">			String of html code.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># kwargs</span>
		<span class="n">html_title</span> <span class="o">=</span> <span class="s1">&#39;imhr: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;html_title&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;html_title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="s1">&#39;imhr&#39;</span>

		<span class="c1">#----initiate fonts</span>
		<span class="n">data</span><span class="o">.</span><span class="n">Plot</span><span class="o">.</span><span class="n">__font__</span><span class="p">()</span>

		<span class="c1">#timestamp</span>
		<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
		<span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
		<span class="n">_f</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;starting processing.html()&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>

		<span class="c1">#---copy csv, imhr, js files to each model</span>
		<span class="c1">#copy files</span>
		<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
		<span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;css&#39;</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">,</span><span class="s1">&#39;js&#39;</span><span class="p">]:</span>
			<span class="n">f_</span> <span class="o">=</span> <span class="n">imhr</span><span class="o">.</span><span class="vm">__file__</span>
			<span class="n">p_</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">f_</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
			<span class="n">s_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/docs/source/_templates/html/</span><span class="si">%s</span><span class="s1">/&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">p_</span><span class="p">,</span> <span class="n">folder</span><span class="p">)</span>
			<span class="n">d_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">/&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">folder</span><span class="p">)</span>
			<span class="c1">#shutil.move(s_, d_)</span>
			<span class="kn">import</span> <span class="nn">distutils</span>
			<span class="n">distutils</span><span class="o">.</span><span class="n">dir_util</span><span class="o">.</span><span class="n">copy_tree</span><span class="p">(</span><span class="n">s_</span><span class="p">,</span> <span class="n">d_</span><span class="p">)</span>

		<span class="c1">#all other html</span>
		<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
			<span class="c1">#build header</span>
			<span class="n">link</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">css</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">js</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;title&gt;</span><span class="si">%s</span><span class="s1">&lt;/title&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">html_title</span><span class="p">))</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;title&quot; content=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">html_title</span><span class="p">))</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;description&quot; content=&quot;Results from our feasibility study for in-browser eyetracking.&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;author&quot; content=&quot;Semeon Risom&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;email&quot; content=&quot;semeon.risom@gmail.com&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;robots&quot; content=&quot;index,follow&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;AdsBot-Google&quot; content=&quot;noindex&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--size--&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; charset=&quot;utf-8&quot;/&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--no cache--&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-cache, no-store, must-revalidate&quot;/&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Pragma&quot; content=&quot;no-cache&quot;/&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Expires&quot; content=&quot;0&quot;/&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-TileColor&quot; content=&quot;#FFFFFF&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-TileImage&quot; content=&quot;imhr/favicon/favicon.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-config&quot; content=&quot;docs/favicon/browserconfig.xml&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--icons--&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;shortcut icon&quot; href=&quot;imhr/favicon/favicon.ico&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; sizes=&quot;16x16 32x32 64x64&quot; href=&quot;imhr/favicon/favicon.ico&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;196x196&quot; href=&quot;imhr/favicon/favicon-192.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;160x160&quot; href=&quot;imhr/favicon/favicon-160.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;96x96&quot; href=&quot;imhr/favicon/favicon-96.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;64x64&quot; href=&quot;imhr/favicon/favicon-64.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;32x32&quot; href=&quot;imhr/favicon/favicon-32.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;16x16&quot; href=&quot;imhr/favicon/favicon-16.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; href=&quot;imhr/favicon/favicon-57.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;114x114&quot; href=&quot;imhr/favicon/favicon-114.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;72x72&quot; href=&quot;imhr/favicon/favicon-72.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;144x144&quot; href=&quot;imhr/favicon/favicon-144.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;60x60&quot; href=&quot;imhr/favicon/favicon-60.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;120x120&quot; href=&quot;imhr/favicon/favicon-120.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;76x76&quot; href=&quot;imhr/favicon/favicon-76.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;152x152&quot; href=&quot;imhr/favicon/favicon-152.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;180x180&quot; href=&quot;imhr/favicon/favicon-180.png&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--all--&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/jquery/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/lodash.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/bootstrap/bootstrap.bundle.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--dataTables--&gt;&#39;</span><span class="p">)</span>
			<span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/bootstrap/bootstrap.min.css&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/datatables/dataTables.bootstrap.min.css&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/datatables/responsive.bootstrap.min.css&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/datatables/buttons.bootstrap.min.css&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--user--&gt;&#39;</span><span class="p">)</span>
			<span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/user.css&quot;&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--dataTables--&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/jquery.dataTables.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.rowsGroup.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.rowGroup.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.bootstrap.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.buttons.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/buttons.bootstrap.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.responsive.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/responsive.bootstrap.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/buttons.html5.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/jszip.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--user--&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/user.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
			<span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script&gt;source=&quot;</span><span class="si">%s</span><span class="s1">&quot;&lt;/script&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>

			<span class="c1"># finish header</span>
			<span class="n">head</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">link</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">css</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">js</span><span class="p">)))</span>

			<span class="c1">#if not displaying seaborn plots</span>
			<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>         
				<span class="c1">#build body</span>
				<span class="c1">##save table to html for datatable</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;demographic&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;device&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">)):</span>
					<span class="n">index</span> <span class="o">=</span> <span class="kc">False</span>
					<span class="c1">#allow word wrapping</span>
					<span class="k">if</span><span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;demographic&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">):</span>
						<span class="n">wrap</span> <span class="o">=</span> <span class="s2">&quot;wrap&quot;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">wrap</span> <span class="o">=</span> <span class="s2">&quot;nowrap&quot;</span>
					<span class="c1"># save table to csv for downloading</span>
					<span class="c1">## check if paths exist</span>
					<span class="n">_folder</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
					<span class="n">p_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_folder</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_folder</span><span class="p">):</span>
						<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>
					<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">p_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
					<span class="c1">#get table</span>
					<span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
					<span class="s1">&#39;&lt;table id=&quot;table&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">					hover dt-responsive &#39;</span><span class="o">+</span><span class="n">wrap</span><span class="o">+</span><span class="s1">&#39;&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span>
				<span class="k">elif</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;definitions&quot;</span><span class="p">):</span>
					<span class="n">index</span> <span class="o">=</span> <span class="kc">False</span>
					<span class="c1">#wordwrap</span>
					<span class="n">wrap</span> <span class="o">=</span> <span class="s2">&quot;nowrap&quot;</span>
					<span class="c1">#prevent trucating strings</span>
					<span class="n">width</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">)</span>
					<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
					<span class="c1">##save table to csv for downloading</span>
					<span class="n">_folder</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
					<span class="n">p_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_folder</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_folder</span><span class="p">):</span>
						<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>
					<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">p_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
					<span class="c1">#get table</span>
					<span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
					<span class="s1">&#39;&lt;table id=&quot;table&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">					hover dt-responsive &#39;</span><span class="o">+</span><span class="n">wrap</span><span class="o">+</span><span class="s1">&#39;&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span>   
					<span class="c1">#reset</span>
					<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
				<span class="k">elif</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;summary&quot;</span><span class="p">)):</span>
					<span class="n">index</span> <span class="o">=</span> <span class="kc">True</span>
					<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)</span>
					<span class="c1">#prevent trucating strings</span>
					<span class="n">width</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">)</span>
					<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
					<span class="c1">##save table to csv for downloading #here saving raw data for future analysis</span>
					<span class="n">_folder</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
					<span class="n">p_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_folder</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_folder</span><span class="p">):</span>
						<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>
					<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">p_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
					<span class="c1">#get table</span>
					<span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
					<span class="s1">&#39;&lt;table id=&quot;table&quot; data-file=&quot;&#39;</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span><span class="s1">&#39;&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">					hover dt-responsive nowrap&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span>
					<span class="c1">#reset</span>
					<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">index</span> <span class="o">=</span> <span class="kc">True</span>
					<span class="c1">#prevent trucating strings</span>
					<span class="n">width</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">)</span>
					<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
					<span class="c1">##save table to csv for downloading #here saving raw data for future analysis</span>
					<span class="n">_folder</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
					<span class="n">p_</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_folder</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_folder</span><span class="p">):</span>
						<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_folder</span><span class="p">)</span>
					<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">p_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
					<span class="c1">#get table</span>
					<span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
					<span class="s1">&#39;&lt;table id=&quot;table&quot; data-file=&quot;&#39;</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span><span class="s1">&#39;&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">					hover dt-responsive nowrap&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span>
					<span class="c1">#reset</span>
					<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

				<span class="c1">#add images to bottom of model</span>
				<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
					<span class="n">html_plots</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

				<span class="c1">##body</span>
				<span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;div class=&quot;container-large </span><span class="si">%s</span><span class="s1">&quot; style=&quot;&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">),</span>
							<span class="s1">&#39;&lt;div class=&quot;container&quot; style=&quot;&quot;&gt;&#39;</span><span class="p">,</span>
								<span class="s1">&#39;&lt;div class=&quot;dashboard-main&quot;&gt;&#39;</span><span class="p">,</span>
									<span class="s1">&#39;&lt;div class=&quot;table-container </span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">),</span>
										<span class="s1">&#39;&lt;div class=&quot;title&quot;&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">figure_title</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
										<span class="s1">&#39;&lt;div class=&quot;date&quot;&gt; Last Updated: &#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">date</span><span class="p">),</span>
											<span class="s1">&#39;&lt;span class=&quot;link&quot; id=&quot;code&quot;&gt;code&lt;/span&gt;&#39;</span><span class="p">,</span>
											<span class="s1">&#39;&lt;span class=&quot;link&quot; id=&quot;csv&quot;&gt;csv&lt;/span&gt;&#39;</span><span class="p">,</span>
										<span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
									<span class="s1">&#39;&lt;div class=&quot;dataTables_wrapper form-inline dt-bootstrap&quot;&gt;&#39;</span><span class="p">,</span>
										<span class="s1">&#39;&lt;!--script--&gt;&#39;</span><span class="p">,</span>
										<span class="n">table</span><span class="p">,</span>
									<span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
									<span class="s1">&#39;&lt;div class=&quot;footnote&quot;&gt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">footnote</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
										<span class="n">html_plots</span><span class="p">,</span>
									<span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
								<span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
							<span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
						<span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>
				<span class="c1">#replace script within body, then join as string</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;logit&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;onset&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;anova&quot;</span><span class="p">)):</span>
					<span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">script</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="p">(</span>                <span class="s1">&#39;&lt;!--script--&gt;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">body</span><span class="p">]</span>
				<span class="c1"># join</span>
				<span class="n">body</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">)))</span>

				<span class="c1">#build footer</span>
				<span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
					<span class="n">foot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;script&gt;&#39;</span><span class="p">,</span>
								<span class="s1">&#39;$(document).ready(function(){&#39;</span><span class="p">,</span>
									<span class="s1">&#39;getLogitTable();&#39;</span><span class="p">,</span>
								<span class="s1">&#39;})&#39;</span><span class="p">,</span>
							<span class="s1">&#39;&lt;/script&gt;&#39;</span><span class="p">]</span>
				<span class="n">foot</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">foot</span><span class="p">)))</span>

				<span class="c1">#build html</span>
				<span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;html&gt;&#39;</span><span class="p">,</span>
						<span class="s1">&#39;&lt;head&gt;&#39;</span><span class="p">,</span>
							<span class="n">head</span><span class="p">,</span>
						<span class="s1">&#39;&lt;/head&gt;&#39;</span><span class="p">,</span>
						<span class="s1">&#39;&lt;body id=&quot;body&quot;&gt;&#39;</span><span class="p">,</span>
							<span class="n">body</span><span class="p">,</span>
						<span class="s1">&#39;&lt;/body&gt;&#39;</span><span class="p">,</span>
						<span class="s1">&#39;&lt;foot&gt;&#39;</span><span class="p">,</span>
							<span class="n">foot</span><span class="p">,</span>
						<span class="s1">&#39;&lt;/foot&gt;&#39;</span><span class="p">,</span>
						<span class="s1">&#39;&lt;/html&gt;&#39;</span><span class="p">]</span>
				<span class="n">html</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html</span><span class="p">)))</span>

		<span class="c1">#----save</span>
		<span class="c1"># check if paths exist</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
		<span class="c1"># tidy html</span>
		<span class="c1">#html = re.sub(&quot;\s\s+&quot;, &quot; &quot;, html) #multiple spaces</span>
		<span class="c1"># save</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">html_</span><span class="p">:</span>
			<span class="n">html_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;saved html file at </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

		<span class="c1">#--------finished</span>
		<span class="bp">cls</span><span class="o">.</span><span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">html</span></div></div>
</pre></div>

		</div>
		  
	</div>
</div>
<footer class="footer">
	<div class="container">
		<div>
			<div>&copy; Copyright 2019, </div>
			<div><a href="https://semeon.io/">Semeon Risom</a>.</div>
			<div>Updated 2019-06-02T17:29:49-05:00.</div>
		</div>
	</div>
</footer>
  </body>
</html>