<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>imhr.plot &#8212; imhr-api 2019-05-20 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/semeon/css/user.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <script type="text/javascript" src="../../_static/semeon/js/clipboard.js"></script>
    <script type="text/javascript" src="../../_static/semeon/js/user.js"></script>
    <script type="text/javascript" src="../../_static/semeon/js/copybutton.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../_static/imhr.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="description" content="Results from our feasibility study for in-browser eyetracking.">
<meta name="author" content="Semeon Risom">
<meta name="email" content="semeon.risom@gmail.com">
<meta name="robots" content="index,follow">
<meta name="AdsBot-Google" content="noindex">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          imhr-api</a>
        <span class="navbar-text navbar-version pull-left"><b>2019-05-20</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../genindex.html">Glossary</a></li>
                <li><a href="../../install.html">Install</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#installing">Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../features.html#accesesing-raw-data">Accesesing Raw Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features.html#data-analysis">Data Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features.html#relational-plots">Relational plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/R33/process_demographics.html">Process demographics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_demographics.html#get-metadata">get metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_demographics.html#prepare-data">prepare data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_demographics.html#demographic-statistics">demographic statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_demographics.html#list-of-variables">list of variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_demographics.html#descriptive-device">descriptive device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_demographics.html#descriptive-task">descriptive task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_demographics.html#summary-data">summary data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/R33/download_data.html">Download data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/download_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/download_data.html#raw-data-(UTWeb)">raw data (UTWeb)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/download_data.html#REDCap">REDCap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/download_data.html#box">box</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/R33/run_models.html">Run models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/R33/create_plots.html">Create plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/R33/process_data.html">Process data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_data.html#imports">imports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/R33/process_data.html#start">start</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html">Eyetracking demo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Import-packages.">Import packages.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Set-task-parameters,-either-directly-from-PsychoPy-or-created-manually.">Set task parameters, either directly from PsychoPy or created manually.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Initialize-the-imhr.eyetracking-package.">Initialize the imhr.eyetracking package.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Connect-to-the-Eyelink-Host.">Connect to the Eyelink Host.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Set-the-dominamt-eye.">Set the dominamt eye.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Start-calibration.">Start calibration.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#(Optional)-Print-message-to-console/terminal.">(Optional) Print message to console/terminal.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#(Optional)-Drift-correction.">(Optional) Drift correction.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Start-recording.">Start recording.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Example-use-of-eyetracking.sample().">Example use of eyetracking.sample().</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Stop-recording.">Stop recording.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/eyetracking/demo/eyetracking_demo.html#Close-PsychoPy.">Close PsychoPy.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/roi/index.html">Region of Interest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/roi/index.html#demonstration">1. Demonstration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/roi/index.html#highlighted-roi-from-photoshop-psd">2. Highlighted ROI from Photoshop PSD</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../studies/index.html">Studies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../studies/R33/index.html">R33</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../studies/Webgazer/index.html">Webgazer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/imhr.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/imhr.eyetracking.html">imhr.eyetracking</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/imhr.plot.html">imhr.plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/imhr.r33.html">imhr.r33</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/imhr.tests.html">imhr.tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/imhr.tests.test_basic.html">imhr.tests.test_basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/imhr.tests.test_roi.html">imhr.tests.test_roi</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/imhr.settings.html">imhr.settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/imhr.Webgazer.html">imhr.Webgazer</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studies/index.html">Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/imhr.html">API Reference</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
	<div class="imhr-bars">
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
		<div class="bar"></div>
	</div>
	<div class="row">
<div class="toc col-md-3" style="width: 25%;">
	<div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studies/index.html">Studies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/imhr.html">API Reference</a></li>
</ul>

	</div>
</div>
		<div class="col-md-9 content">
			
  <h1>Source code for imhr.plot</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">| @purpose: Hub for creating plots.  </span>
<span class="sd">| @date: Created on Sat May 1 15:12:38 2019   </span>
<span class="sd">| @author: Semeon Risom   </span>
<span class="sd">| @email: semeon.risom@gmail.com   </span>
<span class="sd">| @url: https://semeon.io/d/imhr</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># available functions</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bokeh_trial&#39;</span><span class="p">,</span><span class="s1">&#39;bokeh_calibration&#39;</span><span class="p">,</span><span class="s1">&#39;onset_diff_plot&#39;</span><span class="p">,</span><span class="s1">&#39;density_plot&#39;</span><span class="p">,</span><span class="s1">&#39;corr_matrix&#39;</span><span class="p">,</span><span class="s1">&#39;boxplot&#39;</span><span class="p">,</span><span class="s1">&#39;cooks_plot&#39;</span><span class="p">,</span>
<span class="s1">&#39;residual_plot&#39;</span><span class="p">,</span><span class="s1">&#39;qq_plot&#39;</span><span class="p">,</span><span class="s1">&#39;logit_plot&#39;</span><span class="p">,</span><span class="s1">&#39;html&#39;</span><span class="p">]</span>

<span class="c1"># core</span>
<span class="kn">from</span> <span class="nn">pdb</span> <span class="k">import</span> <span class="n">set_trace</span> <span class="k">as</span> <span class="n">breakpoint</span>
<span class="kn">from</span> <span class="nn">distutils</span> <span class="k">import</span> <span class="n">dir_util</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># data</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># seaborn</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># local libraries</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">settings</span>

<span class="c1"># constants</span>
<span class="n">console</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">console</span>
<span class="n">debug</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">debug</span>

<span class="k">def</span> <span class="nf">__font__</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;Add Helvetica to matplotlib.&quot;&quot;&quot;</span>
	<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">matplotlib_fname</span><span class="p">,</span> <span class="n">rcParams</span>
	<span class="kn">import</span> <span class="nn">matplotlib.font_manager</span> <span class="k">as</span> <span class="nn">font_manager</span>

	<span class="n">directory</span> <span class="o">=</span> <span class="n">matplotlib_fname</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/matplotlibrc/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
	<span class="n">destination</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{directory}</span><span class="s1">/fonts/ttf&#39;</span>
	<span class="n">file</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;home&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/dist/resources/Helvetica.ttf&quot;</span>

	<span class="c1">#add to matplotlib font folder</span>
	<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

	<span class="c1">#add to computer font folder</span>
	<span class="c1">##if running osx</span>
	<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
		<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;/Library/Fonts/&#39;</span><span class="p">)</span>
	<span class="c1">##if running win32</span>
	<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
		<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;c:</span><span class="se">\\</span><span class="s1">windows</span><span class="se">\\</span><span class="s1">fonts&#39;</span><span class="p">)</span>

	<span class="c1">#rebuild fonts</span>
	<span class="n">prop</span> <span class="o">=</span> <span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
	<span class="n">prop</span><span class="o">.</span><span class="n">set_weight</span> <span class="o">=</span> <span class="s1">&#39;light&#39;</span>
	<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
	<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;light&#39;</span>
	<span class="n">font_manager</span><span class="o">.</span><span class="n">_rebuild</span><span class="p">()</span>

<div class="viewcode-block" id="bokeh_trial"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.bokeh_trial">[docs]</a><span class="k">def</span> <span class="nf">bokeh_trial</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">stim_bounds</span><span class="p">,</span> <span class="n">roi_bounds</span><span class="p">,</span> <span class="n">flt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create single subject trial bokeh plots.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of participant sample data.</span>
<span class="sd">    stim_bounds : :class:`dict`</span>
<span class="sd">        Stimulus bounds on screen.</span>
<span class="sd">    roi_bounds : :class:`dict`</span>
<span class="sd">        ROI bounds on screen.</span>
<span class="sd">    flt : :class:`str`</span>
<span class="sd">        Filter type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
	<span class="c1">#----bokeh</span>
    <span class="kn">from</span> <span class="nn">bokeh.core.properties</span> <span class="k">import</span> <span class="n">value</span>
    <span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="k">import</span> <span class="n">reset_output</span><span class="p">,</span> <span class="n">figure</span>
    <span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="k">import</span> <span class="n">HoverTool</span><span class="p">,</span> <span class="n">Range1d</span><span class="p">,</span> <span class="n">BoxAnnotation</span><span class="p">,</span> <span class="n">ColumnDataSource</span><span class="p">,</span> <span class="n">CDSView</span><span class="p">,</span> <span class="n">BooleanFilter</span>
    <span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="k">import</span> <span class="n">gridplot</span>
    <span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="k">import</span> <span class="n">components</span>

    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    
    <span class="c1">#metadata</span>
    <span class="n">emotion</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;left_mood&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;right_mood&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="c1">#filter xy coordinates</span>
    <span class="n">flt_x</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_x&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">flt</span><span class="p">)</span>
    <span class="n">flt_y</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_y&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">flt</span><span class="p">)</span>
    
    <span class="c1">#get display size</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorSize.px&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)]</span>
    <span class="n">monitorSize</span> <span class="o">=</span> <span class="n">xy</span>
    
    <span class="c1">#subject data</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="c1">#get fixations</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fixation_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fix_num&#39;</span><span class="p">)[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_fix_all&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">flt</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_fix_all&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">flt</span><span class="p">)]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fixation_onset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;fixation_onset&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1">#source for syncing data</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1">##tools = &quot;box_select,save,pan,box_zoom,reset&quot;</span>
    <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;box_select,save,reset&quot;</span>

    <span class="c1">#figure 1</span>
    <span class="c1">#sizing_mode: ``&quot;fixed&quot;``, ``&quot;stretch_both&quot;``, ``&quot;scale_width&quot;``, ``&quot;scale_height&quot;``, ``&quot;scale_both&quot;``</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
            <span class="n">output_backend</span><span class="o">=</span><span class="s2">&quot;webgl&quot;</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">plot_width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
            <span class="n">plot_height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
            <span class="n">x_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">100</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">monitorSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">100</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="n">x_axis_label</span> <span class="o">=</span> <span class="s1">&#39;time (msec)&#39;</span><span class="p">,</span> <span class="n">y_axis_label</span> <span class="o">=</span> <span class="s1">&#39;x/y (px)&#39;</span><span class="p">,</span>
            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_both&quot;</span><span class="p">,</span>
     <span class="p">)</span>

    <span class="c1">#hover</span>
    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
    <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;$name&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;$index&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;data (x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x{(0)},$y{(0)})&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">hover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>

    <span class="c1">#graph</span>
    <span class="c1">###-----------------------------------------------------------------x=time, y=(x or y)</span>
    <span class="c1">#original x</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#2965C0&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;raw_x&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#2965C0&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;raw_x&#39;</span><span class="p">),</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;raw_x&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="c1">#filtered x</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#265EB3&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#265EB3&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="n">flt_x</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="c1">#peak removed</span>
    <span class="c1">#p1.line(x=t, y=sg_x, color=&#39;#101f23&#39;, alpha=1, line_width=2,legend=&#39;x_peaksg&#39;, name=&#39;x_peaksg&#39;)</span>

    <span class="c1">#original y</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#C01F1F&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;raw_y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#C01F1F&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;raw_y&#39;</span><span class="p">),</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;raw_y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="c1">#filtered y</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#A61B1B&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#A61B1B&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="n">flt_y</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>

    <span class="c1">#task-events (stimulus onset, dotloc onset)</span>
    <span class="c1">##stimulus onset</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Stimulus Onset&#39;</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">BoxAnnotation</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">time</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;#434e54&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="c1">##dotloc onset</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Dotloc Onset&#39;</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">box</span> <span class="o">=</span> <span class="n">BoxAnnotation</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">time</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;#434e54&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

    <span class="c1">#fixations</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sg_fix_all&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="kc">False</span><span class="p">])]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;fix_num&#39;</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">BoxAnnotation</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">end</span><span class="p">,</span><span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;#9e9e9e&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">)</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span>

    <span class="c1">#legend</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="s2">&quot;horizontal&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_left&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>

    <span class="c1">###-----------------------------------------------------------------window display</span>
    <span class="c1">#sizing_mode: ``&quot;fixed&quot;``, ``&quot;stretch_both&quot;``, ``&quot;scale_width&quot;``, ``&quot;scale_height&quot;``, ``&quot;scale_both&quot;``</span>
    <span class="c1">#display what participant sees</span>
    <span class="n">tools</span> <span class="o">=</span> <span class="s2">&quot;box_select,save,pan,box_zoom,reset&quot;</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
            <span class="n">output_backend</span><span class="o">=</span><span class="s2">&quot;webgl&quot;</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">plot_width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
            <span class="n">plot_height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">x_axis_label</span> <span class="o">=</span> <span class="s1">&#39;x (px)&#39;</span><span class="p">,</span> <span class="n">y_axis_label</span> <span class="o">=</span> <span class="s1">&#39;y (px)&#39;</span><span class="p">,</span>
            <span class="n">x_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">monitorSize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">monitorSize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_both&quot;</span>
    <span class="p">)</span>
    <span class="c1">#hover</span>
    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
    <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;$name&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;$index&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;data (x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x{(0)},$y{(0)})&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">hover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>
    <span class="c1">###---------line plots</span>
    <span class="c1">#------gaze xy</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
              <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gaze&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;gaze&#39;</span><span class="p">)</span>

    <span class="c1">#------fixation onset within and outside roi</span>
    <span class="c1">#get booleanfilter</span>
    <span class="n">l_fix_all</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span><span class="kc">False</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;fixation_onset&#39;</span><span class="p">]]</span>
    <span class="n">fix_all</span> <span class="o">=</span> <span class="n">BooleanFilter</span><span class="p">(</span><span class="n">l_fix_all</span><span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">CDSView</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">fix_all</span><span class="p">])</span>
    <span class="c1">##draw square ##2222b2</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#2222b2&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
              <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fixation&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;fixation&quot;</span><span class="p">))</span>
    
    <span class="c1">#------fixation within and outside roi</span>
    <span class="c1">#get booleanfilter</span>
    <span class="n">l_fix_false</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span><span class="kc">False</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sg_fix_all&#39;</span><span class="p">]]</span>
    <span class="n">fix_false</span> <span class="o">=</span> <span class="n">BooleanFilter</span><span class="p">(</span><span class="n">l_fix_false</span><span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">CDSView</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">fix_false</span><span class="p">])</span>
    <span class="c1">##draw square ##2222b2</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
              <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;false-fixation&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;false-fixation&quot;</span><span class="p">))</span>

    <span class="c1">#------only fixation within roi</span>
    <span class="c1">#get booleanfilter</span>
    <span class="n">l_fix_roi</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">z</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;fixation_onset&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dwell&#39;</span><span class="p">])]</span>
    <span class="n">fix_roi</span> <span class="o">=</span> <span class="n">BooleanFilter</span><span class="p">(</span><span class="n">l_fix_roi</span><span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">CDSView</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">fix_roi</span><span class="p">])</span>
    <span class="c1">##draw triangle ##198D40</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#198D40&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
              <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;roi&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;roi&quot;</span><span class="p">))</span>
    
    <span class="c1">#------dwell-time gaze within roi</span>
    <span class="n">l_dwell_roi</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span><span class="kc">False</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dwell&#39;</span><span class="p">]]</span>
    <span class="n">dwell_roi</span> <span class="o">=</span> <span class="n">BooleanFilter</span><span class="p">(</span><span class="n">l_dwell_roi</span><span class="p">)</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">CDSView</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">dwell_roi</span><span class="p">])</span>
    <span class="c1">##draw circle ##ff9800</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">flt_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">flt_y</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#ff9800&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
              <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dwell&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;dwell&quot;</span><span class="p">))</span>

    <span class="c1">#------stim bounds</span>
    <span class="n">stimBounds</span> <span class="o">=</span> <span class="n">stim_bounds</span>

    <span class="c1">#------roi bounds</span>
    <span class="n">roiBounds</span> <span class="o">=</span> <span class="n">roi_bounds</span>

    <span class="c1">#emotion</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">emotion</span>
    <span class="k">if</span> <span class="n">left</span> <span class="o">==</span> <span class="s1">&#39;Sad&#39;</span><span class="p">:</span>
        <span class="n">left_color</span> <span class="o">=</span> <span class="s1">&#39;#ff0000&#39;</span>
        <span class="n">right_color</span> <span class="o">=</span> <span class="s1">&#39;#9e9e9e&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">right_color</span> <span class="o">=</span> <span class="s1">&#39;#ff0000&#39;</span>
        <span class="n">left_color</span> <span class="o">=</span> <span class="s1">&#39;#9e9e9e&#39;</span>

    <span class="c1">#roi</span>
    <span class="c1">#left</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">BoxAnnotation</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">roiBounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;bx1&#39;</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">roiBounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;bx2&#39;</span><span class="p">],</span>
                                <span class="n">top</span><span class="o">=</span><span class="n">roiBounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;by1&#39;</span><span class="p">],</span> <span class="n">bottom</span><span class="o">=</span><span class="n">roiBounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;by2&#39;</span><span class="p">],</span>
                        <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">))</span>
    <span class="c1">#right</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">BoxAnnotation</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">roiBounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;bx1&#39;</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">roiBounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;bx2&#39;</span><span class="p">],</span>
                                <span class="n">top</span><span class="o">=</span><span class="n">roiBounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;by1&#39;</span><span class="p">],</span> <span class="n">bottom</span><span class="o">=</span><span class="n">roiBounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;by2&#39;</span><span class="p">],</span>
                        <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">))</span>


    <span class="c1">#--------stim bounds</span>
    <span class="c1">#left</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">BoxAnnotation</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">stimBounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;bx1&#39;</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">stimBounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;bx2&#39;</span><span class="p">],</span>
                                <span class="n">top</span><span class="o">=</span><span class="n">stimBounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;by1&#39;</span><span class="p">],</span> <span class="n">bottom</span><span class="o">=</span><span class="n">stimBounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;by2&#39;</span><span class="p">],</span>
                        <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">left_color</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">))</span>
    <span class="c1">#right</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">BoxAnnotation</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">stimBounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;bx1&#39;</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">stimBounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;bx2&#39;</span><span class="p">],</span>
                                <span class="n">top</span><span class="o">=</span><span class="n">stimBounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;by1&#39;</span><span class="p">],</span> <span class="n">bottom</span><span class="o">=</span><span class="n">stimBounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;by2&#39;</span><span class="p">],</span>
                        <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">right_color</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">))</span>
    <span class="c1">#hover</span>
    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
    <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;@timestamp&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;$index&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;data (x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($</span><span class="si">%s</span><span class="s2">_x{(0)},$</span><span class="si">%s</span><span class="s2">_y{(0)})&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span><span class="n">flt</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="c1">#p2.tools.append(hover)</span>
    <span class="c1">#p2.hover.line_policy = &quot;nearest&quot;</span>

    <span class="c1">#legend</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="s2">&quot;horizontal&quot;</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_left&quot;</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>

    <span class="c1">#reverse axis</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">monitorSize</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="n">monitorSize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">###-----------------------------------------------------------------slider</span>
    <span class="c1">#sizing_mode: ``&quot;fixed&quot;``, ``&quot;stretch_both&quot;``, ``&quot;scale_width&quot;``, ``&quot;scale_height&quot;``, ``&quot;scale_both&quot;``</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
    <span class="c1"># callback = CustomJS(args=dict(source=s), code=&quot;&quot;&quot;</span>
    <span class="c1">#     data = source.data;</span>
    <span class="c1">#     t = cb_obj;</span>
    <span class="c1">#     f = cb_obj.value;</span>
    <span class="c1">#     x = data[&#39;x&#39;];</span>
    <span class="c1">#     y = data[&#39;y&#39;];</span>
    <span class="c1">#     source.change.emit();</span>
    <span class="c1">#     console.log(&#39;test&#39;);</span>
    <span class="c1"># &quot;&quot;&quot;)</span>
    <span class="c1"># p3 = Slider(</span>
    <span class="c1">#         title=&quot;time&quot;,</span>
    <span class="c1">#         start=start,</span>
    <span class="c1">#         end=end,</span>
    <span class="c1">#         value=1, step=1,</span>
    <span class="c1">#         callback=callback,</span>
    <span class="c1">#         bar_color=&#39;red&#39;,</span>
    <span class="c1">#         width=1200,</span>
    <span class="c1">#         show_value=True,</span>
    <span class="c1">#         sizing_mode=&quot;stretch_both&quot;</span>
    <span class="c1"># )</span>

    <span class="c1">###-----------------------------------------------------------------combining plots</span>
    <span class="c1">#sizing_mode: ``&quot;fixed&quot;``, ``&quot;stretch_both&quot;``, ``&quot;scale_width&quot;``, ``&quot;scale_height&quot;``, ``&quot;scale_both&quot;``</span>
    <span class="c1"># grid = gridplot(children=[[p1], [p2], [p3]],</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">children</span><span class="o">=</span><span class="p">[[</span><span class="n">p1</span><span class="p">],</span> <span class="p">[</span><span class="n">p2</span><span class="p">]],</span>
                    <span class="n">merge_tools</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">toolbar_location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                    <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span><span class="p">)</span>

    <span class="c1">#get html</span>
    <span class="n">script</span><span class="p">,</span> <span class="n">div</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

    <span class="c1">##convert seperate plots and div to single string</span>
    <span class="n">plots</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="n">div</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">script</span><span class="p">])))</span>

    <span class="c1">#clear cache</span>
    <span class="n">reset_output</span><span class="p">()</span>

    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plots</span></div>

<div class="viewcode-block" id="bokeh_calibration"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.bokeh_calibration">[docs]</a><span class="k">def</span> <span class="nf">bokeh_calibration</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">cxy</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">monitorSize</span><span class="o">=</span><span class="p">[</span><span class="mi">1920</span><span class="p">,</span><span class="mi">1080</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Create calibration matrix, using pandas and bokeh.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : :obj:`dict`</span>
<span class="sd">        Configuration data.</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    cxy : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of calibration points.</span>
<span class="sd">    event : :obj:`string`</span>
<span class="sd">        calibration, or validation.</span>
<span class="sd">    monitorSize : :obj:`list`</span>
<span class="sd">        Monitor size, in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="k">import</span> <span class="n">reset_output</span><span class="p">,</span> <span class="n">figure</span>
    <span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="k">import</span> <span class="n">Range1d</span><span class="p">,</span> <span class="n">ColumnDataSource</span>
    <span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="k">import</span> <span class="n">components</span>

    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    
    <span class="c1">#subject data</span>
    <span class="n">event_t</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;event_trial&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="c1">#source for syncing data</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1">##tools = &quot;box_select,save,pan,box_zoom,reset&quot;</span>
    <span class="c1">#figure 1</span>
    <span class="c1">#sizing_mode: ``&quot;fixed&quot;``, ``&quot;stretch_both&quot;``, ``&quot;scale_width&quot;``, ``&quot;scale_height&quot;``, ``&quot;scale_both&quot;``</span>
    <span class="c1">##tools = &quot;box_select,save,pan,box_zoom,reset&quot;</span>
    <span class="n">tools</span> <span class="o">=</span> <span class="s2">&quot;box_select,reset&quot;</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
            <span class="n">output_backend</span><span class="o">=</span><span class="s2">&quot;webgl&quot;</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">plot_width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
            <span class="n">plot_height</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
            <span class="n">x_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="mf">0.1</span><span class="p">,</span> <span class="p">(</span><span class="n">event_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">monitorSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">100</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
            <span class="n">x_axis_label</span> <span class="o">=</span> <span class="s1">&#39;calibration point&#39;</span><span class="p">,</span> <span class="n">y_axis_label</span> <span class="o">=</span> <span class="s1">&#39;x/y (px)&#39;</span><span class="p">,</span>
            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_width&quot;</span><span class="p">,</span>
     <span class="p">)</span>

    <span class="c1">#graph</span>
    <span class="c1">###-----------------------------------------------------------------x=time, y=(x or y)</span>
    <span class="c1">#original x</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;event_trial&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#2965C0&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="c1"># p1.line(x=&#39;event_trial&#39;, y=&#39;cx&#39;, color=&#39;#2965C0&#39;, alpha=0.5, line_width=2,</span>
            <span class="c1"># line_dash=&#39;dashed&#39;, name=&#39;cx&#39;, source=s,legend=value(&#39;cx&#39;))</span>

    <span class="c1">#original y</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;event_trial&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;cy&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#C01F1F&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cy&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="c1"># p1.line(x=&#39;event_trial&#39;, y=&#39;cy&#39;, color=&#39;#C01F1F&#39;, alpha=0.5, line_width=2,</span>
    <span class="c1">#         line_dash=&#39;dashed&#39;, name=&#39;cy&#39;, source=s,legend=value(&#39;cy&#39;))</span>

    <span class="c1">###-----------------------------------------------------------------window display</span>
    <span class="c1">#sizing_mode: ``&quot;fixed&quot;``, ``&quot;stretch_both&quot;``, ``&quot;scale_width&quot;``, ``&quot;scale_height&quot;``, ``&quot;scale_both&quot;``</span>
    <span class="c1">##tools = &quot;box_select,save,pan,box_zoom,reset&quot;</span>
    <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,reset&quot;</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
        <span class="n">output_backend</span><span class="o">=</span><span class="s2">&quot;webgl&quot;</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
        <span class="n">plot_width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
        <span class="n">plot_height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">x_axis_label</span> <span class="o">=</span> <span class="s1">&#39;x (px)&#39;</span><span class="p">,</span> <span class="n">y_axis_label</span> <span class="o">=</span> <span class="s1">&#39;y (px)&#39;</span><span class="p">,</span>
        <span class="n">x_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">monitorSize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
        <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">monitorSize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">),</span>
        <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;scale_width&quot;</span>
    <span class="p">)</span>
    
    <span class="c1">###---------line plots</span>
    <span class="c1">#----gaze xy</span>
    <span class="c1"># cross = p2.cross(x=&#39;gx&#39;, y=&#39;gy&#39;, size=10, color=&quot;firebrick&quot;, alpha=1, fill_alpha=0.6,</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;gx&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;gy&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
              <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gaze&#39;</span><span class="p">)</span>
    <span class="c1">#           fill_color=&quot;firebrick&quot;, source=s, name=&#39;gaze&#39;, legend=value(&quot;gaze&quot;))</span>
    
    <span class="c1">#----circle xy</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cxy</span><span class="p">[</span><span class="s1">&#39;cx&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">cxy</span><span class="p">[</span><span class="s1">&#39;cy&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#198D40&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
              <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span><span class="p">)</span>
              <span class="c1">#fill_color=&quot;white&quot;, source=s, name=&#39;circle&#39;, legend=value(&quot;circle&quot;))</span>
              
    <span class="c1"># draw mouse click for calibration</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">==</span><span class="s1">&#39;calibration&#39;</span><span class="p">:</span>
        <span class="c1">#----mouse xy</span>
        <span class="n">p2</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;mx&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;my&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#2222b2&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                  <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">)</span>
                  <span class="c1">#fill_color=&quot;white&quot;, source=s, name=&#39;mouse&#39;, legend=value(&quot;mouse&quot;))</span>
        
    <span class="c1">#----legend</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#----reverse axis</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">x_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">monitorSize</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="n">monitorSize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1">#----grid</span>
    <span class="c1">#p1</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>
    
    <span class="c1">#----font</span>
    <span class="c1"># p2</span>
    <span class="c1">## title</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_label_text_font_style</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
    <span class="c1">## labels</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span><span class="o">=</span> <span class="s2">&quot;11.5pt&quot;</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_label_text_font</span> <span class="o">=</span> <span class="s2">&quot;Helvetica&quot;</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_label_text_color</span> <span class="o">=</span> <span class="s2">&quot;#1c1d1e&quot;</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_label_text_font_size</span><span class="o">=</span> <span class="s2">&quot;11.5pt&quot;</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_label_text_font</span> <span class="o">=</span> <span class="s2">&quot;Helvetica&quot;</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_label_text_color</span> <span class="o">=</span> <span class="s2">&quot;#1c1d1e&quot;</span>
    <span class="c1"># p1</span>
    <span class="c1">## title</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_label_text_font_style</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
    <span class="c1">## labels</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;9.5pt&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_label_text_font</span> <span class="o">=</span> <span class="s2">&quot;Helvetica&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_label_text_color</span> <span class="o">=</span> <span class="s2">&quot;#1c1d1e&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;9.5pt&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_label_text_font</span> <span class="o">=</span> <span class="s2">&quot;Helvetica&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_label_text_color</span> <span class="o">=</span> <span class="s2">&quot;#1c1d1e&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">minor_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span> 
    
    <span class="c1">#----padding</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">min_border_top</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">min_border_bottom</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1">#----axis line</span>
    <span class="c1"># p2</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_line_width</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="s2">&quot;#1c1d1e&quot;</span>
    <span class="c1"># p1</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">background_fill_color</span> <span class="o">=</span> <span class="s2">&quot;#dfe1e4&quot;</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_line_width</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="s2">&quot;#1c1d1e&quot;</span>
    
    <span class="c1">#----get html</span>
    <span class="c1">#get componants</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="n">p2</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span> <span class="n">p1</span><span class="p">}</span>
    <span class="n">script</span><span class="p">,</span> <span class="n">div</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
    <span class="c1">#combine</span>
    <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">div</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">div</span> <span class="o">+</span> <span class="n">script</span>
        
    <span class="c1">#----clear cache</span>
    <span class="n">reset_output</span><span class="p">()</span>

    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plot</span></div>

<div class="viewcode-block" id="onset_diff_plot"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.onset_diff_plot">[docs]</a><span class="k">def</span> <span class="nf">onset_diff_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">drop</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot onset differences using pandas and seaborn.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : :obj:`dict`</span>
<span class="sd">        Configuration data.</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    meta : :class:`pandas.DataFrame`</span>
<span class="sd">        Metadata for each chart.</span>
<span class="sd">    drop : :class:`pandas.DataFrame`</span>
<span class="sd">        Participants to be dropped.</span>
<span class="sd">    y : :obj:`str`</span>
<span class="sd">        Variable of interest.</span>
<span class="sd">    clip : :obj:`int`</span>
<span class="sd">        Clip value for single subject plot.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    odp</span>
<span class="sd">        Bokeh or seaborn plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#setting clip</span>
    <span class="n">clip</span> <span class="o">=</span> <span class="mi">200</span> <span class="k">if</span> <span class="n">clip</span> <span class="o">==</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">clip</span>
    
    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running onset_diff_plot(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">html_plots</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1">#-----------------participant trend line</span>
    <span class="n">individual</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
    <span class="c1">#sns.despine(offset=10, trim=True)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="c1">#plot</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (msec)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;participant&#39;</span><span class="p">)[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">##if diff_dotloc and diff_stim &lt; 500 msec</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">ax_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;TrialNum_&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (msec)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;ch:2.5,.25&quot;</span><span class="p">,</span>
                       <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;onset_greater&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">])</span>
    <span class="c1">##if diff_dotloc and diff_stim &gt; 500 msec</span>
    <span class="n">ax_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;TrialNum_&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (msec)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                      <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;onset_greater&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">])</span>
    <span class="c1">#settings</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">clip</span><span class="p">),</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;| </span><span class="si">%s</span><span class="s1"> (msec) |&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span>
      
    <span class="c1">#append</span>
    <span class="n">html_plots</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="n">individual</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span><span class="s2">&quot;file&quot;</span><span class="p">:</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">individual</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]),</span><span class="s2">&quot;footnote&quot;</span><span class="p">:</span><span class="n">individual</span><span class="p">[</span><span class="s1">&#39;footnote&#39;</span><span class="p">],</span><span class="s2">&quot;anchor&quot;</span><span class="p">:</span><span class="s2">&quot;itl&quot;</span><span class="p">})</span>
    <span class="c1">#tight layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1">#save</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">individual</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="c1">#clear figure from memory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1">#-----------------diff plot</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span>
    <span class="c1">#for each plot</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
    <span class="c1">#sns.despine(offset=10, trim=True)</span>
    <span class="c1">#binned</span>
    <span class="c1">##iaps</span>
    <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;iaps&#39;</span>
    <span class="n">df_1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">type_</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;TrialNum_&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#5874a6&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
                <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">x_bins</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;binned&#39;</span><span class="p">][</span><span class="s1">&#39;bins&#39;</span><span class="p">],</span><span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">},</span><span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">})</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;| </span><span class="si">%s</span><span class="s1"> (msec) |&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;trial_type=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">type_</span><span class="p">))</span>
    <span class="c1">##pofa</span>
    <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;pofa&#39;</span>
    <span class="n">df_1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">type_</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;TrialNum_&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#5d9f6c&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
                <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">x_bins</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;binned&#39;</span><span class="p">][</span><span class="s1">&#39;bins&#39;</span><span class="p">],</span><span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">},</span><span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">})</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;trial_type=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">type_</span><span class="p">))</span>
    <span class="c1">#unbinned</span>
    <span class="c1">##iaps</span>
    <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;iaps&#39;</span>
    <span class="n">df_1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">type_</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;TrialNum_&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#5874a6&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span>
                <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">x_bins</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;unbinned&#39;</span><span class="p">][</span><span class="s1">&#39;bins&#39;</span><span class="p">],</span><span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span><span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">})</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;| </span><span class="si">%s</span><span class="s1"> (msec) |&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;trial_type=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">type_</span><span class="p">))</span>
    <span class="c1">##pofa</span>
    <span class="n">type_</span><span class="o">=</span><span class="s1">&#39;pofa&#39;</span>
    <span class="n">df_1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">type_</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;TrialNum_&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#5d9f6c&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_1</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span>
                <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">x_bins</span><span class="o">=</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;unbinned&#39;</span><span class="p">][</span><span class="s1">&#39;bins&#39;</span><span class="p">],</span><span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span><span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">})</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;trial_type=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">type_</span><span class="p">))</span>
    <span class="c1">#append</span>
    <span class="n">html_plots</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span><span class="s2">&quot;file&quot;</span><span class="p">:</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]),</span><span class="s2">&quot;footnote&quot;</span><span class="p">:</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;footnote&#39;</span><span class="p">],</span><span class="s2">&quot;anchor&quot;</span><span class="p">:</span><span class="s2">&quot;gtl&quot;</span><span class="p">})</span>
    <span class="c1">#tight layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1">#save</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="c1">#clear figure from memory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1">#--------finished</span>
    <span class="c1">#timestamp</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">html_plots</span></div>

<div class="viewcode-block" id="density_plot"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.density_plot">[docs]</a><span class="k">def</span> <span class="nf">density_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create density plot (draws kernel density estimate), using seaborn and pandas.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : :obj:`dict`</span>
<span class="sd">        Configuration data.</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    title : :obj:`str`</span>
<span class="sd">        Chart title.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cm</span>
<span class="sd">        Bokeh or seaborn plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    
    <span class="c1">#seaborn</span>
    <span class="c1">#https://seaborn.pydata.org/generated/seaborn.distplot.html</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running density_plot()&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    
    <span class="c1">#remove cesd_group, trialType_ column</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;trialType_&#39;</span><span class="p">,</span><span class="s1">&#39;cesd_group&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1">#create metadata to be used for html file</span>
    <span class="n">html_plots</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1">#for each column</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span>
        <span class="c1">#----plot type</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#----plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">density</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">norm_hist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="c1">#bins - number of bins for histogram</span>
                               <span class="n">hist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                               <span class="c1">#bw (bandwidth) - width of the kernels</span>
                               <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">kde_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;clip&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;bw&#39;</span><span class="p">:</span><span class="s1">&#39;scott&#39;</span><span class="p">,</span><span class="s1">&#39;kernel&#39;</span><span class="p">:</span><span class="s1">&#39;gau&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
        
        <span class="c1">#----design</span>
        <span class="c1">#tight layout</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        
        <span class="c1">#----save</span>
        <span class="c1">#check if path exists</span>
        <span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;density_</span><span class="si">%s</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/analysis/html/img/density/&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="c1">#save</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        
        <span class="c1">#append </span>
        <span class="n">html_plots</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> for </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">item</span><span class="p">),</span><span class="s2">&quot;file&quot;</span><span class="p">:</span><span class="s1">&#39;density/&#39;</span><span class="o">+</span><span class="n">file</span><span class="p">,</span><span class="s2">&quot;footnote&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">})</span>
        <span class="c1">#clear figure from memory</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
         
    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">density</span><span class="p">,</span> <span class="n">html_plots</span></div>

<div class="viewcode-block" id="corr_matrix"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.corr_matrix">[docs]</a><span class="k">def</span> <span class="nf">corr_matrix</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">footnote</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Create correlation matrix using bokeh and pandas.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : :obj:`dict`</span>
<span class="sd">        Configuration data.</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    path : :obj:`str`</span>
<span class="sd">        The directory path to save the bokeh or plot.</span>
<span class="sd">    method : :obj:`str`</span>
<span class="sd">        Spearman or Pearsons correlation coefficient.</span>
<span class="sd">    title : :obj:`str`</span>
<span class="sd">        Chart title.</span>
<span class="sd">    footnote : :obj:`str`</span>
<span class="sd">        Chart footnote.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cm</span>
<span class="sd">        Bokeh plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running bokeh corr_matrix()&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="c1"># math</span>
    <span class="kn">import</span> <span class="nn">bisect</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">pi</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">arange</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">chain</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
    
    <span class="c1"># bokeh</span>
    <span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="k">import</span> <span class="n">ColorBar</span><span class="p">,</span> <span class="n">LinearColorMapper</span><span class="p">,</span> <span class="n">TapTool</span><span class="p">,</span> <span class="n">HoverTool</span><span class="p">,</span> <span class="n">Range1d</span><span class="p">,</span> <span class="n">ColumnDataSource</span>
    <span class="kn">from</span> <span class="nn">bokeh.models.callbacks</span> <span class="k">import</span> <span class="n">CustomJS</span>
    <span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="k">import</span> <span class="n">reset_output</span><span class="p">,</span> <span class="n">figure</span>
    <span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="k">import</span> <span class="n">components</span>

    <span class="c1">#create color palette</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">cm</span> <span class="k">as</span> <span class="n">mpl_cmap</span>
    
    <span class="c1">#p-values</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;pearson&quot;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">pearsonr</span> <span class="k">as</span> <span class="n">cf</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;spearman&quot;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">spearmanr</span> <span class="k">as</span> <span class="n">cf</span>
    
    <span class="c1">#calculate p-values correlation coefficent</span>
    <span class="k">def</span> <span class="nf">get_pvalue</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">_get_numeric_data</span><span class="p">()</span>
        <span class="n">dfcols</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">pvalues</span> <span class="o">=</span> <span class="n">dfcols</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dfcols</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">pvalues</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">cf</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pvalues</span>

    <span class="c1">#Gets bounds for quads with n features</span>
    <span class="k">def</span> <span class="nf">get_bounds</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">nlabels</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)]))</span>
        <span class="n">top</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">nlabels</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)]))</span>
        <span class="n">left</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">))</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)]))</span>
        <span class="n">right</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlabels</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)]))</span>
        <span class="n">corr_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">nlabels</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)]))</span>
        <span class="k">return</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">corr_items</span>
    
    <span class="c1">#Aligns color values from palette with the correlation coefficient and p-values</span>
    <span class="k">def</span> <span class="nf">get_colors_corr</span><span class="p">(</span><span class="n">corr_array</span><span class="p">,</span> <span class="n">p_array</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">c_corr</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">corr_color</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_color</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">corr_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">factor_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">itr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">corr</span><span class="p">,</span> <span class="n">pvalue</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">corr_array</span><span class="p">,</span><span class="n">p_array</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">c_corr</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span>
            <span class="c1">#colors</span>
            <span class="c1">##corr_color</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">itr</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">nlabels</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">corr_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#022f62&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">corr_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">ind</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">##pcolor</span>
            <span class="k">if</span> <span class="n">pvalue</span><span class="o">&lt;=</span><span class="mf">0.05</span><span class="p">:</span>
                <span class="n">p_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#F44336&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_color</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="n">ind</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">#append corr and pvalues</span>
            <span class="n">corr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
            <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pvalue</span><span class="p">)</span>
            <span class="n">factor_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">]&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">l_labels</span><span class="p">[</span><span class="n">itr</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">l_labels</span><span class="p">[</span><span class="n">itr</span><span class="p">][</span><span class="mi">1</span><span class="p">])])</span>
            <span class="n">itr</span> <span class="o">=</span> <span class="n">itr</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">corr_color</span><span class="p">,</span> <span class="n">corr_list</span><span class="p">,</span> <span class="n">p_color</span><span class="p">,</span> <span class="n">p_list</span><span class="p">,</span> <span class="n">factor_list</span>
    
    <span class="c1">#create seaborn plots for each possible correlation combinations</span>
    <span class="k">def</span> <span class="nf">get_corr_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>

        <span class="c1">#----parameters</span>
        <span class="c1">#figure</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="c1">#bounds</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.085</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        
        <span class="c1">#----title</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;x=</span><span class="si">%s</span><span class="s2">, y=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        
        <span class="c1">#----set style</span>
        <span class="c1">#pal = sns.color_palette(&quot;Set1&quot;, n_colors=2, desat=.5)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1">#----plot</span>
        <span class="c1">#if grouping #g = sns.lmplot(x, y, hue=groupby, data=df, palette=pal).set_title(title)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fit_reg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        
        <span class="c1">#----add rho, p-value to plot</span>
        <span class="c1">#get values</span>
        <span class="n">corr_r</span> <span class="o">=</span> <span class="n">cf</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
        <span class="n">corr_t</span> <span class="o">=</span> <span class="s2">&quot;r = </span><span class="si">%.2f</span><span class="s2">, p &lt; </span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">corr_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">corr_r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">#place text 90% of max-x and 90% of max-y</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">corr_t</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

        <span class="c1">#----save</span>
        <span class="c1">#check if path exists</span>
        <span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/analysis/html/img/corr/&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="c1">#save</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">file</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1">#reset</span>
    <span class="n">reset_output</span><span class="p">()</span>
    
    <span class="c1">#get color map</span>
    <span class="n">RdYlBu</span> <span class="o">=</span> <span class="n">mpl_cmap</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
    <span class="n">colors_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">RdYlBu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors_np</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;RedBlue&#39;</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">32</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)]</span>

    <span class="c1"># calculate correlation coefficients</span>
    <span class="c1">#coeff</span>
    <span class="n">corr_coeff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="c1">#p-value</span>
    <span class="n">p_value</span> <span class="o">=</span> <span class="n">get_pvalue</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="c1"># get list and number of variables</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">nlabels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corr_coeff</span><span class="p">)</span>

    <span class="c1">#create list of labels</span>
    <span class="c1">##x</span>
    <span class="n">l_labels_x</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">*</span> <span class="n">nlabels</span>
    <span class="c1">##y</span>
    <span class="n">l_labels_y</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">*</span> <span class="n">nlabels</span>
    <span class="c1">###split into chunks</span>
    <span class="n">l_labels_y_split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">l_labels_y</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">)),</span> <span class="n">nlabels</span><span class="p">)</span>
    <span class="n">l_labels_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">l_labels_y_split</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1">##combine</span>
    <span class="n">l_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">l_labels_x</span><span class="p">,</span> <span class="n">l_labels_y</span><span class="p">))</span>

    <span class="c1">#create coeff label coordinates</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">num</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="c1">##x</span>
    <span class="n">num_x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.025</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">num</span><span class="p">]</span>
    <span class="n">num_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">num_x</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> <span class="o">*</span> <span class="n">nlabels</span>
    <span class="c1">##y</span>
    <span class="n">num_y</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="o">+</span> <span class="o">.</span><span class="mi">125</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">num</span><span class="p">]</span>
    <span class="n">num_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">num_y</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> <span class="o">*</span> <span class="n">nlabels</span>

    <span class="c1">###split into chunks</span>
    <span class="n">num_y_split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">num_y</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">)),</span> <span class="n">nlabels</span><span class="p">)</span>
    <span class="n">num_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">num_y_split</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1">##combine</span>
    <span class="c1">#num_labels = list(zip(num_x, num_y))</span>

    <span class="c1">#plot</span>
    <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;box_select,save,reset&quot;</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">),</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nlabels</span><span class="p">),</span> 
                <span class="n">output_backend</span><span class="o">=</span><span class="s2">&quot;webgl&quot;</span><span class="p">)</span>

    <span class="c1">#hover</span>
    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
    <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
         <span class="p">(</span><span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="s2">&quot;@factor&quot;</span><span class="p">),</span>
         <span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;@coeff_num&quot;</span><span class="p">),</span>
         <span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;@p_num&quot;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="c1">#cm.tools.append(hover)</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">hover</span><span class="o">.</span><span class="n">line_policy</span> <span class="o">=</span> <span class="s2">&quot;nearest&quot;</span>

    <span class="c1">#legend</span>
    <span class="c1">#cm.toolbar.logo = None</span>

    <span class="c1">#grid</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">4</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">4</span>

    <span class="c1">#turn off scientific notation</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">use_scientific</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># prepare squares for plot</span>
    <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">corr_items</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">nlabels</span><span class="p">)</span>
    <span class="n">color_list</span><span class="p">,</span><span class="n">corr</span><span class="p">,</span><span class="n">p_color</span><span class="p">,</span><span class="n">pvalues</span><span class="p">,</span><span class="n">factor</span> <span class="o">=</span> <span class="n">get_colors_corr</span><span class="p">(</span><span class="n">corr_coeff</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">p_value</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">colors</span><span class="p">)</span>

    <span class="c1">#prepare corr_coeff label for plot</span>
    <span class="n">coeff_color</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#444444&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nlabels</span> <span class="o">*</span> <span class="n">nlabels</span><span class="p">)</span>
    <span class="n">coeff_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#f9f9f9&#39;</span> <span class="k">if</span> <span class="n">cr</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.74</span><span class="p">)</span> <span class="k">else</span> <span class="n">cof</span> <span class="k">for</span> <span class="n">cof</span><span class="p">,</span> <span class="n">cr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coeff_color</span><span class="p">,</span> <span class="n">corr</span><span class="p">)]</span>
    <span class="n">coeff_num</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">corr</span><span class="p">]</span>

    <span class="c1">#prepare pvalue for plot</span>
    <span class="n">p_color</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#444444&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">nlabels</span> <span class="o">*</span> <span class="n">nlabels</span><span class="p">)</span>
    <span class="n">p_color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#F44336&#39;</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span> <span class="k">else</span> <span class="n">cof</span> <span class="k">for</span> <span class="n">pcol</span><span class="p">,</span> <span class="n">cof</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p_color</span><span class="p">,</span> <span class="n">coeff_color</span><span class="p">,</span> <span class="n">pvalues</span><span class="p">)]</span>
    <span class="n">p_num</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;(</span><span class="si">%.2f</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">pvalues</span><span class="p">]</span>

    <span class="c1">#data source</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span>
                                        <span class="n">x</span><span class="o">=</span><span class="n">num_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">num_y</span><span class="p">,</span> <span class="n">coeff_num</span><span class="o">=</span><span class="n">coeff_num</span><span class="p">,</span> <span class="n">coeff_color</span><span class="o">=</span><span class="n">coeff_color</span><span class="p">,</span>
                                        <span class="n">p_num</span><span class="o">=</span><span class="n">p_num</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span> <span class="n">square_color</span><span class="o">=</span><span class="n">color_list</span><span class="p">,</span> <span class="n">p_color</span><span class="o">=</span><span class="n">p_color</span><span class="p">))</span>
    <span class="c1">#create squares</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> 
            <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;square_color&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

    <span class="c1">#create text</span>
    <span class="c1">#correlation coefficient</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;coeff_color&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;coeff_num&#39;</span><span class="p">,</span> 
            <span class="n">text_font_style</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">text_font_size</span> <span class="o">=</span> <span class="s1">&#39;1.5em&#39;</span><span class="p">,</span> <span class="n">text_align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">y_offset</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">x_offset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">text_line_height</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#p-value</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">text_color</span><span class="o">=</span><span class="s2">&quot;p_color&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;p_num&#39;</span><span class="p">,</span> 
            <span class="n">text_font_style</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">text_font_size</span> <span class="o">=</span> <span class="s1">&#39;1.0em&#39;</span><span class="p">,</span> <span class="n">text_align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">y_offset</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">x_offset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">text_line_height</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">#callback</span>
    <span class="n">link</span> <span class="o">=</span> <span class="n">CustomJS</span><span class="p">(</span><span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        console.log(&quot;second&quot;)</span>
<span class="s2">        obj = cb_obj</span>
<span class="s2">        s = source</span>
<span class="s2">        data = source.data</span>
<span class="s2">        attr = source.attributes</span>
<span class="s2">        d = attr.data</span>

<span class="s2">        //selected item</span>
<span class="s2">        id = source.selected[&#39;1d&#39;].indices</span>
<span class="s2">        item = d.factor[id][0].replace(/[[\]]/g,&#39;&#39;).match(/(&quot;.*?&quot;)|(\S+)/g)</span>
<span class="s2">        console.log(&#39;id: &#39; + id + &#39;, item: &#39; + item)</span>
<span class="s2">        </span>
<span class="s2">        //url</span>
<span class="s2">        path = window.location.href</span>
<span class="s2">        current = path.split(&quot;/&quot;).slice(0,-1).join(&quot;/&quot;)</span>
<span class="s2">        url = current + &#39;/reg.html?x=&#39;+ item[0] + &#39;y=&#39; + item[1]</span>
<span class="s2">        window.open(url)</span>
<span class="s2">        //window.open(url, &#39;newwindow&#39;, config=&#39;height=720, width=1280&#39;)</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">TapTool</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="n">link</span><span class="p">))</span>  

    <span class="c1">#reverse y-axis</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">y_range</span> <span class="o">=</span> <span class="n">Range1d</span><span class="p">(</span><span class="n">nlabels</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1">#p.y_range = Range1d(monitorSize[1], 0)</span>

    <span class="c1"># Set ticks with labels</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span><span class="o">+</span><span class="mf">0.5</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nlabels</span><span class="p">))]</span>
    <span class="n">tick_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([[</span><span class="n">tick</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ticks</span><span class="p">)])</span>

    <span class="c1"># Create the correct number of ticks for each axis</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="n">ticks</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">ticker</span> <span class="o">=</span> <span class="n">ticks</span>

    <span class="c1"># Override the labels</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_overrides</span> <span class="o">=</span> <span class="n">tick_dict</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">major_label_overrides</span> <span class="o">=</span> <span class="n">tick_dict</span>

    <span class="c1">#color bar</span>
    <span class="n">mapper</span> <span class="o">=</span> <span class="n">LinearColorMapper</span><span class="p">(</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
        <span class="n">low</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">color_bar</span> <span class="o">=</span> <span class="n">ColorBar</span><span class="p">(</span><span class="n">color_mapper</span><span class="o">=</span><span class="n">mapper</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">cm</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">color_bar</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>

    <span class="c1">#create link for each comparison</span>
    <span class="n">all_columns</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">clm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">all_columns</span><span class="p">):</span>
        <span class="n">get_corr_plot</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">clm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">clm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1">#get html</span>
    <span class="n">script</span><span class="p">,</span> <span class="n">div</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    
    <span class="c1">##convert seperate plots and div to single string</span>
    <span class="n">plots</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="n">div</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">script</span><span class="p">])))</span>

    <span class="c1">#create html</span>
    <span class="n">html</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">plots</span><span class="o">=</span><span class="n">plots</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;bokeh&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">footnote</span><span class="o">=</span><span class="n">footnote</span><span class="p">)</span>

    <span class="c1">#reset</span>
    <span class="n">reset_output</span><span class="p">()</span>

    <span class="c1">#--------finished</span>
    <span class="c1">#timestamp</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cm</span></div>

<span class="k">def</span> <span class="nf">single_subject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create single subject scatterplot using seaborn and pandas.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    path : :obj:`str`</span>
<span class="sd">        The directory path to save the bokeh or seaborn plot.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cm</span>
<span class="sd">        Bokeh or seaborn plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running single_subject()&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
    
    <span class="c1">#styling plot</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;darkgrid&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;paper&quot;</span><span class="p">)</span>

    <span class="c1">#events</span>
    <span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">]</span>
    
    <span class="c1">#get first pofa and iaps</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s1">&#39;trialType&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)[</span><span class="s1">&#39;TrialNum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="c1">#get display size</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;monitorSize.px&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)]</span>
    
    <span class="c1">#drop x - outside coordinates</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sg_x&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)]</span> <span class="c1">#drop all gaze_x &lt; 0</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sg_x&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="c1">#drop all gaze_x &gt; width</span>
    
    <span class="c1">#drop timestamp - outside coordinates</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">8000</span><span class="p">)]</span>
    
    <span class="c1">#drop all non fixations</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;sg_fix_all&#39;</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">)]</span>
    
    <span class="c1">#loop to draw event markers</span>
    <span class="k">def</span> <span class="nf">xline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="n">trialType</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">TrialNum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;TrialNum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#check if first iaps or first pofa</span>
        <span class="k">if</span> <span class="n">TrialNum</span> <span class="ow">in</span> <span class="n">first</span><span class="p">:</span>
            <span class="c1">#fixation onset</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="s1">&#39;fixation&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1">##annotation</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;Fixation Onset&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">100</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">25</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c1">#fixation offset</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="s1">&#39;fixation&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1">##annotation</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;Stimulus Offset&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="mi">100</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">25</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c1">#stimulus offset</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="s1">&#39;fixation&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">events</span><span class="p">[</span><span class="s1">&#39;stimulus&#39;</span><span class="p">][</span><span class="n">trialType</span><span class="p">]</span>
            <span class="c1">#line</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1">#annotation</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="s2">&quot;Dotloc Offset&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">time</span> <span class="o">+</span> <span class="mi">100</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">25</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        
    <span class="c1">#plot    </span>
    <span class="n">pal</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">192</span><span class="p">)</span>    
    <span class="n">sp</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s2">&quot;trialType&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">pal</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;TrialNum&quot;</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;sg_x&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">map_dataframe</span><span class="p">(</span><span class="n">xline</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
            
    <span class="c1">#post</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Gaze Coordinates (x)&quot;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;trialType = IAPS&quot;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;trialType = POFA&quot;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    
    <span class="c1">#size</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="c1">#save</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="c1">#clear figure from memory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c1">#--------finished</span>
    <span class="c1">#timestamp</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span> 

<div class="viewcode-block" id="boxplot"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.boxplot">[docs]</a><span class="k">def</span> <span class="nf">boxplot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">plots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cat</span><span class="o">=</span><span class="s1">&#39;analysis&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates boxplot using seaborn and pandas.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : :obj:`dict`</span>
<span class="sd">        Configuration data.</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    path : :obj:`str`</span>
<span class="sd">        Path to save data.</span>
<span class="sd">    drift : :obj:`str`</span>
<span class="sd">        X-axis.</span>
<span class="sd">    drift : :obj:`str`</span>
<span class="sd">        Y-axis.</span>
<span class="sd">    title : :obj:`str`</span>
<span class="sd">        Plot title.</span>
<span class="sd">    plots : :obj:`dict`</span>
<span class="sd">        Dictionary of plots metadata.</span>
<span class="sd">    cat : :obj:`str`</span>
<span class="sd">        Type of plot.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running boxplot(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

	<span class="c1"># start</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">short_</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;short&#39;</span><span class="p">]</span>
    <span class="c1">#if looking at dwell time</span>
    <span class="k">if</span> <span class="n">cat</span><span class="o">==</span><span class="s1">&#39;bias&#39;</span><span class="p">:</span>
        <span class="c1">#plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1">#design</span>
        <span class="c1">##for each unique value in x-axis variable, assign color</span>
        <span class="n">cat_x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]</span>
        <span class="n">pal</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cat_x</span><span class="p">,</span> <span class="n">color</span><span class="p">))</span>
        
        <span class="c1">#create plot</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">trialType</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">],[</span><span class="s1">&#39;iaps&#39;</span><span class="p">,</span><span class="s1">&#39;pofa&#39;</span><span class="p">]):</span>
            <span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">trialType</span><span class="p">])]</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;.fitted&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">pal</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;.fitted&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;.25&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">trialType</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">short_</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">trialType</span> <span class="o">==</span> <span class="s1">&#39;pofa&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    
    <span class="c1">#if looking at dwell time</span>
    <span class="k">if</span> <span class="n">cat</span><span class="o">==</span><span class="s1">&#39;dwell&#39;</span><span class="p">:</span>
        <span class="c1">#plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1">#design</span>
        <span class="c1">##for each unique value in x-axis variable, assign color</span>
        <span class="n">cat_x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]</span>
        <span class="n">pal</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cat_x</span><span class="p">,</span> <span class="n">color</span><span class="p">))</span>
        
        <span class="c1">#create plot</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">trialType</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">],[</span><span class="s1">&#39;iaps&#39;</span><span class="p">,</span><span class="s1">&#39;pofa&#39;</span><span class="p">]):</span>
            <span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trialType&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">trialType</span><span class="p">])]</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;.fitted&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">pal</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;.fitted&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;.25&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">trialType</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">short_</span><span class="p">[</span><span class="s1">&#39;aoi&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">trialType</span> <span class="o">==</span> <span class="s1">&#39;pofa&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    
    <span class="c1">#if looking at variables like gaze_bias, dp_bias</span>
    <span class="k">elif</span> <span class="n">cat</span><span class="o">==</span><span class="s1">&#39;analysis&#39;</span><span class="p">:</span>
        <span class="c1">#plot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">19.2</span><span class="p">,</span> <span class="mf">10.8</span><span class="p">),</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="c1">#design</span>
        <span class="c1">##for each unique value in x-axis variable, assign color</span>
        <span class="n">cat_x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">]</span>
        <span class="n">pal</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cat_x</span><span class="p">,</span> <span class="n">color</span><span class="p">))</span>
        
        <span class="c1">#create plot</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">itm</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">],</span><span class="n">y</span><span class="p">):</span>
            <span class="c1">#dp_bias</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">itm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">pal</span><span class="p">)</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">itm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;.25&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
            
    <span class="c1">#if looking at variables like race, gender, os        </span>
    <span class="k">elif</span> <span class="n">cat</span><span class="o">==</span><span class="s1">&#39;demographics&#39;</span><span class="p">:</span>
        <span class="c1">#layout</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;deep&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">([</span><span class="s2">&quot;#e74c3c&quot;</span><span class="p">,</span> <span class="s2">&quot;#3f51b5&quot;</span><span class="p">,</span> <span class="s2">&quot;#2ecc71&quot;</span><span class="p">,</span><span class="s2">&quot;#9b59b6&quot;</span><span class="p">,</span><span class="s2">&quot;#ffb400&quot;</span><span class="p">])</span>
        <span class="c1">#counter</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">x_</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">],</span><span class="n">x</span><span class="p">):</span>
            <span class="c1">##exclude smaller race categories for display purposees</span>
            <span class="k">if</span> <span class="n">x_</span><span class="o">==</span><span class="s1">&#39;gender&#39;</span><span class="p">:</span>
                <span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;other&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
            <span class="c1">##exclude smaller race categories for display purposes</span>
            <span class="k">elif</span> <span class="n">x_</span><span class="o">==</span><span class="s1">&#39;race&#39;</span><span class="p">:</span>
                <span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;race&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;American Indian or Alaska Native&quot;</span><span class="p">,</span><span class="s2">&quot;Two or more races&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Black or African American&quot;</span><span class="p">,</span><span class="s2">&quot;None of the above&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;participant&quot;</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">)</span>
            <span class="c1">#plot</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_</span><span class="p">)</span>
            <span class="c1">#remove label</span>
            <span class="k">if</span> <span class="n">counter</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="c1">#counter</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
    
        <span class="c1">#layer</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1">#tight layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1">##save</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="c1">#clear from memory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span> 
    
    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="cooks_plot"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.cooks_plot">[docs]</a><span class="k">def</span> <span class="nf">cooks_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create cooks distance plot plot using seaborn, pandas, and statsmodel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : :obj:`dict`</span>
<span class="sd">        Configuration data.</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    path : :obj:`str`</span>
<span class="sd">        The directory path save the seaborn plot.</span>
<span class="sd">    y : :obj:`str`</span>
<span class="sd">        The predictor variable.</span>
<span class="sd">    model : :obj:`dict`</span>
<span class="sd">        statsmodel model.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    res</span>
<span class="sd">        seaborn plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running cooks_plot(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="c1">#-------plot</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>

    <span class="c1">#plot design</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">#plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    
    <span class="c1"># influence</span>
    <span class="n">influence</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_influence</span><span class="p">()</span>
    
    <span class="c1"># cook&#39;s distance, from statsmodels internals</span>
    <span class="c1">## c is the distance and p is p-value</span>
    <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">=</span> <span class="n">influence</span><span class="o">.</span><span class="n">cooks_distance</span>
    
    <span class="c1">#plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">c</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Observation Number&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cooks Distance&#39;</span><span class="p">)</span>
    
    <span class="c1"># annotations</span>
    <span class="n">particpants</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">])</span>
    <span class="n">leverage_lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="mi">0</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">leverage_lines</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">particpants</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="c1">#tight layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1">#save</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="c1">#clear figure from memory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span></div>
   
<div class="viewcode-block" id="residual_plot"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.residual_plot">[docs]</a><span class="k">def</span> <span class="nf">residual_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create probability plot using seaborn, pandas, and rpy2.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : :obj:`dict`</span>
<span class="sd">        Configuration data.</span>
<span class="sd">    y : :obj:`str`</span>
<span class="sd">        Predictor variable.</span>
<span class="sd">    residuals : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of residuals vs fitted, qq data, and raw data.</span>
<span class="sd">    path : :obj:`str`</span>
<span class="sd">        The directory path save the seaborn plot.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lmp</span>
<span class="sd">        seaborn plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running residual_plot(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="c1">#-------plot</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
    
    <span class="c1">#-------plot design</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#-------plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="c1">#residual vs fitted plot</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">([</span><span class="s2">&quot;#bd282f&quot;</span><span class="p">,</span><span class="s2">&quot;#226db2&quot;</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;.fitted&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;.resid&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;trialType&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1">#loess smoothing curve</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;.fitted&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;.resid&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="c1">#horizontal line</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.25</span><span class="p">)</span>
    <span class="c1">#annotations</span>
    <span class="c1">##max</span>
    <span class="n">max_</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="n">residuals</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">residuals</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="n">max_x</span> <span class="o">=</span> <span class="n">max_</span><span class="p">[</span><span class="s1">&#39;.fitted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="n">max_</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_subject</span> <span class="o">=</span> <span class="n">max_</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">max_subject</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">)</span>
    <span class="c1">##min</span>
    <span class="n">min_</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="n">residuals</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">residuals</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
    <span class="n">min_x</span> <span class="o">=</span> <span class="n">min_</span><span class="p">[</span><span class="s1">&#39;.fitted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="n">min_</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_subject</span> <span class="o">=</span> <span class="n">min_</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">min_subject</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">)</span>

    <span class="c1">#-------plot design</span>
    <span class="c1">#label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;.fitted&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;.resid&#39;</span><span class="p">)</span>
    <span class="c1">#tight layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1">#-------save</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="c1">#-------clear figure from memory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span></div>

<div class="viewcode-block" id="qq_plot"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.qq_plot">[docs]</a><span class="k">def</span> <span class="nf">qq_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create probability plot using seaborn, pandas, and rpy2.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    config : :obj:`dict`</span>
<span class="sd">        Configuration data.</span>
<span class="sd">    y : :obj:`str`</span>
<span class="sd">        Predictor variable.</span>
<span class="sd">    residuals : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of residuals vs fitted, qq data, and raw data.</span>
<span class="sd">    path : :obj:`str`</span>
<span class="sd">        The directory path save the seaborn plot.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lmp</span>
<span class="sd">        seaborn plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running qq_plot(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="c1">#-------plot</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>

    <span class="c1">#plot design</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="c1">#qq residuals</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">([</span><span class="s2">&quot;#bd282f&quot;</span><span class="p">,</span><span class="s2">&quot;#226db2&quot;</span><span class="p">])</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;theoretical&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;.resid&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;trialType&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;theoretical&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;.resid&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1">#label</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Theoretical Quantiles&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sample Quantiles&#39;</span><span class="p">)</span>
    <span class="c1">#annotations</span>
    <span class="c1">##max</span>
    <span class="n">max_</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="n">residuals</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">residuals</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="n">max_x</span> <span class="o">=</span> <span class="n">max_</span><span class="p">[</span><span class="s1">&#39;theoretical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="n">max_</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_subject</span> <span class="o">=</span> <span class="n">max_</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">max_subject</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">)</span>
    <span class="c1">##min</span>
    <span class="n">min_</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="n">residuals</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">residuals</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
    <span class="n">min_x</span> <span class="o">=</span> <span class="n">min_</span><span class="p">[</span><span class="s1">&#39;theoretical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_y</span> <span class="o">=</span> <span class="n">min_</span><span class="p">[</span><span class="s1">&#39;.resid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_subject</span> <span class="o">=</span> <span class="n">min_</span><span class="p">[</span><span class="s1">&#39;participant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">min_subject</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;semibold&#39;</span><span class="p">)</span>
    
    <span class="c1">#tight layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1">#save</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="c1">#clear figure from memory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plt</span></div>

<div class="viewcode-block" id="logit_plot"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.logit_plot">[docs]</a><span class="k">def</span> <span class="nf">logit_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">param</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create logistic regression plot using seaborn and pandas</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    path : :obj:`str`</span>
<span class="sd">        The directory path save the seaborn plot.</span>
<span class="sd">    param : :obj:`dict`</span>
<span class="sd">        x, y, groupby parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    lmp</span>
<span class="sd">        seaborn plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#----for timestamp</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;processing.logit_plot()&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">plt</span><span class="p">);</span> <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
    
    <span class="c1">#plot design</span>
    <span class="n">p</span><span class="o">=</span><span class="n">param</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;style&#39;</span><span class="p">][</span><span class="s1">&#39;seaborn&#39;</span><span class="p">],</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s2">&quot;Helvetica&quot;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running logit_plot(), (y=</span><span class="si">%s</span><span class="s1">, x=</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="c1">#plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">19.2</span><span class="p">,</span> <span class="mf">10.8</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#iaps</span>
    <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;iaps&#39;</span>
    <span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trialType_&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">type_</span><span class="p">)]</span>
    <span class="n">lmp</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df_</span><span class="p">,</span> <span class="n">logistic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_jitter</span><span class="o">=.</span><span class="mi">02</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#5874a6&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;trial type&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;trialType=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">type_</span><span class="p">))</span>
    <span class="c1">#pofa</span>
    <span class="n">type_</span> <span class="o">=</span> <span class="s1">&#39;pofa&#39;</span>
    <span class="n">df_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;trialType_&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">type_</span><span class="p">)]</span>
    <span class="n">lmp</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df_</span><span class="p">,</span> <span class="n">logistic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">y_jitter</span><span class="o">=.</span><span class="mi">02</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#5d9f6c&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;trial type&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;trialType=</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">type_</span><span class="p">))</span>

    <span class="c1">#tight layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1">#save</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="c1">#clear figure from memory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lmp</span></div>

<div class="viewcode-block" id="html"><a class="viewcode-back" href="../../api/imhr.plot.html#imhr.plot.html">[docs]</a><span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intro</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">footnote</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create HTML output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of analysis results data.</span>
<span class="sd">    raw_data : :class:`pandas.DataFrame`</span>
<span class="sd">        Pandas dataframe of raw data.</span>
<span class="sd">    name : :obj:`str`</span>
<span class="sd">        (py::`if source is logit`) The name of csv file created.</span>
<span class="sd">    path : :obj:`str`</span>
<span class="sd">        The directory path of the html file.</span>
<span class="sd">    plots : :obj:`dict`</span>
<span class="sd">        If generating seaborn images, the list of plots used.</span>
<span class="sd">    source : :obj:`str`</span>
<span class="sd">        The type of data being recieved.</span>
<span class="sd">    trial : :obj:`str`</span>
<span class="sd">        (If Bokeh) Trial Number.</span>
<span class="sd">    session : :obj:`str`</span>
<span class="sd">        (If Bokeh) Session Number.</span>
<span class="sd">    bokeh_type : :obj:`str`</span>
<span class="sd">        (If Bokeh) Control directory location. If trial, create trial plots.</span>
<span class="sd">    title : :obj:`str`</span>
<span class="sd">        The title of the table or figure.</span>
<span class="sd">    intro : :obj:`str`</span>
<span class="sd">        The introduction of the group of figures or tables.</span>
<span class="sd">    footnote : :obj:`str`</span>
<span class="sd">        The footnote of the table or figure.</span>
<span class="sd">    metadata : :obj:`dict`</span>
<span class="sd">        Additional data to be included.</span>
<span class="sd">    **kwargs : :obj:`str`, :obj:`int`, or :obj:`None`, optional</span>
<span class="sd">        Additional properties, relevent for specific content types. Here&#39;s a list of available properties:</span>
<span class="sd">            </span>
<span class="sd">        .. list-table::</span>
<span class="sd">           :class: kwargs</span>
<span class="sd">           :widths: 25 50</span>
<span class="sd">           :header-rows: 1</span>
<span class="sd">           </span>
<span class="sd">           * - Property</span>
<span class="sd">             - Description</span>
<span class="sd">           * - **short**, **long** : :obj:`str`</span>
<span class="sd">             - Short (aoi) and long form (Area of Interest) label of html page. This is primarily used for constructing metadata tags in html.</span>
<span class="sd">           * - **display** : :obj:`str`</span>
<span class="sd">             - (For bokeh) The type of calibration/validation display.</span>
<span class="sd">           * - **trial** : :obj:`str`</span>
<span class="sd">             - (For bokeh) The trial number for the eyetracking task.</span>
<span class="sd">           * - **session** : :obj:`int`</span>
<span class="sd">             - (For bokeh) The session number for the eyetracking task.</span>
<span class="sd">           * - **day** : :obj:`str`</span>
<span class="sd">             - (For bokeh) The day the eyetracking task was run.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    html : :obj:`str`</span>
<span class="sd">        String of html code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#----initiate fonts</span>
    <span class="n">__font__</span><span class="p">()</span>
    
    <span class="c1">#timestamp</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
    <span class="n">_t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="n">debug</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;running plot.html()&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    
    <span class="c1">#---copy csv, imhr, js files to each model</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;logit&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;onset&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;anova&quot;</span><span class="p">)):</span>
        <span class="c1">#copy files</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;css&#39;</span><span class="p">,</span><span class="s1">&#39;imhr&#39;</span><span class="p">,</span><span class="s1">&#39;js&#39;</span><span class="p">]:</span>
            <span class="n">source_</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/analysis/html/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
            <span class="n">dest_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
            <span class="n">dir_util</span><span class="o">.</span><span class="n">copy_tree</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="n">source_</span><span class="p">,</span> <span class="n">dst</span><span class="o">=</span><span class="n">dest_</span><span class="p">)</span>
    
    <span class="c1">#----if creating html file from bokeh</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">source</span><span class="o">==</span><span class="s1">&#39;bokeh&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span><span class="o">==</span><span class="s1">&#39;methods&#39;</span><span class="p">)):</span>
        <span class="c1">#get short and long names</span>
        <span class="n">short</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;short&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;short&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">source</span>
        <span class="n">long</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;long&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;long&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">source</span>
        
        <span class="c1">#if trial plot</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">source</span><span class="o">==</span><span class="s1">&#39;bokeh&#39;</span><span class="p">):</span>
            <span class="n">display</span> <span class="o">=</span>  <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;display&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;display&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">trial</span> <span class="o">=</span>  <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;trial&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">session</span> <span class="o">=</span>  <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;session&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">day</span> <span class="o">=</span>  <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;day&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">display</span><span class="o">==</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">display</span><span class="o">==</span><span class="s1">&#39;calibration&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">display</span><span class="o">==</span><span class="s1">&#39;validation&#39;</span><span class="p">)):</span>
                <span class="n">parent</span><span class="o">=</span><span class="s1">&#39;../&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parent</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            
        <span class="c1">#build header</span>
        <span class="n">link</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">css</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">js</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;title&gt;IMHR [webgazer] </span><span class="si">%s</span><span class="s1">&lt;/title&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">long</span><span class="p">))</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;title&quot; content=&quot;mdl[webgazer]: </span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">long</span><span class="p">))</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;description&quot; content=&quot;Results from our feasibility study for in-browser eyetracking.&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;author&quot; content=&quot;Semeon Risom&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;email&quot; content=&quot;semeon.risom@gmail.com&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;robots&quot; content=&quot;index,follow&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;AdsBot-Google&quot; content=&quot;noindex&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--size--&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; charset=&quot;utf-8&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--no cache--&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-cache, no-store, must-revalidate&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Pragma&quot; content=&quot;no-cache&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Expires&quot; content=&quot;0&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--icons--&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;shortcut icon&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon.ico&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; sizes=&quot;16x16 32x32 64x64&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon.ico&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;196x196&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-192.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;160x160&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-160.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;96x96&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-96.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;64x64&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-64.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;32x32&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-32.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;16x16&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-16.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-57.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;114x114&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-114.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;72x72&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-72.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;144x144&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-144.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;60x60&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-60.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;120x120&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-120.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;76x76&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-76.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;152x152&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-152.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;180x180&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-180.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-TileColor&quot; content=&quot;#FFFFFF&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-TileImage&quot; content=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;imhr/favicon/favicon-144.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-config&quot; content=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;docs/favicon/browserconfig.xml&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;css/user.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/jquery/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/user.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/lodash.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--bootstrap--&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;css/bootstrap/bootstrap.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--bokeh--&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;css/bokeh/bokeh-1.0.4.min.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;css/bokeh/bokeh-widgets-1.0.4.min.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;css/bokeh/bokeh-tables-1.0.4.min.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/bokeh/bokeh-1.0.4.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/bokeh/bokeh-widgets-1.0.4.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/bokeh/bokeh-tables-1.0.4.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/bokeh/bokeh-gl-1.0.4.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/bokeh/bokeh-api-1.0.4.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/popper.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;&#39;</span><span class="o">+</span><span class="n">parent</span><span class="o">+</span><span class="s1">&#39;js/bootstrap/bootstrap.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        
        <span class="c1"># finish header</span>
        <span class="n">head</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">link</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">css</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">js</span><span class="p">)))</span>
        
        <span class="c1">#body, footer</span>
        <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;bokeh&#39;</span><span class="p">:</span>
            <span class="c1">#build body</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;div class=&quot;container&quot; style=&quot;&quot;&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;div class=&quot;container bokeh&quot; style=&quot;&quot;&gt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;&lt;div class=&quot;figure </span><span class="si">%s</span><span class="s1">&quot; trial-id=&quot;</span><span class="si">%s</span><span class="s1">&quot; session-id=&quot;</span><span class="si">%s</span><span class="s1">&quot; day-id=&quot;</span><span class="si">%s</span><span class="s1">&quot; type-id=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="se">\</span>
<span class="s1">                            &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">display</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">display</span><span class="p">),</span>
                                <span class="s1">&#39;&lt;div class=&quot;title&quot;&gt;&lt;b&gt;Figure 1.&lt;/b&gt; &lt;a&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">title</span><span class="p">),</span>
                                <span class="s1">&#39;&lt;div class=&quot;date&quot;&gt; Last Updated: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                <span class="n">plots</span><span class="p">,</span>
                                <span class="s1">&#39;&lt;div class=&quot;footnote&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">footnote</span><span class="p">),</span>
                            <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>
            <span class="c1"># finish body</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">)))</span>
            
            <span class="c1">#build footer</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">display</span><span class="o">==</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">display</span><span class="o">==</span><span class="s1">&#39;calibration&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">display</span><span class="o">==</span><span class="s1">&#39;validation&#39;</span><span class="p">)):</span>
                <span class="n">foot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;script&gt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;$(document).ready(function() {getinput();});&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;/script&gt;&#39;</span><span class="p">]</span>
                <span class="c1"># finish footer</span>
                <span class="n">foot</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">foot</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">foot</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                
        <span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;methods&#39;</span><span class="p">:</span>
            <span class="c1">#build body</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;div class=&quot;container&quot; style=&quot;&quot;&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;div class=&quot;dashboard-main&quot;&gt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;&lt;div class=&quot;table-container&quot;&gt;&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;&lt;div class=&quot;title&quot;&gt;&lt;a&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s1">&lt;/b&gt;&lt;/a&gt;&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="p">,</span>
                                <span class="n">plots</span><span class="p">,</span>
                            <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>
            <span class="c1"># finish body</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">)))</span>
            <span class="c1">#build footer</span>
            <span class="n">foot</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="c1">#build html</span>
        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;html short=&quot;</span><span class="si">%s</span><span class="s1">&quot; long=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">short</span><span class="p">,</span> <span class="n">long</span><span class="p">),</span>
                    <span class="s1">&#39;&lt;head&gt;&#39;</span><span class="p">,</span>
                        <span class="n">head</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/head&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;body id=&quot;body&quot; class=&quot;</span><span class="si">%s</span><span class="s1">&quot; style=&quot;margin: 0px; background-color: #434e54 !important;&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">display</span><span class="p">),</span>
                        <span class="n">body</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/body&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;footer&gt;&#39;</span><span class="p">,</span>
                        <span class="n">foot</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/footer&gt;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&lt;/html&gt;&#39;</span><span class="p">]</span>
        <span class="c1"># finish html</span>
        <span class="n">html</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html</span><span class="p">)))</span>
        
    <span class="c1">#all other html</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#get short and long names</span>
        <span class="n">short</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;short&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;short&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">source</span>
        <span class="n">long</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;long&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;long&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">source</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;var&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="n">source</span>
        
        <span class="c1">#build header</span>
        <span class="n">link</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">css</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">js</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;title&gt;IMHR [webgazer] </span><span class="si">%s</span><span class="s1">&lt;/title&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">long</span><span class="p">))</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;title&quot; content=&quot;mdl[webgazer]: </span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">long</span><span class="p">))</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;description&quot; content=&quot;Results from our feasibility study for in-browser eyetracking.&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;author&quot; content=&quot;Semeon Risom&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;email&quot; content=&quot;semeon.risom@gmail.com&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;robots&quot; content=&quot;index,follow&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;AdsBot-Google&quot; content=&quot;noindex&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--size--&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; charset=&quot;utf-8&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--no cache--&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-cache, no-store, must-revalidate&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Pragma&quot; content=&quot;no-cache&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&quot;Expires&quot; content=&quot;0&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-TileColor&quot; content=&quot;#FFFFFF&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-TileImage&quot; content=&quot;imhr/favicon/favicon-144.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;meta name=&quot;msapplication-config&quot; content=&quot;docs/favicon/browserconfig.xml&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--icons--&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;shortcut icon&quot; href=&quot;imhr/favicon/favicon.ico&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; sizes=&quot;16x16 32x32 64x64&quot; href=&quot;imhr/favicon/favicon.ico&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;196x196&quot; href=&quot;imhr/favicon/favicon-192.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;160x160&quot; href=&quot;imhr/favicon/favicon-160.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;96x96&quot; href=&quot;imhr/favicon/favicon-96.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;64x64&quot; href=&quot;imhr/favicon/favicon-64.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;32x32&quot; href=&quot;imhr/favicon/favicon-32.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;icon&quot; type=&quot;image/png&quot; sizes=&quot;16x16&quot; href=&quot;imhr/favicon/favicon-16.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; href=&quot;imhr/favicon/favicon-57.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;114x114&quot; href=&quot;imhr/favicon/favicon-114.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;72x72&quot; href=&quot;imhr/favicon/favicon-72.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;144x144&quot; href=&quot;imhr/favicon/favicon-144.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;60x60&quot; href=&quot;imhr/favicon/favicon-60.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;120x120&quot; href=&quot;imhr/favicon/favicon-120.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;76x76&quot; href=&quot;imhr/favicon/favicon-76.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;152x152&quot; href=&quot;imhr/favicon/favicon-152.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;apple-touch-icon&quot; sizes=&quot;180x180&quot; href=&quot;imhr/favicon/favicon-180.png&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--all--&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/jquery/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/lodash.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/bootstrap/bootstrap.bundle.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--dataTables--&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/bootstrap/bootstrap.min.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/datatables/dataTables.bootstrap.min.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/datatables/responsive.bootstrap.min.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/datatables/buttons.bootstrap.min.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--user--&gt;&#39;</span><span class="p">)</span>
        <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/user.css&quot;&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--dataTables--&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/jquery.dataTables.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.rowsGroup.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.rowGroup.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.bootstrap.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.buttons.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/buttons.bootstrap.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/dataTables.responsive.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/responsive.bootstrap.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/buttons.html5.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/datatables/jszip.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--user--&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/user.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        <span class="n">js</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script&gt;source=&quot;</span><span class="si">%s</span><span class="s1">&quot;&lt;/script&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="c1"># additional libraries</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;logit&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;onset&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;anova&quot;</span><span class="p">)):</span>
            <span class="n">link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;!--prism--&gt;&#39;</span><span class="p">)</span>
            <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/prism/prism.css&quot;&gt;&#39;</span><span class="p">)</span>
            <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/prism/prism-line-numbers.css&quot;&gt;&#39;</span><span class="p">)</span>
            <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/prism/prism.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
            <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/prism/prism-r.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
            <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/prism/prism-python.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
            <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/prism/prism-line-numbers.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
            <span class="n">css</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/prism/prism-normalize-whitespace.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="p">)</span>
        
        <span class="c1"># finish header</span>
        <span class="n">head</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">link</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">css</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">js</span><span class="p">)))</span>
        
        <span class="c1">#if displaying seaborn plots</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;plots&quot;</span><span class="p">:</span>
            <span class="n">html_plots</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1">#for each plot</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plots</span><span class="p">):</span>
                <span class="n">html_p</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;div class=&quot;figure&quot; style=&quot;max-width:800px;&quot;&gt;&#39;</span><span class="p">,</span>
                            <span class="c1">#title</span>
                            <span class="s1">&#39;&lt;div class=&quot;title&quot;&gt;&lt;b&gt;Figure </span><span class="si">%s</span><span class="s1">.&lt;/b&gt; </span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">((</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]),</span>
                            <span class="c1">#date</span>
                            <span class="s1">&#39;&lt;div class=&quot;date&quot;&gt; Last Updated: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                            <span class="c1">#figure</span>
                            <span class="s1">&#39;&lt;a href=&quot;img</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&lt;img class=&quot;figure&quot; src=&quot;img</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&lt;/a&gt;&#39;</span><span class="p">,</span>
                            <span class="c1">#footnote</span>
                            <span class="s1">&#39;&lt;div class=&quot;footnote&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;footnote&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>
                <span class="n">html_plots</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html_p</span><span class="p">))))</span>
                
            <span class="c1">#build body</span>
            <span class="c1">##add none as class only if there is no intro</span>
            <span class="k">if</span> <span class="n">intro</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">intro_class</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">intro_class</span> <span class="o">=</span> <span class="kc">None</span>
                
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;div class=&quot;container&quot; style=&quot;&quot;&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;div class=&quot;container-figure </span><span class="si">%s</span><span class="s1">&quot; style=&quot;&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">display</span><span class="p">),</span>
                            <span class="s1">&#39;&lt;div class=&quot;intro </span><span class="si">%s</span><span class="s1">&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">intro_class</span><span class="p">,</span> <span class="n">intro</span><span class="p">),</span>
                                <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html_plots</span><span class="p">))),</span>
                            <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>   
            <span class="n">body</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">)))</span>
            
            <span class="c1">#build html</span>
            <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;html&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;head&gt;&#39;</span><span class="p">,</span>
                        <span class="n">head</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/head&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;body id=&quot;body&quot;&gt;&#39;</span><span class="p">,</span>
                        <span class="n">body</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/body&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/html&gt;&#39;</span><span class="p">]</span>
            <span class="n">html</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html</span><span class="p">)))</span>
            
            <span class="c1">#save</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">html_</span><span class="p">:</span>
                <span class="n">html_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
                
            <span class="c1">#--------finished</span>
            <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">html</span>
        
        <span class="c1">#if displaying dataframe tables</span>
        <span class="k">else</span><span class="p">:</span>         
            <span class="c1">#build body</span>
            <span class="c1">##save table to html for datatable</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;demographic&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;device&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;summary&quot;</span><span class="p">)):</span>
                <span class="c1">#allow word wrapping</span>
                <span class="k">if</span><span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;demographic&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">):</span>
                    <span class="n">wrap</span> <span class="o">=</span> <span class="s2">&quot;wrap&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wrap</span> <span class="o">=</span> <span class="s2">&quot;nowrap&quot;</span>
                <span class="c1"># save table to csv for downloading</span>
                <span class="c1">## check if paths exist</span>
                <span class="n">p_</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/html/csv/&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p_</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">p_</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">p_</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1">#get table</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&lt;table id=&quot;table&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">                hover dt-responsive &#39;</span><span class="o">+</span><span class="n">wrap</span><span class="o">+</span><span class="s1">&#39;&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;definitions&quot;</span><span class="p">):</span>
                <span class="c1">#wordwrap</span>
                <span class="n">wrap</span> <span class="o">=</span> <span class="s2">&quot;nowrap&quot;</span>
                <span class="c1">#prevent trucating strings</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">)</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1">##save table to csv for downloading</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/html/csv/</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1">#get table</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&lt;table id=&quot;table&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">                hover dt-responsive &#39;</span><span class="o">+</span><span class="n">wrap</span><span class="o">+</span><span class="s1">&#39;&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span>   
                <span class="c1">#reset</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;logit&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;onset&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;anova&quot;</span><span class="p">)):</span>
                <span class="c1">#prevent trucating strings</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">)</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1">##save table to csv for downloading #here saving raw data for future analysis</span>
                <span class="n">raw_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/html/csv/</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1">#get table</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&lt;table id=&quot;table&quot; data-file=&quot;&#39;</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span><span class="s1">&#39;&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">                hover dt-responsive nowrap&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span>
                <span class="c1">#reset</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">##check if paths exist</span>
                <span class="n">p_</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/analysis/html/csv/&#39;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p_</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">p_</span><span class="p">)</span>
                <span class="c1"># save table to csv for downloading</span>
                <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">p_</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.csv&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1">#get table</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&lt;table id=&quot;table&quot; data-file=&quot;&#39;</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span><span class="s1">&#39;&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">                hover dt-responsive nowrap&quot; cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span>
      
            <span class="c1">#add images to bottom of model</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;logit&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;onset&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;anova&quot;</span><span class="p">)):</span>
                <span class="n">html_plots</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1">#for each plot</span>
                <span class="k">if</span> <span class="n">plots</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fig_num</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plots</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;anova&quot;</span><span class="p">):</span>
                            <span class="c1">#if supplimentary table</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;table&#39;</span><span class="p">):</span>
                                <span class="k">if</span> <span class="s1">&#39;anchor&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="n">anchor</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;anchor&#39;</span><span class="p">]</span>
                                <span class="n">_table</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span>
                                <span class="c1">#prevent trucating strings</span>
                                <span class="n">width</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">)</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                <span class="c1">#convert df to html table</span>
                                <span class="n">_table</span> <span class="o">=</span> <span class="n">_table</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;&lt;table id=&quot;table2&quot; data-file=&quot;&#39;</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span><span class="s1">&#39;&quot; class=&quot;table &#39;</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39; table-striped table-bordered </span><span class="se">\</span>
<span class="s1">                                hover dt-responsive nowrap&quot;\ cellspacing=&quot;0&quot; width=&quot;100%&quot;&gt;&#39;</span><span class="p">)</span>
                                <span class="c1">#create table</span>
                                <span class="n">html_p</span> <span class="o">=</span> <span class="p">[</span>
                                    <span class="s1">&#39;&lt;div class=&quot;figure </span><span class="si">%s</span><span class="s1">&quot; id=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">anchor</span><span class="p">),</span>
                                        <span class="s1">&#39;&lt;div class=&quot;title&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]),</span>
                                        <span class="s1">&#39;&lt;div class=&quot;date&quot;&gt; Last Updated: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;&lt;div class=&quot;dataTables_wrapper form-inline dt-bootstrap&quot;&gt;&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;&lt;!--script--&gt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
                                            <span class="n">_table</span><span class="p">,</span>
                                        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;&lt;div class=&quot;footnote&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;footnote&#39;</span><span class="p">]),</span>
                                    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>
                                <span class="n">html_p</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html_p</span><span class="p">)))</span>
                                <span class="c1">#reset</span>
                                <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
                            <span class="c1">#else is plot</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">fig_num</span> <span class="o">=</span> <span class="n">fig_num</span> <span class="o">+</span> <span class="mi">1</span>
                                <span class="k">if</span> <span class="s1">&#39;anchor&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                    <span class="n">anchor</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;anchor&#39;</span><span class="p">]</span>  
                                <span class="k">else</span><span class="p">:</span> 
                                    <span class="n">anchor</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                                <span class="n">html_p</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;div class=&quot;figure </span><span class="si">%s</span><span class="s1">&quot; id=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">anchor</span><span class="p">),</span>
                                              <span class="c1">#title</span>
                                              <span class="s1">&#39;&lt;div class=&quot;title&quot;&gt;&lt;b&gt;Figure </span><span class="si">%d</span><span class="s1">.&lt;/b&gt; </span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fig_num</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]),</span>
                                              <span class="c1">#date</span>
                                              <span class="s1">&#39;&lt;div class=&quot;date&quot;&gt; Last Updated: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                              <span class="c1">#figure</span>
                                              <span class="s1">&#39;&lt;a class=&quot;img&quot; href=&quot;img</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&lt;img class=&quot;img&quot; src=&quot;img</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&lt;/a&gt;&#39;</span><span class="p">,</span>
                                              <span class="c1">#footnote</span>
                                              <span class="s1">&#39;&lt;div class=&quot;footnote&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;footnote&#39;</span><span class="p">]),</span>
                                        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>
                        <span class="c1">#else is plot</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fig_num</span> <span class="o">=</span> <span class="n">fig_num</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="s1">&#39;anchor&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                                <span class="n">anchor</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;anchor&#39;</span><span class="p">]</span>  
                            <span class="k">else</span><span class="p">:</span> 
                                <span class="n">anchor</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                            <span class="n">html_p</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;div class=&quot;figure </span><span class="si">%s</span><span class="s1">&quot; id=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">anchor</span><span class="p">),</span>
                                        <span class="c1">#title</span>
                                        <span class="s1">&#39;&lt;div class=&quot;title&quot;&gt;&lt;b&gt;Figure </span><span class="si">%d</span><span class="s1">.&lt;/b&gt; </span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fig_num</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]),</span>
                                        <span class="c1">#date</span>
                                        <span class="s1">&#39;&lt;div class=&quot;date&quot;&gt; Last Updated: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                        <span class="c1">#figure</span>
                                        <span class="s1">&#39;&lt;a class=&quot;img&quot; href=&quot;img</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&lt;img class=&quot;img&quot; src=&quot;img</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;</span><span class="se">\n</span><span class="s1">&lt;/a&gt;&#39;</span><span class="p">,</span>
                                        <span class="c1">#footnote</span>
                                        <span class="s1">&#39;&lt;div class=&quot;footnote&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;footnote&#39;</span><span class="p">]),</span>
                                    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>
                        
                        <span class="c1">#----append to html plots </span>
                        <span class="n">html_plots</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html_p</span><span class="p">))))</span>
                    
                <span class="n">html_plots</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html_plots</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">html_plots</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                
            <span class="c1">##body</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;div class=&quot;container-large </span><span class="si">%s</span><span class="s1">&quot; style=&quot;&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">),</span>
                        <span class="s1">&#39;&lt;div class=&quot;container&quot; style=&quot;&quot;&gt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;&lt;div class=&quot;dashboard-main&quot;&gt;&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;&lt;div class=&quot;table-container </span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">source</span><span class="p">),</span>
                                    <span class="s1">&#39;&lt;div class=&quot;title&quot;&gt;&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;&lt;div class=&quot;date&quot;&gt; Last Updated: &#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">date</span><span class="p">),</span>
                                        <span class="s1">&#39;&lt;span class=&quot;link&quot; id=&quot;code&quot;&gt;code&lt;/span&gt;&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;&lt;span class=&quot;link&quot; id=&quot;csv&quot;&gt;csv&lt;/span&gt;&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;&lt;div class=&quot;dataTables_wrapper form-inline dt-bootstrap&quot;&gt;&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;&lt;!--script--&gt;&#39;</span><span class="p">,</span>
                                    <span class="n">table</span><span class="p">,</span>
                                <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;&lt;div class=&quot;footnote&quot;&gt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">footnote</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                                    <span class="n">html_plots</span><span class="p">,</span>
                                <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">]</span>
            <span class="c1">#replace script within body, then join as string</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;logit&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;onset&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;anova&quot;</span><span class="p">)):</span>
                <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">script</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="p">(</span>                <span class="s1">&#39;&lt;!--script--&gt;&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">body</span><span class="p">]</span>
            <span class="c1"># join</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">body</span><span class="p">)))</span>

            <span class="c1">#build footer</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;logit&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;onset&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;anova&quot;</span><span class="p">)):</span>
                <span class="n">foot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;script&gt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;$(document).ready(function(){&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;getLogitTable();&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;additionalTable();&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;popover();&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;codeButton();&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;})&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;/script&gt;&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">):</span>
                <span class="n">foot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;script&gt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;$(document).ready(function(){&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;getLogitTable();&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;popover();&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;})&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;/script&gt;&#39;</span><span class="p">]</span>   
            <span class="k">else</span><span class="p">:</span>
                <span class="n">foot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;script&gt;&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;$(document).ready(function(){&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;getLogitTable();&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;})&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;/script&gt;&#39;</span><span class="p">]</span>
            <span class="n">foot</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">foot</span><span class="p">)))</span>
            
            <span class="c1">#build html</span>
            <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;html short=&quot;</span><span class="si">%s</span><span class="s1">&quot; long=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">short</span><span class="p">,</span> <span class="n">long</span><span class="p">),</span>
                    <span class="s1">&#39;&lt;head&gt;&#39;</span><span class="p">,</span>
                        <span class="n">head</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/head&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;body id=&quot;body&quot;&gt;&#39;</span><span class="p">,</span>
                        <span class="n">body</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/body&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;foot&gt;&#39;</span><span class="p">,</span>
                        <span class="n">foot</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/foot&gt;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;&lt;/html&gt;&#39;</span><span class="p">]</span>
            <span class="n">html</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">html</span><span class="p">)))</span>
                
    <span class="c1">#----save</span>
    <span class="c1"># check if paths exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="c1"># tidy html</span>
    <span class="c1">#html = re.sub(&quot;\s\s+&quot;, &quot; &quot;, html) #multiple spaces</span>
    <span class="c1"># save</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">html_</span><span class="p">:</span>
        <span class="n">html_</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;saved html file at </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    
    <span class="c1">#--------finished</span>
    <span class="n">console</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> finished in </span><span class="si">%s</span><span class="s1"> msec&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">_f</span><span class="p">,((</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">_t0</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">html</span></div>
</pre></div>

		</div>
		  
	</div>
</div>
<footer class="footer">
	<div class="container">
		<div>
			<div>&copy; Copyright 2019, </div>
			<div><a href="https://semeon.io/">Semeon Risom</a>.</div>
			<div>Updated 2019-05-20T09:51:57-05:00.</div>
		</div>
	</div>
</footer>
  </body>
</html>